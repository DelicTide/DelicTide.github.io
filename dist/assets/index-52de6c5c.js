(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))i(d);new MutationObserver(d=>{for(const l of d)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function e(d){const l={};return d.integrity&&(l.integrity=d.integrity),d.referrerPolicy&&(l.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?l.credentials="include":d.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(d){if(d.ep)return;d.ep=!0;const l=e(d);fetch(d.href,l)}})();/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Oi="156",Le={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},We={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},ki=300,Mi=1e3,Ge=1001,Ei=1002,Ki=1006,Ji=1008,$i=1009,tn=1023,en=3e3,oi=3001,ai="",hi="srgb",Xe=2e3,Ai=2001;class wi{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[t]===void 0&&(i[t]=[]),i[t].indexOf(e)===-1&&i[t].push(e)}hasEventListener(t,e){if(this._listeners===void 0)return!1;const i=this._listeners;return i[t]!==void 0&&i[t].indexOf(e)!==-1}removeEventListener(t,e){if(this._listeners===void 0)return;const d=this._listeners[t];if(d!==void 0){const l=d.indexOf(e);l!==-1&&d.splice(l,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const i=this._listeners[t.type];if(i!==void 0){t.target=this;const d=i.slice(0);for(let l=0,r=d.length;l<r;l++)d[l].call(this,t);t.target=null}}}const te=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let zi=1234567;const qi=Math.PI/180,Di=180/Math.PI;function ri(){const O=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(te[O&255]+te[O>>8&255]+te[O>>16&255]+te[O>>24&255]+"-"+te[t&255]+te[t>>8&255]+"-"+te[t>>16&15|64]+te[t>>24&255]+"-"+te[e&63|128]+te[e>>8&255]+"-"+te[e>>16&255]+te[e>>24&255]+te[i&255]+te[i>>8&255]+te[i>>16&255]+te[i>>24&255]).toLowerCase()}function ge(O,t,e){return Math.max(t,Math.min(e,O))}function Ui(O,t){return(O%t+t)%t}function nn(O,t,e,i,d){return i+(O-t)*(d-i)/(e-t)}function rn(O,t,e){return O!==t?(e-O)/(t-O):0}function Hi(O,t,e){return(1-e)*O+e*t}function sn(O,t,e,i){return Hi(O,t,1-Math.exp(-e*i))}function on(O,t=1){return t-Math.abs(Ui(O,t*2)-t)}function an(O,t,e){return O<=t?0:O>=e?1:(O=(O-t)/(e-t),O*O*(3-2*O))}function hn(O,t,e){return O<=t?0:O>=e?1:(O=(O-t)/(e-t),O*O*O*(O*(O*6-15)+10))}function ln(O,t){return O+Math.floor(Math.random()*(t-O+1))}function cn(O,t){return O+Math.random()*(t-O)}function un(O){return O*(.5-Math.random())}function pn(O){O!==void 0&&(zi=O);let t=zi+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function dn(O){return O*qi}function fn(O){return O*Di}function vn(O){return(O&O-1)===0&&O!==0}function mn(O){return Math.pow(2,Math.ceil(Math.log(O)/Math.LN2))}function yn(O){return Math.pow(2,Math.floor(Math.log(O)/Math.LN2))}function xn(O,t,e,i,d){const l=Math.cos,r=Math.sin,a=l(e/2),s=r(e/2),c=l((t+i)/2),o=r((t+i)/2),n=l((t-i)/2),h=r((t-i)/2),u=l((i-t)/2),p=r((i-t)/2);switch(d){case"XYX":O.set(a*o,s*n,s*h,a*c);break;case"YZY":O.set(s*h,a*o,s*n,a*c);break;case"ZXZ":O.set(s*n,s*h,a*o,a*c);break;case"XZX":O.set(a*o,s*p,s*u,a*c);break;case"YXY":O.set(s*u,a*o,s*p,a*c);break;case"ZYZ":O.set(s*p,s*u,a*o,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+d)}}function wn(O,t){switch(t.constructor){case Float32Array:return O;case Uint32Array:return O/4294967295;case Uint16Array:return O/65535;case Uint8Array:return O/255;case Int32Array:return Math.max(O/2147483647,-1);case Int16Array:return Math.max(O/32767,-1);case Int8Array:return Math.max(O/127,-1);default:throw new Error("Invalid component type.")}}function gn(O,t){switch(t.constructor){case Float32Array:return O;case Uint32Array:return Math.round(O*4294967295);case Uint16Array:return Math.round(O*65535);case Uint8Array:return Math.round(O*255);case Int32Array:return Math.round(O*2147483647);case Int16Array:return Math.round(O*32767);case Int8Array:return Math.round(O*127);default:throw new Error("Invalid component type.")}}const bn={DEG2RAD:qi,RAD2DEG:Di,generateUUID:ri,clamp:ge,euclideanModulo:Ui,mapLinear:nn,inverseLerp:rn,lerp:Hi,damp:sn,pingpong:on,smoothstep:an,smootherstep:hn,randInt:ln,randFloat:cn,randFloatSpread:un,seededRandom:pn,degToRad:dn,radToDeg:fn,isPowerOfTwo:vn,ceilPowerOfTwo:mn,floorPowerOfTwo:yn,setQuaternionFromProperEuler:xn,normalize:gn,denormalize:wn};class ee{constructor(t=0,e=0){ee.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,d=t.elements;return this.x=d[0]*e+d[3]*i+d[6],this.y=d[1]*e+d[4]*i+d[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(ge(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),d=Math.sin(e),l=this.x-t.x,r=this.y-t.y;return this.x=l*i-r*d+t.x,this.y=l*d+r*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ue{constructor(t,e,i,d,l,r,a,s,c){Ue.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,e,i,d,l,r,a,s,c)}set(t,e,i,d,l,r,a,s,c){const o=this.elements;return o[0]=t,o[1]=d,o[2]=a,o[3]=e,o[4]=l,o[5]=s,o[6]=i,o[7]=r,o[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,d=e.elements,l=this.elements,r=i[0],a=i[3],s=i[6],c=i[1],o=i[4],n=i[7],h=i[2],u=i[5],p=i[8],f=d[0],v=d[3],m=d[6],y=d[1],g=d[4],x=d[7],E=d[2],k=d[5],L=d[8];return l[0]=r*f+a*y+s*E,l[3]=r*v+a*g+s*k,l[6]=r*m+a*x+s*L,l[1]=c*f+o*y+n*E,l[4]=c*v+o*g+n*k,l[7]=c*m+o*x+n*L,l[2]=h*f+u*y+p*E,l[5]=h*v+u*g+p*k,l[8]=h*m+u*x+p*L,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],d=t[2],l=t[3],r=t[4],a=t[5],s=t[6],c=t[7],o=t[8];return e*r*o-e*a*c-i*l*o+i*a*s+d*l*c-d*r*s}invert(){const t=this.elements,e=t[0],i=t[1],d=t[2],l=t[3],r=t[4],a=t[5],s=t[6],c=t[7],o=t[8],n=o*r-a*c,h=a*s-o*l,u=c*l-r*s,p=e*n+i*h+d*u;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return t[0]=n*f,t[1]=(d*c-o*i)*f,t[2]=(a*i-d*r)*f,t[3]=h*f,t[4]=(o*e-d*s)*f,t[5]=(d*l-a*e)*f,t[6]=u*f,t[7]=(i*s-c*e)*f,t[8]=(r*e-i*l)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,d,l,r,a){const s=Math.cos(l),c=Math.sin(l);return this.set(i*s,i*c,-i*(s*r+c*a)+r+t,-d*c,d*s,-d*(-c*r+s*a)+a+e,0,0,1),this}scale(t,e){return this.premultiply(li.makeScale(t,e)),this}rotate(t){return this.premultiply(li.makeRotation(-t)),this}translate(t,e){return this.premultiply(li.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,i,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,i=t.elements;for(let d=0;d<9;d++)if(e[d]!==i[d])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const li=new Ue;function Si(O){return document.createElementNS("http://www.w3.org/1999/xhtml",O)}const Ci={};function ci(O){O in Ci||(Ci[O]=!0,console.warn(O))}function ui(O){return O<.04045?O*.0773993808:Math.pow(O*.9478672986+.0521327014,2.4)}let Oe;class Mn{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{Oe===void 0&&(Oe=Si("canvas")),Oe.width=t.width,Oe.height=t.height;const i=Oe.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=Oe}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const e=Si("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);const d=i.getImageData(0,0,t.width,t.height),l=d.data;for(let r=0;r<l.length;r++)l[r]=ui(l[r]/255)*255;return i.putImageData(d,0,0),e}else if(t.data){const e=t.data.slice(0);for(let i=0;i<e.length;i++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[i]=Math.floor(ui(e[i]/255)*255):e[i]=ui(e[i]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let En=0;class An{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:En++}),this.uuid=ri(),this.data=t,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const i={uuid:this.uuid,url:""},d=this.data;if(d!==null){let l;if(Array.isArray(d)){l=[];for(let r=0,a=d.length;r<a;r++)d[r].isDataTexture?l.push(pi(d[r].image)):l.push(pi(d[r]))}else l=pi(d);i.url=l}return e||(t.images[this.uuid]=i),i}}function pi(O){return typeof HTMLImageElement<"u"&&O instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&O instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&O instanceof ImageBitmap?Mn.getDataURL(O):O.data?{data:Array.from(O.data),width:O.width,height:O.height,type:O.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let zn=0;class Ne extends wi{constructor(t=Ne.DEFAULT_IMAGE,e=Ne.DEFAULT_MAPPING,i=Ge,d=Ge,l=Ki,r=Ji,a=tn,s=$i,c=Ne.DEFAULT_ANISOTROPY,o=ai){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:zn++}),this.uuid=ri(),this.name="",this.source=new An(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=i,this.wrapT=d,this.magFilter=l,this.minFilter=r,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=s,this.offset=new ee(0,0),this.repeat=new ee(1,1),this.center=new ee(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ue,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof o=="string"?this.colorSpace=o:(ci("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=o===oi?hi:ai),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==ki)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Mi:t.x=t.x-Math.floor(t.x);break;case Ge:t.x=t.x<0?0:1;break;case Ei:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case Mi:t.y=t.y-Math.floor(t.y);break;case Ge:t.y=t.y<0?0:1;break;case Ei:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return ci("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===hi?oi:en}set encoding(t){ci("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=t===oi?hi:ai}}Ne.DEFAULT_IMAGE=null;Ne.DEFAULT_MAPPING=ki;Ne.DEFAULT_ANISOTROPY=1;class Ve{constructor(t=0,e=0,i=0,d=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=i,this._w=d}static slerpFlat(t,e,i,d,l,r,a){let s=i[d+0],c=i[d+1],o=i[d+2],n=i[d+3];const h=l[r+0],u=l[r+1],p=l[r+2],f=l[r+3];if(a===0){t[e+0]=s,t[e+1]=c,t[e+2]=o,t[e+3]=n;return}if(a===1){t[e+0]=h,t[e+1]=u,t[e+2]=p,t[e+3]=f;return}if(n!==f||s!==h||c!==u||o!==p){let v=1-a;const m=s*h+c*u+o*p+n*f,y=m>=0?1:-1,g=1-m*m;if(g>Number.EPSILON){const E=Math.sqrt(g),k=Math.atan2(E,m*y);v=Math.sin(v*k)/E,a=Math.sin(a*k)/E}const x=a*y;if(s=s*v+h*x,c=c*v+u*x,o=o*v+p*x,n=n*v+f*x,v===1-a){const E=1/Math.sqrt(s*s+c*c+o*o+n*n);s*=E,c*=E,o*=E,n*=E}}t[e]=s,t[e+1]=c,t[e+2]=o,t[e+3]=n}static multiplyQuaternionsFlat(t,e,i,d,l,r){const a=i[d],s=i[d+1],c=i[d+2],o=i[d+3],n=l[r],h=l[r+1],u=l[r+2],p=l[r+3];return t[e]=a*p+o*n+s*u-c*h,t[e+1]=s*p+o*h+c*n-a*u,t[e+2]=c*p+o*u+a*h-s*n,t[e+3]=o*p-a*n-s*h-c*u,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,d){return this._x=t,this._y=e,this._z=i,this._w=d,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){const i=t._x,d=t._y,l=t._z,r=t._order,a=Math.cos,s=Math.sin,c=a(i/2),o=a(d/2),n=a(l/2),h=s(i/2),u=s(d/2),p=s(l/2);switch(r){case"XYZ":this._x=h*o*n+c*u*p,this._y=c*u*n-h*o*p,this._z=c*o*p+h*u*n,this._w=c*o*n-h*u*p;break;case"YXZ":this._x=h*o*n+c*u*p,this._y=c*u*n-h*o*p,this._z=c*o*p-h*u*n,this._w=c*o*n+h*u*p;break;case"ZXY":this._x=h*o*n-c*u*p,this._y=c*u*n+h*o*p,this._z=c*o*p+h*u*n,this._w=c*o*n-h*u*p;break;case"ZYX":this._x=h*o*n-c*u*p,this._y=c*u*n+h*o*p,this._z=c*o*p-h*u*n,this._w=c*o*n+h*u*p;break;case"YZX":this._x=h*o*n+c*u*p,this._y=c*u*n+h*o*p,this._z=c*o*p-h*u*n,this._w=c*o*n-h*u*p;break;case"XZY":this._x=h*o*n-c*u*p,this._y=c*u*n-h*o*p,this._z=c*o*p+h*u*n,this._w=c*o*n+h*u*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return e!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,d=Math.sin(i);return this._x=t.x*d,this._y=t.y*d,this._z=t.z*d,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],d=e[4],l=e[8],r=e[1],a=e[5],s=e[9],c=e[2],o=e[6],n=e[10],h=i+a+n;if(h>0){const u=.5/Math.sqrt(h+1);this._w=.25/u,this._x=(o-s)*u,this._y=(l-c)*u,this._z=(r-d)*u}else if(i>a&&i>n){const u=2*Math.sqrt(1+i-a-n);this._w=(o-s)/u,this._x=.25*u,this._y=(d+r)/u,this._z=(l+c)/u}else if(a>n){const u=2*Math.sqrt(1+a-i-n);this._w=(l-c)/u,this._x=(d+r)/u,this._y=.25*u,this._z=(s+o)/u}else{const u=2*Math.sqrt(1+n-i-a);this._w=(r-d)/u,this._x=(l+c)/u,this._y=(s+o)/u,this._z=.25*u}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(ge(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(i===0)return this;const d=Math.min(1,e/i);return this.slerp(t,d),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,d=t._y,l=t._z,r=t._w,a=e._x,s=e._y,c=e._z,o=e._w;return this._x=i*o+r*a+d*c-l*s,this._y=d*o+r*s+l*a-i*c,this._z=l*o+r*c+i*s-d*a,this._w=r*o-i*a-d*s-l*c,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const i=this._x,d=this._y,l=this._z,r=this._w;let a=r*t._w+i*t._x+d*t._y+l*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=r,this._x=i,this._y=d,this._z=l,this;const s=1-a*a;if(s<=Number.EPSILON){const u=1-e;return this._w=u*r+e*this._w,this._x=u*i+e*this._x,this._y=u*d+e*this._y,this._z=u*l+e*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(s),o=Math.atan2(c,a),n=Math.sin((1-e)*o)/c,h=Math.sin(e*o)/c;return this._w=r*n+this._w*h,this._x=i*n+this._x*h,this._y=d*n+this._y*h,this._z=l*n+this._z*h,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),d=2*Math.PI*Math.random(),l=2*Math.PI*Math.random();return this.set(e*Math.cos(d),i*Math.sin(l),i*Math.cos(l),e*Math.sin(d))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Et{constructor(t=0,e=0,i=0){Et.prototype.isVector3=!0,this.x=t,this.y=e,this.z=i}set(t,e,i){return i===void 0&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(Ti.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Ti.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,d=this.z,l=t.elements;return this.x=l[0]*e+l[3]*i+l[6]*d,this.y=l[1]*e+l[4]*i+l[7]*d,this.z=l[2]*e+l[5]*i+l[8]*d,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,d=this.z,l=t.elements,r=1/(l[3]*e+l[7]*i+l[11]*d+l[15]);return this.x=(l[0]*e+l[4]*i+l[8]*d+l[12])*r,this.y=(l[1]*e+l[5]*i+l[9]*d+l[13])*r,this.z=(l[2]*e+l[6]*i+l[10]*d+l[14])*r,this}applyQuaternion(t){const e=this.x,i=this.y,d=this.z,l=t.x,r=t.y,a=t.z,s=t.w,c=s*e+r*d-a*i,o=s*i+a*e-l*d,n=s*d+l*i-r*e,h=-l*e-r*i-a*d;return this.x=c*s+h*-l+o*-a-n*-r,this.y=o*s+h*-r+n*-l-c*-a,this.z=n*s+h*-a+c*-r-o*-l,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,d=this.z,l=t.elements;return this.x=l[0]*e+l[4]*i+l[8]*d,this.y=l[1]*e+l[5]*i+l[9]*d,this.z=l[2]*e+l[6]*i+l[10]*d,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,d=t.y,l=t.z,r=e.x,a=e.y,s=e.z;return this.x=d*s-l*a,this.y=l*r-i*s,this.z=i*a-d*r,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return di.copy(this).projectOnVector(t),this.sub(di)}reflect(t){return this.sub(di.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(ge(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,d=this.z-t.z;return e*e+i*i+d*d}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const d=Math.sin(e)*t;return this.x=d*Math.sin(i),this.y=Math.cos(e)*t,this.z=d*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),d=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=d,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=(Math.random()-.5)*2,e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const di=new Et,Ti=new Ve,ze=new Et,fi=new Et,je=new Et,Te=new Et,vi=new Et,Ze=new Et,mi=new Et;class Sn{constructor(t=new Et,e=new Et(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,ze)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=ze.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(ze.copy(this.origin).addScaledVector(this.direction,e),ze.distanceToSquared(t))}distanceSqToSegment(t,e,i,d){fi.copy(t).add(e).multiplyScalar(.5),je.copy(e).sub(t).normalize(),Te.copy(this.origin).sub(fi);const l=t.distanceTo(e)*.5,r=-this.direction.dot(je),a=Te.dot(this.direction),s=-Te.dot(je),c=Te.lengthSq(),o=Math.abs(1-r*r);let n,h,u,p;if(o>0)if(n=r*s-a,h=r*a-s,p=l*o,n>=0)if(h>=-p)if(h<=p){const f=1/o;n*=f,h*=f,u=n*(n+r*h+2*a)+h*(r*n+h+2*s)+c}else h=l,n=Math.max(0,-(r*h+a)),u=-n*n+h*(h+2*s)+c;else h=-l,n=Math.max(0,-(r*h+a)),u=-n*n+h*(h+2*s)+c;else h<=-p?(n=Math.max(0,-(-r*l+a)),h=n>0?-l:Math.min(Math.max(-l,-s),l),u=-n*n+h*(h+2*s)+c):h<=p?(n=0,h=Math.min(Math.max(-l,-s),l),u=h*(h+2*s)+c):(n=Math.max(0,-(r*l+a)),h=n>0?l:Math.min(Math.max(-l,-s),l),u=-n*n+h*(h+2*s)+c);else h=r>0?-l:l,n=Math.max(0,-(r*h+a)),u=-n*n+h*(h+2*s)+c;return i&&i.copy(this.origin).addScaledVector(this.direction,n),d&&d.copy(fi).addScaledVector(je,h),u}intersectSphere(t,e){ze.subVectors(t.center,this.origin);const i=ze.dot(this.direction),d=ze.dot(ze)-i*i,l=t.radius*t.radius;if(d>l)return null;const r=Math.sqrt(l-d),a=i-r,s=i+r;return s<0?null:a<0?this.at(s,e):this.at(a,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){const i=this.distanceToPlane(t);return i===null?null:this.at(i,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,d,l,r,a,s;const c=1/this.direction.x,o=1/this.direction.y,n=1/this.direction.z,h=this.origin;return c>=0?(i=(t.min.x-h.x)*c,d=(t.max.x-h.x)*c):(i=(t.max.x-h.x)*c,d=(t.min.x-h.x)*c),o>=0?(l=(t.min.y-h.y)*o,r=(t.max.y-h.y)*o):(l=(t.max.y-h.y)*o,r=(t.min.y-h.y)*o),i>r||l>d||((l>i||isNaN(i))&&(i=l),(r<d||isNaN(d))&&(d=r),n>=0?(a=(t.min.z-h.z)*n,s=(t.max.z-h.z)*n):(a=(t.max.z-h.z)*n,s=(t.min.z-h.z)*n),i>s||a>d)||((a>i||i!==i)&&(i=a),(s<d||d!==d)&&(d=s),d<0)?null:this.at(i>=0?i:d,e)}intersectsBox(t){return this.intersectBox(t,ze)!==null}intersectTriangle(t,e,i,d,l){vi.subVectors(e,t),Ze.subVectors(i,t),mi.crossVectors(vi,Ze);let r=this.direction.dot(mi),a;if(r>0){if(d)return null;a=1}else if(r<0)a=-1,r=-r;else return null;Te.subVectors(this.origin,t);const s=a*this.direction.dot(Ze.crossVectors(Te,Ze));if(s<0)return null;const c=a*this.direction.dot(vi.cross(Te));if(c<0||s+c>r)return null;const o=-a*Te.dot(mi);return o<0?null:this.at(o/r,l)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Ce{constructor(t,e,i,d,l,r,a,s,c,o,n,h,u,p,f,v){Ce.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,e,i,d,l,r,a,s,c,o,n,h,u,p,f,v)}set(t,e,i,d,l,r,a,s,c,o,n,h,u,p,f,v){const m=this.elements;return m[0]=t,m[4]=e,m[8]=i,m[12]=d,m[1]=l,m[5]=r,m[9]=a,m[13]=s,m[2]=c,m[6]=o,m[10]=n,m[14]=h,m[3]=u,m[7]=p,m[11]=f,m[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Ce().fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,d=1/ke.setFromMatrixColumn(t,0).length(),l=1/ke.setFromMatrixColumn(t,1).length(),r=1/ke.setFromMatrixColumn(t,2).length();return e[0]=i[0]*d,e[1]=i[1]*d,e[2]=i[2]*d,e[3]=0,e[4]=i[4]*l,e[5]=i[5]*l,e[6]=i[6]*l,e[7]=0,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,i=t.x,d=t.y,l=t.z,r=Math.cos(i),a=Math.sin(i),s=Math.cos(d),c=Math.sin(d),o=Math.cos(l),n=Math.sin(l);if(t.order==="XYZ"){const h=r*o,u=r*n,p=a*o,f=a*n;e[0]=s*o,e[4]=-s*n,e[8]=c,e[1]=u+p*c,e[5]=h-f*c,e[9]=-a*s,e[2]=f-h*c,e[6]=p+u*c,e[10]=r*s}else if(t.order==="YXZ"){const h=s*o,u=s*n,p=c*o,f=c*n;e[0]=h+f*a,e[4]=p*a-u,e[8]=r*c,e[1]=r*n,e[5]=r*o,e[9]=-a,e[2]=u*a-p,e[6]=f+h*a,e[10]=r*s}else if(t.order==="ZXY"){const h=s*o,u=s*n,p=c*o,f=c*n;e[0]=h-f*a,e[4]=-r*n,e[8]=p+u*a,e[1]=u+p*a,e[5]=r*o,e[9]=f-h*a,e[2]=-r*c,e[6]=a,e[10]=r*s}else if(t.order==="ZYX"){const h=r*o,u=r*n,p=a*o,f=a*n;e[0]=s*o,e[4]=p*c-u,e[8]=h*c+f,e[1]=s*n,e[5]=f*c+h,e[9]=u*c-p,e[2]=-c,e[6]=a*s,e[10]=r*s}else if(t.order==="YZX"){const h=r*s,u=r*c,p=a*s,f=a*c;e[0]=s*o,e[4]=f-h*n,e[8]=p*n+u,e[1]=n,e[5]=r*o,e[9]=-a*o,e[2]=-c*o,e[6]=u*n+p,e[10]=h-f*n}else if(t.order==="XZY"){const h=r*s,u=r*c,p=a*s,f=a*c;e[0]=s*o,e[4]=-n,e[8]=c*o,e[1]=h*n+f,e[5]=r*o,e[9]=u*n-p,e[2]=p*n-u,e[6]=a*o,e[10]=f*n+h}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Cn,t,Tn)}lookAt(t,e,i){const d=this.elements;return le.subVectors(t,e),le.lengthSq()===0&&(le.z=1),le.normalize(),Be.crossVectors(i,le),Be.lengthSq()===0&&(Math.abs(i.z)===1?le.x+=1e-4:le.z+=1e-4,le.normalize(),Be.crossVectors(i,le)),Be.normalize(),Qe.crossVectors(le,Be),d[0]=Be.x,d[4]=Qe.x,d[8]=le.x,d[1]=Be.y,d[5]=Qe.y,d[9]=le.y,d[2]=Be.z,d[6]=Qe.z,d[10]=le.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,d=e.elements,l=this.elements,r=i[0],a=i[4],s=i[8],c=i[12],o=i[1],n=i[5],h=i[9],u=i[13],p=i[2],f=i[6],v=i[10],m=i[14],y=i[3],g=i[7],x=i[11],E=i[15],k=d[0],L=d[4],N=d[8],Y=d[12],R=d[1],z=d[5],I=d[9],V=d[13],et=d[2],K=d[6],ft=d[10],_=d[14],C=d[3],j=d[7],H=d[11],A=d[15];return l[0]=r*k+a*R+s*et+c*C,l[4]=r*L+a*z+s*K+c*j,l[8]=r*N+a*I+s*ft+c*H,l[12]=r*Y+a*V+s*_+c*A,l[1]=o*k+n*R+h*et+u*C,l[5]=o*L+n*z+h*K+u*j,l[9]=o*N+n*I+h*ft+u*H,l[13]=o*Y+n*V+h*_+u*A,l[2]=p*k+f*R+v*et+m*C,l[6]=p*L+f*z+v*K+m*j,l[10]=p*N+f*I+v*ft+m*H,l[14]=p*Y+f*V+v*_+m*A,l[3]=y*k+g*R+x*et+E*C,l[7]=y*L+g*z+x*K+E*j,l[11]=y*N+g*I+x*ft+E*H,l[15]=y*Y+g*V+x*_+E*A,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],d=t[8],l=t[12],r=t[1],a=t[5],s=t[9],c=t[13],o=t[2],n=t[6],h=t[10],u=t[14],p=t[3],f=t[7],v=t[11],m=t[15];return p*(+l*s*n-d*c*n-l*a*h+i*c*h+d*a*u-i*s*u)+f*(+e*s*u-e*c*h+l*r*h-d*r*u+d*c*o-l*s*o)+v*(+e*c*n-e*a*u-l*r*n+i*r*u+l*a*o-i*c*o)+m*(-d*a*o-e*s*n+e*a*h+d*r*n-i*r*h+i*s*o)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const d=this.elements;return t.isVector3?(d[12]=t.x,d[13]=t.y,d[14]=t.z):(d[12]=t,d[13]=e,d[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],d=t[2],l=t[3],r=t[4],a=t[5],s=t[6],c=t[7],o=t[8],n=t[9],h=t[10],u=t[11],p=t[12],f=t[13],v=t[14],m=t[15],y=n*v*c-f*h*c+f*s*u-a*v*u-n*s*m+a*h*m,g=p*h*c-o*v*c-p*s*u+r*v*u+o*s*m-r*h*m,x=o*f*c-p*n*c+p*a*u-r*f*u-o*a*m+r*n*m,E=p*n*s-o*f*s-p*a*h+r*f*h+o*a*v-r*n*v,k=e*y+i*g+d*x+l*E;if(k===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const L=1/k;return t[0]=y*L,t[1]=(f*h*l-n*v*l-f*d*u+i*v*u+n*d*m-i*h*m)*L,t[2]=(a*v*l-f*s*l+f*d*c-i*v*c-a*d*m+i*s*m)*L,t[3]=(n*s*l-a*h*l-n*d*c+i*h*c+a*d*u-i*s*u)*L,t[4]=g*L,t[5]=(o*v*l-p*h*l+p*d*u-e*v*u-o*d*m+e*h*m)*L,t[6]=(p*s*l-r*v*l-p*d*c+e*v*c+r*d*m-e*s*m)*L,t[7]=(r*h*l-o*s*l+o*d*c-e*h*c-r*d*u+e*s*u)*L,t[8]=x*L,t[9]=(p*n*l-o*f*l-p*i*u+e*f*u+o*i*m-e*n*m)*L,t[10]=(r*f*l-p*a*l+p*i*c-e*f*c-r*i*m+e*a*m)*L,t[11]=(o*a*l-r*n*l-o*i*c+e*n*c+r*i*u-e*a*u)*L,t[12]=E*L,t[13]=(o*f*d-p*n*d+p*i*h-e*f*h-o*i*v+e*n*v)*L,t[14]=(p*a*d-r*f*d-p*i*s+e*f*s+r*i*v-e*a*v)*L,t[15]=(r*n*d-o*a*d+o*i*s-e*n*s-r*i*h+e*a*h)*L,this}scale(t){const e=this.elements,i=t.x,d=t.y,l=t.z;return e[0]*=i,e[4]*=d,e[8]*=l,e[1]*=i,e[5]*=d,e[9]*=l,e[2]*=i,e[6]*=d,e[10]*=l,e[3]*=i,e[7]*=d,e[11]*=l,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],d=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,d))}makeTranslation(t,e,i){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),d=Math.sin(e),l=1-i,r=t.x,a=t.y,s=t.z,c=l*r,o=l*a;return this.set(c*r+i,c*a-d*s,c*s+d*a,0,c*a+d*s,o*a+i,o*s-d*r,0,c*s-d*a,o*s+d*r,l*s*s+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,d,l,r){return this.set(1,i,l,0,t,1,r,0,e,d,1,0,0,0,0,1),this}compose(t,e,i){const d=this.elements,l=e._x,r=e._y,a=e._z,s=e._w,c=l+l,o=r+r,n=a+a,h=l*c,u=l*o,p=l*n,f=r*o,v=r*n,m=a*n,y=s*c,g=s*o,x=s*n,E=i.x,k=i.y,L=i.z;return d[0]=(1-(f+m))*E,d[1]=(u+x)*E,d[2]=(p-g)*E,d[3]=0,d[4]=(u-x)*k,d[5]=(1-(h+m))*k,d[6]=(v+y)*k,d[7]=0,d[8]=(p+g)*L,d[9]=(v-y)*L,d[10]=(1-(h+f))*L,d[11]=0,d[12]=t.x,d[13]=t.y,d[14]=t.z,d[15]=1,this}decompose(t,e,i){const d=this.elements;let l=ke.set(d[0],d[1],d[2]).length();const r=ke.set(d[4],d[5],d[6]).length(),a=ke.set(d[8],d[9],d[10]).length();this.determinant()<0&&(l=-l),t.x=d[12],t.y=d[13],t.z=d[14],we.copy(this);const c=1/l,o=1/r,n=1/a;return we.elements[0]*=c,we.elements[1]*=c,we.elements[2]*=c,we.elements[4]*=o,we.elements[5]*=o,we.elements[6]*=o,we.elements[8]*=n,we.elements[9]*=n,we.elements[10]*=n,e.setFromRotationMatrix(we),i.x=l,i.y=r,i.z=a,this}makePerspective(t,e,i,d,l,r,a=Xe){const s=this.elements,c=2*l/(e-t),o=2*l/(i-d),n=(e+t)/(e-t),h=(i+d)/(i-d);let u,p;if(a===Xe)u=-(r+l)/(r-l),p=-2*r*l/(r-l);else if(a===Ai)u=-r/(r-l),p=-r*l/(r-l);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return s[0]=c,s[4]=0,s[8]=n,s[12]=0,s[1]=0,s[5]=o,s[9]=h,s[13]=0,s[2]=0,s[6]=0,s[10]=u,s[14]=p,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}makeOrthographic(t,e,i,d,l,r,a=Xe){const s=this.elements,c=1/(e-t),o=1/(i-d),n=1/(r-l),h=(e+t)*c,u=(i+d)*o;let p,f;if(a===Xe)p=(r+l)*n,f=-2*n;else if(a===Ai)p=l*n,f=-1*n;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return s[0]=2*c,s[4]=0,s[8]=0,s[12]=-h,s[1]=0,s[5]=2*o,s[9]=0,s[13]=-u,s[2]=0,s[6]=0,s[10]=f,s[14]=-p,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let d=0;d<16;d++)if(e[d]!==i[d])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}const ke=new Et,we=new Ce,Cn=new Et(0,0,0),Tn=new Et(1,1,1),Be=new Et,Qe=new Et,le=new Et,Bi=new Ce,Pi=new Ve;class si{constructor(t=0,e=0,i=0,d=si.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=i,this._order=d}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,d=this._order){return this._x=t,this._y=e,this._z=i,this._order=d,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const d=t.elements,l=d[0],r=d[4],a=d[8],s=d[1],c=d[5],o=d[9],n=d[2],h=d[6],u=d[10];switch(e){case"XYZ":this._y=Math.asin(ge(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-o,u),this._z=Math.atan2(-r,l)):(this._x=Math.atan2(h,c),this._z=0);break;case"YXZ":this._x=Math.asin(-ge(o,-1,1)),Math.abs(o)<.9999999?(this._y=Math.atan2(a,u),this._z=Math.atan2(s,c)):(this._y=Math.atan2(-n,l),this._z=0);break;case"ZXY":this._x=Math.asin(ge(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-n,u),this._z=Math.atan2(-r,c)):(this._y=0,this._z=Math.atan2(s,l));break;case"ZYX":this._y=Math.asin(-ge(n,-1,1)),Math.abs(n)<.9999999?(this._x=Math.atan2(h,u),this._z=Math.atan2(s,l)):(this._x=0,this._z=Math.atan2(-r,c));break;case"YZX":this._z=Math.asin(ge(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-o,c),this._y=Math.atan2(-n,l)):(this._x=0,this._y=Math.atan2(a,u));break;case"XZY":this._z=Math.asin(-ge(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(h,c),this._y=Math.atan2(a,l)):(this._x=Math.atan2(-o,u),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,i===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return Bi.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Bi,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return Pi.setFromEuler(this),this.setFromQuaternion(Pi,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}si.DEFAULT_ORDER="XYZ";class Bn{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let Pn=0;const Ri=new Et,qe=new Ve,Se=new Ce,Ke=new Et,He=new Et,Rn=new Et,_n=new Ve,_i=new Et(1,0,0),Fi=new Et(0,1,0),Ni=new Et(0,0,1),Fn={type:"added"},Nn={type:"removed"};class Ie extends wi{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Pn++}),this.uuid=ri(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ie.DEFAULT_UP.clone();const t=new Et,e=new si,i=new Ve,d=new Et(1,1,1);function l(){i.setFromEuler(e,!1)}function r(){e.setFromQuaternion(i,void 0,!1)}e._onChange(l),i._onChange(r),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:d},modelViewMatrix:{value:new Ce},normalMatrix:{value:new Ue}}),this.matrix=new Ce,this.matrixWorld=new Ce,this.matrixAutoUpdate=Ie.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Ie.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new Bn,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return qe.setFromAxisAngle(t,e),this.quaternion.multiply(qe),this}rotateOnWorldAxis(t,e){return qe.setFromAxisAngle(t,e),this.quaternion.premultiply(qe),this}rotateX(t){return this.rotateOnAxis(_i,t)}rotateY(t){return this.rotateOnAxis(Fi,t)}rotateZ(t){return this.rotateOnAxis(Ni,t)}translateOnAxis(t,e){return Ri.copy(t).applyQuaternion(this.quaternion),this.position.add(Ri.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(_i,t)}translateY(t){return this.translateOnAxis(Fi,t)}translateZ(t){return this.translateOnAxis(Ni,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Se.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?Ke.copy(t):Ke.set(t,e,i);const d=this.parent;this.updateWorldMatrix(!0,!1),He.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Se.lookAt(He,Ke,this.up):Se.lookAt(Ke,He,this.up),this.quaternion.setFromRotationMatrix(Se),d&&(Se.extractRotation(d.matrixWorld),qe.setFromRotationMatrix(Se),this.quaternion.premultiply(qe.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Fn)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Nn)),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),Se.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),Se.multiply(t.parent.matrixWorld)),t.applyMatrix4(Se),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,d=this.children.length;i<d;i++){const r=this.children[i].getObjectByProperty(t,e);if(r!==void 0)return r}}getObjectsByProperty(t,e){let i=[];this[t]===e&&i.push(this);for(let d=0,l=this.children.length;d<l;d++){const r=this.children[d].getObjectsByProperty(t,e);r.length>0&&(i=i.concat(r))}return i}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(He,t,Rn),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(He,_n,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,d=e.length;i<d;i++)e[i].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const e=this.children;for(let i=0,d=e.length;i<d;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,d=e.length;i<d;i++){const l=e[i];(l.matrixWorldAutoUpdate===!0||t===!0)&&l.updateMatrixWorld(t)}}updateWorldMatrix(t,e){const i=this.parent;if(t===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e===!0){const d=this.children;for(let l=0,r=d.length;l<r;l++){const a=d[l];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(t){const e=t===void 0||typeof t=="string",i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const d={};d.uuid=this.uuid,d.type=this.type,this.name!==""&&(d.name=this.name),this.castShadow===!0&&(d.castShadow=!0),this.receiveShadow===!0&&(d.receiveShadow=!0),this.visible===!1&&(d.visible=!1),this.frustumCulled===!1&&(d.frustumCulled=!1),this.renderOrder!==0&&(d.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(d.userData=this.userData),d.layers=this.layers.mask,d.matrix=this.matrix.toArray(),d.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(d.matrixAutoUpdate=!1),this.isInstancedMesh&&(d.type="InstancedMesh",d.count=this.count,d.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(d.instanceColor=this.instanceColor.toJSON()));function l(a,s){return a[s.uuid]===void 0&&(a[s.uuid]=s.toJSON(t)),s.uuid}if(this.isScene)this.background&&(this.background.isColor?d.background=this.background.toJSON():this.background.isTexture&&(d.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(d.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){d.geometry=l(t.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const s=a.shapes;if(Array.isArray(s))for(let c=0,o=s.length;c<o;c++){const n=s[c];l(t.shapes,n)}else l(t.shapes,s)}}if(this.isSkinnedMesh&&(d.bindMode=this.bindMode,d.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(l(t.skeletons,this.skeleton),d.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let s=0,c=this.material.length;s<c;s++)a.push(l(t.materials,this.material[s]));d.material=a}else d.material=l(t.materials,this.material);if(this.children.length>0){d.children=[];for(let a=0;a<this.children.length;a++)d.children.push(this.children[a].toJSON(t).object)}if(this.animations.length>0){d.animations=[];for(let a=0;a<this.animations.length;a++){const s=this.animations[a];d.animations.push(l(t.animations,s))}}if(e){const a=r(t.geometries),s=r(t.materials),c=r(t.textures),o=r(t.images),n=r(t.shapes),h=r(t.skeletons),u=r(t.animations),p=r(t.nodes);a.length>0&&(i.geometries=a),s.length>0&&(i.materials=s),c.length>0&&(i.textures=c),o.length>0&&(i.images=o),n.length>0&&(i.shapes=n),h.length>0&&(i.skeletons=h),u.length>0&&(i.animations=u),p.length>0&&(i.nodes=p)}return i.object=d,i;function r(a){const s=[];for(const c in a){const o=a[c];delete o.metadata,s.push(o)}return s}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let i=0;i<t.children.length;i++){const d=t.children[i];this.add(d.clone())}return this}}Ie.DEFAULT_UP=new Et(0,1,0);Ie.DEFAULT_MATRIX_AUTO_UPDATE=!0;Ie.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const yi=new Et,In=new Et,Vn=new Ue;class Ln{constructor(t=new Et(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,d){return this.normal.set(t,e,i),this.constant=d,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){const d=yi.subVectors(i,e).cross(In.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(d,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const i=t.delta(yi),d=this.normal.dot(i);if(d===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):null;const l=-(t.start.dot(this.normal)+this.constant)/d;return l<0||l>1?null:e.copy(t.start).addScaledVector(i,l)}intersectsLine(t){const e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const i=e||Vn.getNormalMatrix(t),d=this.coplanarPoint(yi).applyMatrix4(t),l=this.normal.applyMatrix3(i).normalize();return this.constant=-d.dot(l),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}class Ii{constructor(t=1,e=0,i=0){return this.radius=t,this.phi=e,this.theta=i,this}set(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+e*e+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,i),this.phi=Math.acos(ge(e/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Oi}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Oi);const Vi={type:"change"},xi={type:"start"},Li={type:"end"},Je=new Sn,Wi=new Ln,Wn=Math.cos(70*bn.DEG2RAD);class On extends wi{constructor(t,e){super(),this.object=t,this.domElement=e,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new Et,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Le.ROTATE,MIDDLE:Le.DOLLY,RIGHT:Le.PAN},this.touches={ONE:We.ROTATE,TWO:We.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(S){S.addEventListener("keydown",Vt),this._domElementKeyEvents=S},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",Vt),this._domElementKeyEvents=null},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(Vi),i.update(),l=d.NONE},this.update=function(){const S=new Et,vt=new Ve().setFromUnitVectors(t.up,new Et(0,1,0)),Ft=vt.clone().invert(),Wt=new Et,Ut=new Ve,Zt=new Et,Gt=2*Math.PI;return function(pe=null){const ne=i.object.position;S.copy(ne).sub(i.target),S.applyQuaternion(vt),a.setFromVector3(S),i.autoRotate&&l===d.NONE&&z(Y(pe)),i.enableDamping?(a.theta+=s.theta*i.dampingFactor,a.phi+=s.phi*i.dampingFactor):(a.theta+=s.theta,a.phi+=s.phi);let kt=i.minAzimuthAngle,Qt=i.maxAzimuthAngle;isFinite(kt)&&isFinite(Qt)&&(kt<-Math.PI?kt+=Gt:kt>Math.PI&&(kt-=Gt),Qt<-Math.PI?Qt+=Gt:Qt>Math.PI&&(Qt-=Gt),kt<=Qt?a.theta=Math.max(kt,Math.min(Qt,a.theta)):a.theta=a.theta>(kt+Qt)/2?Math.max(kt,a.theta):Math.min(Qt,a.theta)),a.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,a.phi)),a.makeSafe(),i.enableDamping===!0?i.target.addScaledVector(o,i.dampingFactor):i.target.add(o),i.zoomToCursor&&k||i.object.isOrthographicCamera?a.radius=j(a.radius):a.radius=j(a.radius*c),S.setFromSpherical(a),S.applyQuaternion(Ft),ne.copy(i.target).add(S),i.object.lookAt(i.target),i.enableDamping===!0?(s.theta*=1-i.dampingFactor,s.phi*=1-i.dampingFactor,o.multiplyScalar(1-i.dampingFactor)):(s.set(0,0,0),o.set(0,0,0));let de=!1;if(i.zoomToCursor&&k){let ae=null;if(i.object.isPerspectiveCamera){const fe=S.length();ae=j(fe*c);const xe=fe-ae;i.object.position.addScaledVector(x,xe),i.object.updateMatrixWorld()}else if(i.object.isOrthographicCamera){const fe=new Et(E.x,E.y,0);fe.unproject(i.object),i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/c)),i.object.updateProjectionMatrix(),de=!0;const xe=new Et(E.x,E.y,0);xe.unproject(i.object),i.object.position.sub(xe).add(fe),i.object.updateMatrixWorld(),ae=S.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),i.zoomToCursor=!1;ae!==null&&(this.screenSpacePanning?i.target.set(0,0,-1).transformDirection(i.object.matrix).multiplyScalar(ae).add(i.object.position):(Je.origin.copy(i.object.position),Je.direction.set(0,0,-1).transformDirection(i.object.matrix),Math.abs(i.object.up.dot(Je.direction))<Wn?t.lookAt(i.target):(Wi.setFromNormalAndCoplanarPoint(i.object.up,i.target),Je.intersectPlane(Wi,i.target))))}else i.object.isOrthographicCamera&&(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/c)),i.object.updateProjectionMatrix(),de=!0);return c=1,k=!1,de||Wt.distanceToSquared(i.object.position)>r||8*(1-Ut.dot(i.object.quaternion))>r||Zt.distanceToSquared(i.target)>0?(i.dispatchEvent(Vi),Wt.copy(i.object.position),Ut.copy(i.object.quaternion),Zt.copy(i.target),de=!1,!0):!1}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",Tt),i.domElement.removeEventListener("pointerdown",xt),i.domElement.removeEventListener("pointercancel",pt),i.domElement.removeEventListener("wheel",Pt),i.domElement.removeEventListener("pointermove",Nt),i.domElement.removeEventListener("pointerup",pt),i._domElementKeyEvents!==null&&(i._domElementKeyEvents.removeEventListener("keydown",Vt),i._domElementKeyEvents=null)};const i=this,d={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let l=d.NONE;const r=1e-6,a=new Ii,s=new Ii;let c=1;const o=new Et,n=new ee,h=new ee,u=new ee,p=new ee,f=new ee,v=new ee,m=new ee,y=new ee,g=new ee,x=new Et,E=new ee;let k=!1;const L=[],N={};function Y(S){return S!==null?2*Math.PI/60*i.autoRotateSpeed*S:2*Math.PI/60/60*i.autoRotateSpeed}function R(){return Math.pow(.95,i.zoomSpeed)}function z(S){s.theta-=S}function I(S){s.phi-=S}const V=function(){const S=new Et;return function(Ft,Wt){S.setFromMatrixColumn(Wt,0),S.multiplyScalar(-Ft),o.add(S)}}(),et=function(){const S=new Et;return function(Ft,Wt){i.screenSpacePanning===!0?S.setFromMatrixColumn(Wt,1):(S.setFromMatrixColumn(Wt,0),S.crossVectors(i.object.up,S)),S.multiplyScalar(Ft),o.add(S)}}(),K=function(){const S=new Et;return function(Ft,Wt){const Ut=i.domElement;if(i.object.isPerspectiveCamera){const Zt=i.object.position;S.copy(Zt).sub(i.target);let Gt=S.length();Gt*=Math.tan(i.object.fov/2*Math.PI/180),V(2*Ft*Gt/Ut.clientHeight,i.object.matrix),et(2*Wt*Gt/Ut.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(V(Ft*(i.object.right-i.object.left)/i.object.zoom/Ut.clientWidth,i.object.matrix),et(Wt*(i.object.top-i.object.bottom)/i.object.zoom/Ut.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function ft(S){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?c/=S:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function _(S){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?c*=S:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function C(S){if(!i.zoomToCursor)return;k=!0;const vt=i.domElement.getBoundingClientRect(),Ft=S.clientX-vt.left,Wt=S.clientY-vt.top,Ut=vt.width,Zt=vt.height;E.x=Ft/Ut*2-1,E.y=-(Wt/Zt)*2+1,x.set(E.x,E.y,1).unproject(i.object).sub(i.object.position).normalize()}function j(S){return Math.max(i.minDistance,Math.min(i.maxDistance,S))}function H(S){n.set(S.clientX,S.clientY)}function A(S){C(S),m.set(S.clientX,S.clientY)}function F(S){p.set(S.clientX,S.clientY)}function M(S){h.set(S.clientX,S.clientY),u.subVectors(h,n).multiplyScalar(i.rotateSpeed);const vt=i.domElement;z(2*Math.PI*u.x/vt.clientHeight),I(2*Math.PI*u.y/vt.clientHeight),n.copy(h),i.update()}function b(S){y.set(S.clientX,S.clientY),g.subVectors(y,m),g.y>0?ft(R()):g.y<0&&_(R()),m.copy(y),i.update()}function w(S){f.set(S.clientX,S.clientY),v.subVectors(f,p).multiplyScalar(i.panSpeed),K(v.x,v.y),p.copy(f),i.update()}function B(S){C(S),S.deltaY<0?_(R()):S.deltaY>0&&ft(R()),i.update()}function X(S){let vt=!1;switch(S.code){case i.keys.UP:S.ctrlKey||S.metaKey||S.shiftKey?I(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):K(0,i.keyPanSpeed),vt=!0;break;case i.keys.BOTTOM:S.ctrlKey||S.metaKey||S.shiftKey?I(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):K(0,-i.keyPanSpeed),vt=!0;break;case i.keys.LEFT:S.ctrlKey||S.metaKey||S.shiftKey?z(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):K(i.keyPanSpeed,0),vt=!0;break;case i.keys.RIGHT:S.ctrlKey||S.metaKey||S.shiftKey?z(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):K(-i.keyPanSpeed,0),vt=!0;break}vt&&(S.preventDefault(),i.update())}function q(){if(L.length===1)n.set(L[0].pageX,L[0].pageY);else{const S=.5*(L[0].pageX+L[1].pageX),vt=.5*(L[0].pageY+L[1].pageY);n.set(S,vt)}}function T(){if(L.length===1)p.set(L[0].pageX,L[0].pageY);else{const S=.5*(L[0].pageX+L[1].pageX),vt=.5*(L[0].pageY+L[1].pageY);p.set(S,vt)}}function D(){const S=L[0].pageX-L[1].pageX,vt=L[0].pageY-L[1].pageY,Ft=Math.sqrt(S*S+vt*vt);m.set(0,Ft)}function J(){i.enableZoom&&D(),i.enablePan&&T()}function mt(){i.enableZoom&&D(),i.enableRotate&&q()}function ut(S){if(L.length==1)h.set(S.pageX,S.pageY);else{const Ft=ue(S),Wt=.5*(S.pageX+Ft.x),Ut=.5*(S.pageY+Ft.y);h.set(Wt,Ut)}u.subVectors(h,n).multiplyScalar(i.rotateSpeed);const vt=i.domElement;z(2*Math.PI*u.x/vt.clientHeight),I(2*Math.PI*u.y/vt.clientHeight),n.copy(h)}function at(S){if(L.length===1)f.set(S.pageX,S.pageY);else{const vt=ue(S),Ft=.5*(S.pageX+vt.x),Wt=.5*(S.pageY+vt.y);f.set(Ft,Wt)}v.subVectors(f,p).multiplyScalar(i.panSpeed),K(v.x,v.y),p.copy(f)}function G(S){const vt=ue(S),Ft=S.pageX-vt.x,Wt=S.pageY-vt.y,Ut=Math.sqrt(Ft*Ft+Wt*Wt);y.set(0,Ut),g.set(0,Math.pow(y.y/m.y,i.zoomSpeed)),ft(g.y),m.copy(y)}function $(S){i.enableZoom&&G(S),i.enablePan&&at(S)}function Ct(S){i.enableZoom&&G(S),i.enableRotate&&ut(S)}function xt(S){i.enabled!==!1&&(L.length===0&&(i.domElement.setPointerCapture(S.pointerId),i.domElement.addEventListener("pointermove",Nt),i.domElement.addEventListener("pointerup",pt)),Yt(S),S.pointerType==="touch"?Bt(S):Rt(S))}function Nt(S){i.enabled!==!1&&(S.pointerType==="touch"?Lt(S):It(S))}function pt(S){Jt(S),L.length===0&&(i.domElement.releasePointerCapture(S.pointerId),i.domElement.removeEventListener("pointermove",Nt),i.domElement.removeEventListener("pointerup",pt)),i.dispatchEvent(Li),l=d.NONE}function Rt(S){let vt;switch(S.button){case 0:vt=i.mouseButtons.LEFT;break;case 1:vt=i.mouseButtons.MIDDLE;break;case 2:vt=i.mouseButtons.RIGHT;break;default:vt=-1}switch(vt){case Le.DOLLY:if(i.enableZoom===!1)return;A(S),l=d.DOLLY;break;case Le.ROTATE:if(S.ctrlKey||S.metaKey||S.shiftKey){if(i.enablePan===!1)return;F(S),l=d.PAN}else{if(i.enableRotate===!1)return;H(S),l=d.ROTATE}break;case Le.PAN:if(S.ctrlKey||S.metaKey||S.shiftKey){if(i.enableRotate===!1)return;H(S),l=d.ROTATE}else{if(i.enablePan===!1)return;F(S),l=d.PAN}break;default:l=d.NONE}l!==d.NONE&&i.dispatchEvent(xi)}function It(S){switch(l){case d.ROTATE:if(i.enableRotate===!1)return;M(S);break;case d.DOLLY:if(i.enableZoom===!1)return;b(S);break;case d.PAN:if(i.enablePan===!1)return;w(S);break}}function Pt(S){i.enabled===!1||i.enableZoom===!1||l!==d.NONE||(S.preventDefault(),i.dispatchEvent(xi),B(S),i.dispatchEvent(Li))}function Vt(S){i.enabled===!1||i.enablePan===!1||X(S)}function Bt(S){switch(ce(S),L.length){case 1:switch(i.touches.ONE){case We.ROTATE:if(i.enableRotate===!1)return;q(),l=d.TOUCH_ROTATE;break;case We.PAN:if(i.enablePan===!1)return;T(),l=d.TOUCH_PAN;break;default:l=d.NONE}break;case 2:switch(i.touches.TWO){case We.DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;J(),l=d.TOUCH_DOLLY_PAN;break;case We.DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;mt(),l=d.TOUCH_DOLLY_ROTATE;break;default:l=d.NONE}break;default:l=d.NONE}l!==d.NONE&&i.dispatchEvent(xi)}function Lt(S){switch(ce(S),l){case d.TOUCH_ROTATE:if(i.enableRotate===!1)return;ut(S),i.update();break;case d.TOUCH_PAN:if(i.enablePan===!1)return;at(S),i.update();break;case d.TOUCH_DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;$(S),i.update();break;case d.TOUCH_DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;Ct(S),i.update();break;default:l=d.NONE}}function Tt(S){i.enabled!==!1&&S.preventDefault()}function Yt(S){L.push(S)}function Jt(S){delete N[S.pointerId];for(let vt=0;vt<L.length;vt++)if(L[vt].pointerId==S.pointerId){L.splice(vt,1);return}}function ce(S){let vt=N[S.pointerId];vt===void 0&&(vt=new ee,N[S.pointerId]=vt),vt.set(S.pageX,S.pageY)}function ue(S){const vt=S.pointerId===L[0].pointerId?L[1]:L[0];return N[vt.pointerId]}i.domElement.addEventListener("contextmenu",Tt),i.domElement.addEventListener("pointerdown",xt),i.domElement.addEventListener("pointercancel",pt),i.domElement.addEventListener("wheel",Pt,{passive:!1}),this.update()}}function $e(O){throw new Error('Could not dynamically require "'+O+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Yi={exports:{}};(function(O,t){(function(e){O.exports=e()})(function(){return function e(i,d,l){function r(c,o){if(!d[c]){if(!i[c]){var n=typeof $e=="function"&&$e;if(!o&&n)return n(c,!0);if(a)return a(c,!0);throw new Error("Cannot find module '"+c+"'")}var h=d[c]={exports:{}};i[c][0].call(h.exports,function(u){var p=i[c][1][u];return r(p||u)},h,h.exports,e,i,d,l)}return d[c].exports}for(var a=typeof $e=="function"&&$e,s=0;s<l.length;s++)r(l[s]);return r}({1:[function(e,i,d){i.exports={name:"cannon",version:"0.6.2",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./build/cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(e,i,d){i.exports={version:e("../package.json").version,AABB:e("./collision/AABB"),ArrayCollisionMatrix:e("./collision/ArrayCollisionMatrix"),Body:e("./objects/Body"),Box:e("./shapes/Box"),Broadphase:e("./collision/Broadphase"),Constraint:e("./constraints/Constraint"),ContactEquation:e("./equations/ContactEquation"),Narrowphase:e("./world/Narrowphase"),ConeTwistConstraint:e("./constraints/ConeTwistConstraint"),ContactMaterial:e("./material/ContactMaterial"),ConvexPolyhedron:e("./shapes/ConvexPolyhedron"),Cylinder:e("./shapes/Cylinder"),DistanceConstraint:e("./constraints/DistanceConstraint"),Equation:e("./equations/Equation"),EventTarget:e("./utils/EventTarget"),FrictionEquation:e("./equations/FrictionEquation"),GSSolver:e("./solver/GSSolver"),GridBroadphase:e("./collision/GridBroadphase"),Heightfield:e("./shapes/Heightfield"),HingeConstraint:e("./constraints/HingeConstraint"),LockConstraint:e("./constraints/LockConstraint"),Mat3:e("./math/Mat3"),Material:e("./material/Material"),NaiveBroadphase:e("./collision/NaiveBroadphase"),ObjectCollisionMatrix:e("./collision/ObjectCollisionMatrix"),Pool:e("./utils/Pool"),Particle:e("./shapes/Particle"),Plane:e("./shapes/Plane"),PointToPointConstraint:e("./constraints/PointToPointConstraint"),Quaternion:e("./math/Quaternion"),Ray:e("./collision/Ray"),RaycastVehicle:e("./objects/RaycastVehicle"),RaycastResult:e("./collision/RaycastResult"),RigidVehicle:e("./objects/RigidVehicle"),RotationalEquation:e("./equations/RotationalEquation"),RotationalMotorEquation:e("./equations/RotationalMotorEquation"),SAPBroadphase:e("./collision/SAPBroadphase"),SPHSystem:e("./objects/SPHSystem"),Shape:e("./shapes/Shape"),Solver:e("./solver/Solver"),Sphere:e("./shapes/Sphere"),SplitSolver:e("./solver/SplitSolver"),Spring:e("./objects/Spring"),Trimesh:e("./shapes/Trimesh"),Vec3:e("./math/Vec3"),Vec3Pool:e("./utils/Vec3Pool"),World:e("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":9,"./collision/RaycastResult":10,"./collision/SAPBroadphase":11,"./constraints/ConeTwistConstraint":12,"./constraints/Constraint":13,"./constraints/DistanceConstraint":14,"./constraints/HingeConstraint":15,"./constraints/LockConstraint":16,"./constraints/PointToPointConstraint":17,"./equations/ContactEquation":19,"./equations/Equation":20,"./equations/FrictionEquation":21,"./equations/RotationalEquation":22,"./equations/RotationalMotorEquation":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/Mat3":27,"./math/Quaternion":28,"./math/Vec3":30,"./objects/Body":31,"./objects/RaycastVehicle":32,"./objects/RigidVehicle":33,"./objects/SPHSystem":34,"./objects/Spring":35,"./shapes/Box":37,"./shapes/ConvexPolyhedron":38,"./shapes/Cylinder":39,"./shapes/Heightfield":40,"./shapes/Particle":41,"./shapes/Plane":42,"./shapes/Shape":43,"./shapes/Sphere":44,"./shapes/Trimesh":45,"./solver/GSSolver":46,"./solver/Solver":47,"./solver/SplitSolver":48,"./utils/EventTarget":49,"./utils/Pool":51,"./utils/Vec3Pool":54,"./world/Narrowphase":55,"./world/World":56}],3:[function(e,i,d){var l=e("../math/Vec3");e("../utils/Utils"),i.exports=r;function r(c){c=c||{},this.lowerBound=new l,c.lowerBound&&this.lowerBound.copy(c.lowerBound),this.upperBound=new l,c.upperBound&&this.upperBound.copy(c.upperBound)}var a=new l;r.prototype.setFromPoints=function(c,o,n,h){var u=this.lowerBound,p=this.upperBound,f=n;u.copy(c[0]),f&&f.vmult(u,u),p.copy(u);for(var v=1;v<c.length;v++){var m=c[v];f&&(f.vmult(m,a),m=a),m.x>p.x&&(p.x=m.x),m.x<u.x&&(u.x=m.x),m.y>p.y&&(p.y=m.y),m.y<u.y&&(u.y=m.y),m.z>p.z&&(p.z=m.z),m.z<u.z&&(u.z=m.z)}return o&&(o.vadd(u,u),o.vadd(p,p)),h&&(u.x-=h,u.y-=h,u.z-=h,p.x+=h,p.y+=h,p.z+=h),this},r.prototype.copy=function(c){return this.lowerBound.copy(c.lowerBound),this.upperBound.copy(c.upperBound),this},r.prototype.clone=function(){return new r().copy(this)},r.prototype.extend=function(c){var o=c.lowerBound.x;this.lowerBound.x>o&&(this.lowerBound.x=o);var n=c.upperBound.x;this.upperBound.x<n&&(this.upperBound.x=n);var o=c.lowerBound.y;this.lowerBound.y>o&&(this.lowerBound.y=o);var n=c.upperBound.y;this.upperBound.y<n&&(this.upperBound.y=n);var o=c.lowerBound.z;this.lowerBound.z>o&&(this.lowerBound.z=o);var n=c.upperBound.z;this.upperBound.z<n&&(this.upperBound.z=n)},r.prototype.overlaps=function(c){var o=this.lowerBound,n=this.upperBound,h=c.lowerBound,u=c.upperBound;return(h.x<=n.x&&n.x<=u.x||o.x<=u.x&&u.x<=n.x)&&(h.y<=n.y&&n.y<=u.y||o.y<=u.y&&u.y<=n.y)&&(h.z<=n.z&&n.z<=u.z||o.z<=u.z&&u.z<=n.z)},r.prototype.contains=function(c){var o=this.lowerBound,n=this.upperBound,h=c.lowerBound,u=c.upperBound;return o.x<=h.x&&n.x>=u.x&&o.y<=h.y&&n.y>=u.y&&o.z<=h.z&&n.z>=u.z},r.prototype.getCorners=function(c,o,n,h,u,p,f,v){var m=this.lowerBound,y=this.upperBound;c.copy(m),o.set(y.x,m.y,m.z),n.set(y.x,y.y,m.z),h.set(m.x,y.y,y.z),u.set(y.x,m.y,m.z),p.set(m.x,y.y,m.z),f.set(m.x,m.y,y.z),v.copy(y)};var s=[new l,new l,new l,new l,new l,new l,new l,new l];r.prototype.toLocalFrame=function(c,o){var n=s,h=n[0],u=n[1],p=n[2],f=n[3],v=n[4],m=n[5],y=n[6],g=n[7];this.getCorners(h,u,p,f,v,m,y,g);for(var x=0;x!==8;x++){var E=n[x];c.pointToLocal(E,E)}return o.setFromPoints(n)},r.prototype.toWorldFrame=function(c,o){var n=s,h=n[0],u=n[1],p=n[2],f=n[3],v=n[4],m=n[5],y=n[6],g=n[7];this.getCorners(h,u,p,f,v,m,y,g);for(var x=0;x!==8;x++){var E=n[x];c.pointToWorld(E,E)}return o.setFromPoints(n)}},{"../math/Vec3":30,"../utils/Utils":53}],4:[function(e,i,d){i.exports=l;function l(){this.matrix=[]}l.prototype.get=function(r,a){if(r=r.index,a=a.index,a>r){var s=a;a=r,r=s}return this.matrix[(r*(r+1)>>1)+a-1]},l.prototype.set=function(r,a,s){if(r=r.index,a=a.index,a>r){var c=a;a=r,r=c}this.matrix[(r*(r+1)>>1)+a-1]=s?1:0},l.prototype.reset=function(){for(var r=0,a=this.matrix.length;r!==a;r++)this.matrix[r]=0},l.prototype.setNumObjects=function(r){this.matrix.length=r*(r-1)>>1}},{}],5:[function(e,i,d){var l=e("../objects/Body"),r=e("../math/Vec3"),a=e("../math/Quaternion");e("../shapes/Shape"),e("../shapes/Plane"),i.exports=s;function s(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}s.prototype.collisionPairs=function(f,v,m){throw new Error("collisionPairs not implemented for this BroadPhase class!")};var c=l.STATIC|l.KINEMATIC;s.prototype.needBroadphaseCollision=function(f,v){return!(!(f.collisionFilterGroup&v.collisionFilterMask)||!(v.collisionFilterGroup&f.collisionFilterMask)||(f.type&c||f.sleepState===l.SLEEPING)&&(v.type&c||v.sleepState===l.SLEEPING))},s.prototype.intersectionTest=function(f,v,m,y){this.useBoundingBoxes?this.doBoundingBoxBroadphase(f,v,m,y):this.doBoundingSphereBroadphase(f,v,m,y)};var o=new r;new r,new a,new r,s.prototype.doBoundingSphereBroadphase=function(f,v,m,y){var g=o;v.position.vsub(f.position,g);var x=Math.pow(f.boundingRadius+v.boundingRadius,2),E=g.norm2();E<x&&(m.push(f),y.push(v))},s.prototype.doBoundingBoxBroadphase=function(f,v,m,y){f.aabbNeedsUpdate&&f.computeAABB(),v.aabbNeedsUpdate&&v.computeAABB(),f.aabb.overlaps(v.aabb)&&(m.push(f),y.push(v))};var n={keys:[]},h=[],u=[];s.prototype.makePairsUnique=function(f,v){for(var m=n,y=h,g=u,x=f.length,E=0;E!==x;E++)y[E]=f[E],g[E]=v[E];f.length=0,v.length=0;for(var E=0;E!==x;E++){var k=y[E].id,L=g[E].id,N=k<L?k+","+L:L+","+k;m[N]=E,m.keys.push(N)}for(var E=0;E!==m.keys.length;E++){var N=m.keys.pop(),Y=m[N];f.push(y[Y]),v.push(g[Y]),delete m[N]}},s.prototype.setWorld=function(f){};var p=new r;s.boundingSphereCheck=function(f,v){var m=p;return f.position.vsub(v.position,m),Math.pow(f.shape.boundingSphereRadius+v.shape.boundingSphereRadius,2)>m.norm2()},s.prototype.aabbQuery=function(f,v,m){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Plane":42,"../shapes/Shape":43}],6:[function(e,i,d){i.exports=s;var l=e("./Broadphase"),r=e("../math/Vec3"),a=e("../shapes/Shape");function s(o,n,h,u,p){l.apply(this),this.nx=h||10,this.ny=u||10,this.nz=p||10,this.aabbMin=o||new r(100,100,100),this.aabbMax=n||new r(-100,-100,-100);var f=this.nx*this.ny*this.nz;if(f<=0)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[],this.binLengths=[],this.bins.length=f,this.binLengths.length=f;for(var v=0;v<f;v++)this.bins[v]=[],this.binLengths[v]=0}s.prototype=new l,s.prototype.constructor=s;var c=new r;new r,s.prototype.collisionPairs=function(o,n,h){var u=o.numObjects(),p=o.bodies,X=this.aabbMax,B=this.aabbMin,f=this.nx,v=this.ny,m=this.nz,y=v*m,g=m,x=1,E=X.x,k=X.y,L=X.z,N=B.x,Y=B.y,R=B.z,z=f/(E-N),I=v/(k-Y),V=m/(L-R),et=(E-N)/f,K=(k-Y)/v,ft=(L-R)/m,_=Math.sqrt(et*et+K*K+ft*ft)*.5,C=a.types,j=C.SPHERE,H=C.PLANE;C.BOX,C.COMPOUND,C.CONVEXPOLYHEDRON;for(var A=this.bins,F=this.binLengths,M=this.bins.length,b=0;b!==M;b++)F[b]=0;var w=Math.ceil,B=Math.min,X=Math.max;function q(ce,ue,S,vt,Ft,Wt,Ut){var Zt=(ce-N)*z|0,Gt=(ue-Y)*I|0,ie=(S-R)*V|0,pe=w((vt-N)*z),ne=w((Ft-Y)*I),kt=w((Wt-R)*V);Zt<0?Zt=0:Zt>=f&&(Zt=f-1),Gt<0?Gt=0:Gt>=v&&(Gt=v-1),ie<0?ie=0:ie>=m&&(ie=m-1),pe<0?pe=0:pe>=f&&(pe=f-1),ne<0?ne=0:ne>=v&&(ne=v-1),kt<0?kt=0:kt>=m&&(kt=m-1),Zt*=y,Gt*=g,ie*=x,pe*=y,ne*=g,kt*=x;for(var Qt=Zt;Qt<=pe;Qt+=y)for(var de=Gt;de<=ne;de+=g)for(var ae=ie;ae<=kt;ae+=x){var fe=Qt+de+ae;A[fe][F[fe]++]=Ut}}for(var b=0;b!==u;b++){var T=p[b],D=T.shape;switch(D.type){case j:var J=T.position.x,mt=T.position.y,ut=T.position.z,at=D.radius;q(J-at,mt-at,ut-at,J+at,mt+at,ut+at,T);break;case H:D.worldNormalNeedsUpdate&&D.computeWorldNormal(T.quaternion);var G=D.worldNormal,$=N+et*.5-T.position.x,Ct=Y+K*.5-T.position.y,xt=R+ft*.5-T.position.z,Nt=c;Nt.set($,Ct,xt);for(var pt=0,Rt=0;pt!==f;pt++,Rt+=y,Nt.y=Ct,Nt.x+=et)for(var It=0,Pt=0;It!==v;It++,Pt+=g,Nt.z=xt,Nt.y+=K)for(var Vt=0,Bt=0;Vt!==m;Vt++,Bt+=x,Nt.z+=ft)if(Nt.dot(G)<_){var Lt=Rt+Pt+Bt;A[Lt][F[Lt]++]=T}break;default:T.aabbNeedsUpdate&&T.computeAABB(),q(T.aabb.lowerBound.x,T.aabb.lowerBound.y,T.aabb.lowerBound.z,T.aabb.upperBound.x,T.aabb.upperBound.y,T.aabb.upperBound.z,T);break}}for(var b=0;b!==M;b++){var Tt=F[b];if(Tt>1)for(var Yt=A[b],pt=0;pt!==Tt;pt++)for(var T=Yt[pt],It=0;It!==pt;It++){var Jt=Yt[It];this.needBroadphaseCollision(T,Jt)&&this.intersectionTest(T,Jt,n,h)}}this.makePairsUnique(n,h)}},{"../math/Vec3":30,"../shapes/Shape":43,"./Broadphase":5}],7:[function(e,i,d){i.exports=a;var l=e("./Broadphase"),r=e("./AABB");function a(){l.apply(this)}a.prototype=new l,a.prototype.constructor=a,a.prototype.collisionPairs=function(s,c,o){var n=s.bodies,h=n.length,u,p,f,v;for(u=0;u!==h;u++)for(p=0;p!==u;p++)f=n[u],v=n[p],this.needBroadphaseCollision(f,v)&&this.intersectionTest(f,v,c,o)},new r,a.prototype.aabbQuery=function(s,c,o){o=o||[];for(var n=0;n<s.bodies.length;n++){var h=s.bodies[n];h.aabbNeedsUpdate&&h.computeAABB(),h.aabb.overlaps(c)&&o.push(h)}return o}},{"./AABB":3,"./Broadphase":5}],8:[function(e,i,d){i.exports=l;function l(){this.matrix={}}l.prototype.get=function(r,a){if(r=r.id,a=a.id,a>r){var s=a;a=r,r=s}return r+"-"+a in this.matrix},l.prototype.set=function(r,a,s){if(r=r.id,a=a.id,a>r){var c=a;a=r,r=c}s?this.matrix[r+"-"+a]=!0:delete this.matrix[r+"-"+a]},l.prototype.reset=function(){this.matrix={}},l.prototype.setNumObjects=function(r){}},{}],9:[function(e,i,d){i.exports=n;var l=e("../math/Vec3"),r=e("../math/Quaternion"),a=e("../math/Transform");e("../shapes/ConvexPolyhedron"),e("../shapes/Box");var s=e("../collision/RaycastResult"),c=e("../shapes/Shape"),o=e("../collision/AABB");function n(M,b){this.from=M?M.clone():new l,this.to=b?b.clone():new l,this._direction=new l,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=n.ANY,this.result=new s,this.hasHit=!1,this.callback=function(w){}}n.prototype.constructor=n,n.CLOSEST=1,n.ANY=2,n.ALL=4;var h=new o,u=[];n.prototype.intersectWorld=function(M,b){return this.mode=b.mode||n.ANY,this.result=b.result||new s,this.skipBackfaces=!!b.skipBackfaces,this.collisionFilterMask=typeof b.collisionFilterMask<"u"?b.collisionFilterMask:-1,this.collisionFilterGroup=typeof b.collisionFilterGroup<"u"?b.collisionFilterGroup:-1,b.from&&this.from.copy(b.from),b.to&&this.to.copy(b.to),this.callback=b.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),this.getAABB(h),u.length=0,M.broadphase.aabbQuery(M,h,u),this.intersectBodies(u),this.hasHit};var p=new l,f=new l;n.pointInTriangle=v;function v(M,b,w,B){B.vsub(b,H),w.vsub(b,p),M.vsub(b,f);var X=H.dot(H),q=H.dot(p),T=H.dot(f),D=p.dot(p),J=p.dot(f),mt,ut;return(mt=D*T-q*J)>=0&&(ut=X*J-q*T)>=0&&mt+ut<X*D-q*q}var m=new l,y=new r;n.prototype.intersectBody=function(M,b){b&&(this.result=b,this._updateDirection());var w=this.checkCollisionResponse;if(!(w&&!M.collisionResponse)&&!(!(this.collisionFilterGroup&M.collisionFilterMask)||!(M.collisionFilterGroup&this.collisionFilterMask)))for(var B=m,X=y,q=0,T=M.shapes.length;q<T;q++){var D=M.shapes[q];if(!(w&&!D.collisionResponse)&&(M.quaternion.mult(M.shapeOrientations[q],X),M.quaternion.vmult(M.shapeOffsets[q],B),B.vadd(M.position,B),this.intersectShape(D,X,B,M),this.result._shouldStop))break}},n.prototype.intersectBodies=function(M,b){b&&(this.result=b,this._updateDirection());for(var w=0,B=M.length;!this.result._shouldStop&&w<B;w++)this.intersectBody(M[w])},n.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction),this._direction.normalize()},n.prototype.intersectShape=function(M,b,w,B){var X=this.from,q=F(X,this._direction,w);if(!(q>M.boundingSphereRadius)){var T=this[M.type];T&&T.call(this,M,b,w,B)}},new l,new l;var g=new l,x=new l,E=new l,k=new l;new l,new s,n.prototype.intersectBox=function(M,b,w,B){return this.intersectConvex(M.convexPolyhedronRepresentation,b,w,B)},n.prototype[c.types.BOX]=n.prototype.intersectBox,n.prototype.intersectPlane=function(M,b,w,B){var X=this.from,q=this.to,T=this._direction,D=new l(0,0,1);b.vmult(D,D);var J=new l;X.vsub(w,J);var mt=J.dot(D);q.vsub(w,J);var ut=J.dot(D);if(!(mt*ut>0)&&!(X.distanceTo(q)<mt)){var at=D.dot(T);if(!(Math.abs(at)<this.precision)){var G=new l,$=new l,Ct=new l;X.vsub(w,G);var xt=-D.dot(G)/at;T.scale(xt,$),X.vadd($,Ct),this.reportIntersection(D,Ct,M,B,-1)}}},n.prototype[c.types.PLANE]=n.prototype.intersectPlane,n.prototype.getAABB=function(M){var b=this.to,w=this.from;M.lowerBound.x=Math.min(b.x,w.x),M.lowerBound.y=Math.min(b.y,w.y),M.lowerBound.z=Math.min(b.z,w.z),M.upperBound.x=Math.max(b.x,w.x),M.upperBound.y=Math.max(b.y,w.y),M.upperBound.z=Math.max(b.z,w.z)};var L={faceList:[0]};n.prototype.intersectHeightfield=function(M,b,w,B){M.data,M.elementSize;var X=new l,q=new n(this.from,this.to);a.pointToLocalFrame(w,b,q.from,q.from),a.pointToLocalFrame(w,b,q.to,q.to);var T=[],D=null,J=null,mt=null,ut=null,at=M.getIndexOfPosition(q.from.x,q.from.y,T,!1);if(at&&(D=T[0],J=T[1],mt=T[0],ut=T[1]),at=M.getIndexOfPosition(q.to.x,q.to.y,T,!1),at&&((D===null||T[0]<D)&&(D=T[0]),(mt===null||T[0]>mt)&&(mt=T[0]),(J===null||T[1]<J)&&(J=T[1]),(ut===null||T[1]>ut)&&(ut=T[1])),D!==null){var G=[];M.getRectMinMax(D,J,mt,ut,G),G[0],G[1];for(var $=D;$<=mt;$++)for(var Ct=J;Ct<=ut;Ct++){if(this.result._shouldStop||(M.getConvexTrianglePillar($,Ct,!1),a.pointToWorldFrame(w,b,M.pillarOffset,X),this.intersectConvex(M.pillarConvex,b,X,B,L),this.result._shouldStop))return;M.getConvexTrianglePillar($,Ct,!0),a.pointToWorldFrame(w,b,M.pillarOffset,X),this.intersectConvex(M.pillarConvex,b,X,B,L)}}},n.prototype[c.types.HEIGHTFIELD]=n.prototype.intersectHeightfield;var N=new l,Y=new l;n.prototype.intersectSphere=function(M,b,w,B){var X=this.from,q=this.to,T=M.radius,D=Math.pow(q.x-X.x,2)+Math.pow(q.y-X.y,2)+Math.pow(q.z-X.z,2),J=2*((q.x-X.x)*(X.x-w.x)+(q.y-X.y)*(X.y-w.y)+(q.z-X.z)*(X.z-w.z)),mt=Math.pow(X.x-w.x,2)+Math.pow(X.y-w.y,2)+Math.pow(X.z-w.z,2)-Math.pow(T,2),ut=Math.pow(J,2)-4*D*mt,at=N,G=Y;if(!(ut<0))if(ut===0)X.lerp(q,ut,at),at.vsub(w,G),G.normalize(),this.reportIntersection(G,at,M,B,-1);else{var $=(-J-Math.sqrt(ut))/(2*D),Ct=(-J+Math.sqrt(ut))/(2*D);if($>=0&&$<=1&&(X.lerp(q,$,at),at.vsub(w,G),G.normalize(),this.reportIntersection(G,at,M,B,-1)),this.result._shouldStop)return;Ct>=0&&Ct<=1&&(X.lerp(q,Ct,at),at.vsub(w,G),G.normalize(),this.reportIntersection(G,at,M,B,-1))}},n.prototype[c.types.SPHERE]=n.prototype.intersectSphere;var R=new l;new l,new l;var z=new l;n.prototype.intersectConvex=function(b,w,B,X,q){for(var T=R,D=z,J=q&&q.faceList||null,mt=b.faces,ut=b.vertices,at=b.faceNormals,G=this._direction,$=this.from,Ct=this.to,xt=$.distanceTo(Ct),Nt=J?J.length:mt.length,pt=this.result,Rt=0;!pt._shouldStop&&Rt<Nt;Rt++){var It=J?J[Rt]:Rt,Pt=mt[It],Vt=at[It],Bt=w,Lt=B;D.copy(ut[Pt[0]]),Bt.vmult(D,D),D.vadd(Lt,D),D.vsub($,D),Bt.vmult(Vt,T);var Tt=G.dot(T);if(!(Math.abs(Tt)<this.precision)){var Yt=T.dot(D)/Tt;if(!(Yt<0)){G.mult(Yt,g),g.vadd($,g),x.copy(ut[Pt[0]]),Bt.vmult(x,x),Lt.vadd(x,x);for(var Jt=1;!pt._shouldStop&&Jt<Pt.length-1;Jt++){E.copy(ut[Pt[Jt]]),k.copy(ut[Pt[Jt+1]]),Bt.vmult(E,E),Bt.vmult(k,k),Lt.vadd(E,E),Lt.vadd(k,k);var ce=g.distanceTo($);!(v(g,x,E,k)||v(g,E,x,k))||ce>xt||this.reportIntersection(T,g,b,X,It)}}}}},n.prototype[c.types.CONVEXPOLYHEDRON]=n.prototype.intersectConvex;var I=new l,V=new l,et=new l,K=new l,ft=new l,_=new l;new o;var C=[],j=new a;n.prototype.intersectTrimesh=function(b,w,B,X,q){var T=I,D=C,J=j,mt=z,ut=V,at=et,G=K,$=_,Ct=ft;q&&q.faceList;var xt=b.indices;b.vertices,b.faceNormals;var Nt=this.from,pt=this.to,Rt=this._direction;J.position.copy(B),J.quaternion.copy(w),a.vectorToLocalFrame(B,w,Rt,ut),a.pointToLocalFrame(B,w,Nt,at),a.pointToLocalFrame(B,w,pt,G);var It=at.distanceSquared(G);b.tree.rayQuery(this,J,D);for(var Pt=0,Vt=D.length;!this.result._shouldStop&&Pt!==Vt;Pt++){var Bt=D[Pt];b.getNormal(Bt,T),b.getVertex(xt[Bt*3],x),x.vsub(at,mt);var Lt=ut.dot(T),Tt=T.dot(mt)/Lt;if(!(Tt<0)){ut.scale(Tt,g),g.vadd(at,g),b.getVertex(xt[Bt*3+1],E),b.getVertex(xt[Bt*3+2],k);var Yt=g.distanceSquared(at);!(v(g,E,x,k)||v(g,x,E,k))||Yt>It||(a.vectorToWorldFrame(w,T,Ct),a.pointToWorldFrame(B,w,g,$),this.reportIntersection(Ct,$,b,X,Bt))}}D.length=0},n.prototype[c.types.TRIMESH]=n.prototype.intersectTrimesh,n.prototype.reportIntersection=function(M,b,w,B,X){var q=this.from,T=this.to,D=q.distanceTo(b),J=this.result;if(!(this.skipBackfaces&&M.dot(this._direction)>0))switch(J.hitFaceIndex=typeof X<"u"?X:-1,this.mode){case n.ALL:this.hasHit=!0,J.set(q,T,M,b,w,B,D),J.hasHit=!0,this.callback(J);break;case n.CLOSEST:(D<J.distance||!J.hasHit)&&(this.hasHit=!0,J.hasHit=!0,J.set(q,T,M,b,w,B,D));break;case n.ANY:this.hasHit=!0,J.hasHit=!0,J.set(q,T,M,b,w,B,D),J._shouldStop=!0;break}};var H=new l,A=new l;function F(M,b,w){w.vsub(M,H);var B=H.dot(b);b.mult(B,A),A.vadd(M,A);var X=w.distanceTo(A);return X}},{"../collision/AABB":3,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/Box":37,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43}],10:[function(e,i,d){var l=e("../math/Vec3");i.exports=r;function r(){this.rayFromWorld=new l,this.rayToWorld=new l,this.hitNormalWorld=new l,this.hitPointWorld=new l,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1}r.prototype.reset=function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1},r.prototype.abort=function(){this._shouldStop=!0},r.prototype.set=function(a,s,c,o,n,h,u){this.rayFromWorld.copy(a),this.rayToWorld.copy(s),this.hitNormalWorld.copy(c),this.hitPointWorld.copy(o),this.shape=n,this.body=h,this.distance=u}},{"../math/Vec3":30}],11:[function(e,i,d){e("../shapes/Shape");var l=e("../collision/Broadphase");i.exports=r;function r(a){l.apply(this),this.axisList=[],this.world=null,this.axisIndex=0;var s=this.axisList;this._addBodyHandler=function(c){s.push(c.body)},this._removeBodyHandler=function(c){var o=s.indexOf(c.body);o!==-1&&s.splice(o,1)},a&&this.setWorld(a)}r.prototype=new l,r.prototype.setWorld=function(a){this.axisList.length=0;for(var s=0;s<a.bodies.length;s++)this.axisList.push(a.bodies[s]);a.removeEventListener("addBody",this._addBodyHandler),a.removeEventListener("removeBody",this._removeBodyHandler),a.addEventListener("addBody",this._addBodyHandler),a.addEventListener("removeBody",this._removeBodyHandler),this.world=a,this.dirty=!0},r.insertionSortX=function(a){for(var s=1,c=a.length;s<c;s++){for(var o=a[s],n=s-1;n>=0&&!(a[n].aabb.lowerBound.x<=o.aabb.lowerBound.x);n--)a[n+1]=a[n];a[n+1]=o}return a},r.insertionSortY=function(a){for(var s=1,c=a.length;s<c;s++){for(var o=a[s],n=s-1;n>=0&&!(a[n].aabb.lowerBound.y<=o.aabb.lowerBound.y);n--)a[n+1]=a[n];a[n+1]=o}return a},r.insertionSortZ=function(a){for(var s=1,c=a.length;s<c;s++){for(var o=a[s],n=s-1;n>=0&&!(a[n].aabb.lowerBound.z<=o.aabb.lowerBound.z);n--)a[n+1]=a[n];a[n+1]=o}return a},r.prototype.collisionPairs=function(a,s,c){var o=this.axisList,n=o.length,h=this.axisIndex,u,p;for(this.dirty&&(this.sortList(),this.dirty=!1),u=0;u!==n;u++){var f=o[u];for(p=u+1;p<n;p++){var v=o[p];if(this.needBroadphaseCollision(f,v)){if(!r.checkBounds(f,v,h))break;this.intersectionTest(f,v,s,c)}}}},r.prototype.sortList=function(){for(var a=this.axisList,s=this.axisIndex,c=a.length,o=0;o!==c;o++){var n=a[o];n.aabbNeedsUpdate&&n.computeAABB()}s===0?r.insertionSortX(a):s===1?r.insertionSortY(a):s===2&&r.insertionSortZ(a)},r.checkBounds=function(a,s,c){var o,n;c===0?(o=a.position.x,n=s.position.x):c===1?(o=a.position.y,n=s.position.y):c===2&&(o=a.position.z,n=s.position.z);var h=a.boundingRadius,u=s.boundingRadius,p=o+h,f=n-u;return f<p},r.prototype.autoDetectAxis=function(){for(var a=0,s=0,c=0,o=0,n=0,h=0,u=this.axisList,p=u.length,f=1/p,v=0;v!==p;v++){var m=u[v],y=m.position.x;a+=y,s+=y*y;var g=m.position.y;c+=g,o+=g*g;var x=m.position.z;n+=x,h+=x*x}var E=s-a*a*f,k=o-c*c*f,L=h-n*n*f;E>k?E>L?this.axisIndex=0:this.axisIndex=2:k>L?this.axisIndex=1:this.axisIndex=2},r.prototype.aabbQuery=function(a,s,c){c=c||[],this.dirty&&(this.sortList(),this.dirty=!1);var o=this.axisIndex,n="x";o===1&&(n="y"),o===2&&(n="z");var h=this.axisList;s.lowerBound[n],s.upperBound[n];for(var u=0;u<h.length;u++){var p=h[u];p.aabbNeedsUpdate&&p.computeAABB(),p.aabb.overlaps(s)&&c.push(p)}return c}},{"../collision/Broadphase":5,"../shapes/Shape":43}],12:[function(e,i,d){i.exports=c,e("./Constraint");var l=e("./PointToPointConstraint"),r=e("../equations/ConeEquation"),a=e("../equations/RotationalEquation");e("../equations/ContactEquation");var s=e("../math/Vec3");function c(o,n,h){h=h||{};var u=typeof h.maxForce<"u"?h.maxForce:1e6,p=h.pivotA?h.pivotA.clone():new s,f=h.pivotB?h.pivotB.clone():new s;this.axisA=h.axisA?h.axisA.clone():new s,this.axisB=h.axisB?h.axisB.clone():new s,l.call(this,o,p,n,f,u),this.collideConnected=!!h.collideConnected,this.angle=typeof h.angle<"u"?h.angle:0;var v=this.coneEquation=new r(o,n,h),m=this.twistEquation=new a(o,n,h);this.twistAngle=typeof h.twistAngle<"u"?h.twistAngle:0,v.maxForce=0,v.minForce=-u,m.maxForce=0,m.minForce=-u,this.equations.push(v,m)}c.prototype=new l,c.constructor=c,new s,new s,c.prototype.update=function(){var o=this.bodyA,n=this.bodyB,h=this.coneEquation,u=this.twistEquation;l.prototype.update.call(this),o.vectorToWorldFrame(this.axisA,h.axisA),n.vectorToWorldFrame(this.axisB,h.axisB),this.axisA.tangents(u.axisA,u.axisA),o.vectorToWorldFrame(u.axisA,u.axisA),this.axisB.tangents(u.axisB,u.axisB),n.vectorToWorldFrame(u.axisB,u.axisB),h.angle=this.angle,u.maxAngle=this.twistAngle}},{"../equations/ConeEquation":18,"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],13:[function(e,i,d){i.exports=r;var l=e("../utils/Utils");function r(a,s,c){c=l.defaults(c,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=a,this.bodyB=s,this.id=r.idCounter++,this.collideConnected=c.collideConnected,c.wakeUpBodies&&(a&&a.wakeUp(),s&&s.wakeUp())}r.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},r.prototype.enable=function(){for(var a=this.equations,s=0;s<a.length;s++)a[s].enabled=!0},r.prototype.disable=function(){for(var a=this.equations,s=0;s<a.length;s++)a[s].enabled=!1},r.idCounter=0},{"../utils/Utils":53}],14:[function(e,i,d){i.exports=a;var l=e("./Constraint"),r=e("../equations/ContactEquation");function a(s,c,o,n){l.call(this,s,c),typeof o>"u"&&(o=s.position.distanceTo(c.position)),typeof n>"u"&&(n=1e6),this.distance=o;var h=this.distanceEquation=new r(s,c);this.equations.push(h),h.minForce=-n,h.maxForce=n}a.prototype=new l,a.prototype.update=function(){var s=this.bodyA,c=this.bodyB,o=this.distanceEquation,n=this.distance*.5,h=o.ni;c.position.vsub(s.position,h),h.normalize(),h.mult(n,o.ri),h.mult(-n,o.rj)}},{"../equations/ContactEquation":19,"./Constraint":13}],15:[function(e,i,d){i.exports=c,e("./Constraint");var l=e("./PointToPointConstraint"),r=e("../equations/RotationalEquation"),a=e("../equations/RotationalMotorEquation");e("../equations/ContactEquation");var s=e("../math/Vec3");function c(h,u,p){p=p||{};var f=typeof p.maxForce<"u"?p.maxForce:1e6,v=p.pivotA?p.pivotA.clone():new s,m=p.pivotB?p.pivotB.clone():new s;l.call(this,h,v,u,m,f);var y=this.axisA=p.axisA?p.axisA.clone():new s(1,0,0);y.normalize();var g=this.axisB=p.axisB?p.axisB.clone():new s(1,0,0);g.normalize();var x=this.rotationalEquation1=new r(h,u,p),E=this.rotationalEquation2=new r(h,u,p),k=this.motorEquation=new a(h,u,f);k.enabled=!1,this.equations.push(x,E,k)}c.prototype=new l,c.constructor=c,c.prototype.enableMotor=function(){this.motorEquation.enabled=!0},c.prototype.disableMotor=function(){this.motorEquation.enabled=!1},c.prototype.setMotorSpeed=function(h){this.motorEquation.targetVelocity=h},c.prototype.setMotorMaxForce=function(h){this.motorEquation.maxForce=h,this.motorEquation.minForce=-h};var o=new s,n=new s;c.prototype.update=function(){var h=this.bodyA,u=this.bodyB,p=this.motorEquation,f=this.rotationalEquation1,v=this.rotationalEquation2,m=o,y=n,g=this.axisA,x=this.axisB;l.prototype.update.call(this),h.quaternion.vmult(g,m),u.quaternion.vmult(x,y),m.tangents(f.axisA,v.axisA),f.axisB.copy(y),v.axisB.copy(y),this.motorEquation.enabled&&(h.quaternion.vmult(this.axisA,p.axisA),u.quaternion.vmult(this.axisB,p.axisB))}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],16:[function(e,i,d){i.exports=s,e("./Constraint");var l=e("./PointToPointConstraint"),r=e("../equations/RotationalEquation");e("../equations/RotationalMotorEquation"),e("../equations/ContactEquation");var a=e("../math/Vec3");function s(c,o,n){n=n||{};var h=typeof n.maxForce<"u"?n.maxForce:1e6,u=new a,p=new a,f=new a;c.position.vadd(o.position,f),f.scale(.5,f),o.pointToLocalFrame(f,p),c.pointToLocalFrame(f,u),l.call(this,c,u,o,p,h);var v=this.rotationalEquation1=new r(c,o,n),m=this.rotationalEquation2=new r(c,o,n),y=this.rotationalEquation3=new r(c,o,n);this.equations.push(v,m,y)}s.prototype=new l,s.constructor=s,new a,new a,s.prototype.update=function(){var c=this.bodyA,o=this.bodyB;this.motorEquation;var n=this.rotationalEquation1,h=this.rotationalEquation2,u=this.rotationalEquation3;l.prototype.update.call(this),c.vectorToWorldFrame(a.UNIT_X,n.axisA),o.vectorToWorldFrame(a.UNIT_Y,n.axisB),c.vectorToWorldFrame(a.UNIT_Y,h.axisA),o.vectorToWorldFrame(a.UNIT_Z,h.axisB),c.vectorToWorldFrame(a.UNIT_Z,u.axisA),o.vectorToWorldFrame(a.UNIT_X,u.axisB)}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],17:[function(e,i,d){i.exports=s;var l=e("./Constraint"),r=e("../equations/ContactEquation"),a=e("../math/Vec3");function s(c,o,n,h,u){l.call(this,c,n),u=typeof u<"u"?u:1e6,this.pivotA=o?o.clone():new a,this.pivotB=h?h.clone():new a;var p=this.equationX=new r(c,n),f=this.equationY=new r(c,n),v=this.equationZ=new r(c,n);this.equations.push(p,f,v),p.minForce=f.minForce=v.minForce=-u,p.maxForce=f.maxForce=v.maxForce=u,p.ni.set(1,0,0),f.ni.set(0,1,0),v.ni.set(0,0,1)}s.prototype=new l,s.prototype.update=function(){var c=this.bodyA,o=this.bodyB,n=this.equationX,h=this.equationY,u=this.equationZ;c.quaternion.vmult(this.pivotA,n.ri),o.quaternion.vmult(this.pivotB,n.rj),h.ri.copy(n.ri),h.rj.copy(n.rj),u.ri.copy(n.ri),u.rj.copy(n.rj)}},{"../equations/ContactEquation":19,"../math/Vec3":30,"./Constraint":13}],18:[function(e,i,d){i.exports=a;var l=e("../math/Vec3");e("../math/Mat3");var r=e("./Equation");function a(o,n,h){h=h||{};var u=typeof h.maxForce<"u"?h.maxForce:1e6;r.call(this,o,n,-u,u),this.axisA=h.axisA?h.axisA.clone():new l(1,0,0),this.axisB=h.axisB?h.axisB.clone():new l(0,1,0),this.angle=typeof h.angle<"u"?h.angle:0}a.prototype=new r,a.prototype.constructor=a;var s=new l,c=new l;a.prototype.computeB=function(o){var n=this.a,h=this.b,u=this.axisA,p=this.axisB,f=s,v=c,m=this.jacobianElementA,y=this.jacobianElementB;u.cross(p,f),p.cross(u,v),m.rotational.copy(v),y.rotational.copy(f);var g=Math.cos(this.angle)-u.dot(p),x=this.computeGW(),E=this.computeGiMf(),k=-g*n-x*h-o*E;return k}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],19:[function(e,i,d){i.exports=a;var l=e("./Equation"),r=e("../math/Vec3");e("../math/Mat3");function a(v,m,y){y=typeof y<"u"?y:1e6,l.call(this,v,m,0,y),this.restitution=0,this.ri=new r,this.rj=new r,this.ni=new r}a.prototype=new l,a.prototype.constructor=a;var s=new r,c=new r,o=new r;a.prototype.computeB=function(v){var m=this.a,y=this.b,g=this.bi,x=this.bj,E=this.ri,k=this.rj,L=s,N=c,Y=g.velocity,R=g.angularVelocity;g.force,g.torque;var z=x.velocity,I=x.angularVelocity;x.force,x.torque;var V=o,et=this.jacobianElementA,K=this.jacobianElementB,ft=this.ni;E.cross(ft,L),k.cross(ft,N),ft.negate(et.spatial),L.negate(et.rotational),K.spatial.copy(ft),K.rotational.copy(N),V.copy(x.position),V.vadd(k,V),V.vsub(g.position,V),V.vsub(E,V);var _=ft.dot(V),C=this.restitution+1,j=C*z.dot(ft)-C*Y.dot(ft)+I.dot(N)-R.dot(L),H=this.computeGiMf(),A=-_*m-j*y-v*H;return A};var n=new r,h=new r,u=new r,p=new r,f=new r;a.prototype.getImpactVelocityAlongNormal=function(){var v=n,m=h,y=u,g=p,x=f;return this.bi.position.vadd(this.ri,y),this.bj.position.vadd(this.rj,g),this.bi.getVelocityAtWorldPoint(y,v),this.bj.getVelocityAtWorldPoint(g,m),v.vsub(m,x),this.ni.dot(x)}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],20:[function(e,i,d){i.exports=a;var l=e("../math/JacobianElement"),r=e("../math/Vec3");function a(f,v,m,y){this.id=a.id++,this.minForce=typeof m>"u"?-1e6:m,this.maxForce=typeof y>"u"?1e6:y,this.bi=f,this.bj=v,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new l,this.jacobianElementB=new l,this.enabled=!0,this.setSpookParams(1e7,4,1/60)}a.prototype.constructor=a,a.id=0,a.prototype.setSpookParams=function(f,v,m){var y=v,g=f,x=m;this.a=4/(x*(1+4*y)),this.b=4*y/(1+4*y),this.eps=4/(x*x*g*(1+4*y))},a.prototype.computeB=function(f,v,m){var y=this.computeGW(),g=this.computeGq(),x=this.computeGiMf();return-g*f-y*v-x*m},a.prototype.computeGq=function(){var f=this.jacobianElementA,v=this.jacobianElementB,m=this.bi,y=this.bj,g=m.position,x=y.position;return f.spatial.dot(g)+v.spatial.dot(x)};var s=new r;a.prototype.computeGW=function(){var f=this.jacobianElementA,v=this.jacobianElementB,m=this.bi,y=this.bj,g=m.velocity,x=y.velocity,E=m.angularVelocity||s,k=y.angularVelocity||s;return f.multiplyVectors(g,E)+v.multiplyVectors(x,k)},a.prototype.computeGWlambda=function(){var f=this.jacobianElementA,v=this.jacobianElementB,m=this.bi,y=this.bj,g=m.vlambda,x=y.vlambda,E=m.wlambda||s,k=y.wlambda||s;return f.multiplyVectors(g,E)+v.multiplyVectors(x,k)};var c=new r,o=new r,n=new r,h=new r;a.prototype.computeGiMf=function(){var f=this.jacobianElementA,v=this.jacobianElementB,m=this.bi,y=this.bj,g=m.force,x=m.torque,E=y.force,k=y.torque,L=m.invMassSolve,N=y.invMassSolve;return m.invInertiaWorldSolve?m.invInertiaWorldSolve.vmult(x,n):n.set(0,0,0),y.invInertiaWorldSolve?y.invInertiaWorldSolve.vmult(k,h):h.set(0,0,0),g.mult(L,c),E.mult(N,o),f.multiplyVectors(c,n)+v.multiplyVectors(o,h)};var u=new r;a.prototype.computeGiMGt=function(){var f=this.jacobianElementA,v=this.jacobianElementB,m=this.bi,y=this.bj,g=m.invMassSolve,x=y.invMassSolve,E=m.invInertiaWorldSolve,k=y.invInertiaWorldSolve,L=g+x;return E&&(E.vmult(f.rotational,u),L+=u.dot(f.rotational)),k&&(k.vmult(v.rotational,u),L+=u.dot(v.rotational)),L};var p=new r;new r,new r,new r,new r,new r,a.prototype.addToWlambda=function(f){var v=this.jacobianElementA,m=this.jacobianElementB,y=this.bi,g=this.bj,x=p;v.spatial.mult(y.invMassSolve*f,x),y.vlambda.vadd(x,y.vlambda),m.spatial.mult(g.invMassSolve*f,x),g.vlambda.vadd(x,g.vlambda),y.invInertiaWorldSolve&&(y.invInertiaWorldSolve.vmult(v.rotational,x),x.mult(f,x),y.wlambda.vadd(x,y.wlambda)),g.invInertiaWorldSolve&&(g.invInertiaWorldSolve.vmult(m.rotational,x),x.mult(f,x),g.wlambda.vadd(x,g.wlambda))},a.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{"../math/JacobianElement":26,"../math/Vec3":30}],21:[function(e,i,d){i.exports=a;var l=e("./Equation"),r=e("../math/Vec3");e("../math/Mat3");function a(o,n,h){l.call(this,o,n,-h,h),this.ri=new r,this.rj=new r,this.t=new r}a.prototype=new l,a.prototype.constructor=a;var s=new r,c=new r;a.prototype.computeB=function(o){this.a;var n=this.b;this.bi,this.bj;var h=this.ri,u=this.rj,p=s,f=c,v=this.t;h.cross(v,p),u.cross(v,f);var m=this.jacobianElementA,y=this.jacobianElementB;v.negate(m.spatial),p.negate(m.rotational),y.spatial.copy(v),y.rotational.copy(f);var g=this.computeGW(),x=this.computeGiMf(),E=-g*n-o*x;return E}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],22:[function(e,i,d){i.exports=a;var l=e("../math/Vec3");e("../math/Mat3");var r=e("./Equation");function a(o,n,h){h=h||{};var u=typeof h.maxForce<"u"?h.maxForce:1e6;r.call(this,o,n,-u,u),this.axisA=h.axisA?h.axisA.clone():new l(1,0,0),this.axisB=h.axisB?h.axisB.clone():new l(0,1,0),this.maxAngle=Math.PI/2}a.prototype=new r,a.prototype.constructor=a;var s=new l,c=new l;a.prototype.computeB=function(o){var n=this.a,h=this.b,u=this.axisA,p=this.axisB,f=s,v=c,m=this.jacobianElementA,y=this.jacobianElementB;u.cross(p,f),p.cross(u,v),m.rotational.copy(v),y.rotational.copy(f);var g=Math.cos(this.maxAngle)-u.dot(p),x=this.computeGW(),E=this.computeGiMf(),k=-g*n-x*h-o*E;return k}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],23:[function(e,i,d){i.exports=a;var l=e("../math/Vec3");e("../math/Mat3");var r=e("./Equation");function a(s,c,o){o=typeof o<"u"?o:1e6,r.call(this,s,c,-o,o),this.axisA=new l,this.axisB=new l,this.targetVelocity=0}a.prototype=new r,a.prototype.constructor=a,a.prototype.computeB=function(s){this.a;var c=this.b;this.bi,this.bj;var o=this.axisA,n=this.axisB,h=this.jacobianElementA,u=this.jacobianElementB;h.rotational.copy(o),n.negate(u.rotational);var p=this.computeGW()-this.targetVelocity,f=this.computeGiMf(),v=-p*c-s*f;return v}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],24:[function(e,i,d){var l=e("../utils/Utils");i.exports=r;function r(a,s,c){c=l.defaults(c,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=r.idCounter++,this.materials=[a,s],this.friction=c.friction,this.restitution=c.restitution,this.contactEquationStiffness=c.contactEquationStiffness,this.contactEquationRelaxation=c.contactEquationRelaxation,this.frictionEquationStiffness=c.frictionEquationStiffness,this.frictionEquationRelaxation=c.frictionEquationRelaxation}r.idCounter=0},{"../utils/Utils":53}],25:[function(e,i,d){i.exports=l;function l(r){var a="";r=r||{},typeof r=="string"?(a=r,r={}):typeof r=="object"&&(a=""),this.name=a,this.id=l.idCounter++,this.friction=typeof r.friction<"u"?r.friction:-1,this.restitution=typeof r.restitution<"u"?r.restitution:-1}l.idCounter=0},{}],26:[function(e,i,d){i.exports=r;var l=e("./Vec3");function r(){this.spatial=new l,this.rotational=new l}r.prototype.multiplyElement=function(a){return a.spatial.dot(this.spatial)+a.rotational.dot(this.rotational)},r.prototype.multiplyVectors=function(a,s){return a.dot(this.spatial)+s.dot(this.rotational)}},{"./Vec3":30}],27:[function(e,i,d){i.exports=r;var l=e("./Vec3");function r(a){a?this.elements=a:this.elements=[0,0,0,0,0,0,0,0,0]}r.prototype.identity=function(){var a=this.elements;a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1},r.prototype.setZero=function(){var a=this.elements;a[0]=0,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=0,a[6]=0,a[7]=0,a[8]=0},r.prototype.setTrace=function(a){var s=this.elements;s[0]=a.x,s[4]=a.y,s[8]=a.z},r.prototype.getTrace=function(s){var s=s||new l,c=this.elements;s.x=c[0],s.y=c[4],s.z=c[8]},r.prototype.vmult=function(a,s){s=s||new l;var c=this.elements,o=a.x,n=a.y,h=a.z;return s.x=c[0]*o+c[1]*n+c[2]*h,s.y=c[3]*o+c[4]*n+c[5]*h,s.z=c[6]*o+c[7]*n+c[8]*h,s},r.prototype.smult=function(a){for(var s=0;s<this.elements.length;s++)this.elements[s]*=a},r.prototype.mmult=function(a,s){for(var c=s||new r,o=0;o<3;o++)for(var n=0;n<3;n++){for(var h=0,u=0;u<3;u++)h+=a.elements[o+u*3]*this.elements[u+n*3];c.elements[o+n*3]=h}return c},r.prototype.scale=function(a,s){s=s||new r;for(var c=this.elements,o=s.elements,n=0;n!==3;n++)o[3*n+0]=a.x*c[3*n+0],o[3*n+1]=a.y*c[3*n+1],o[3*n+2]=a.z*c[3*n+2];return s},r.prototype.solve=function(a,s){s=s||new l;for(var c=3,o=4,n=[],h=0;h<c*o;h++)n.push(0);var h,u;for(h=0;h<3;h++)for(u=0;u<3;u++)n[h+o*u]=this.elements[h+3*u];n[3+4*0]=a.x,n[3+4*1]=a.y,n[3+4*2]=a.z;var p=3,f=p,v,m=4,y;do{if(h=f-p,n[h+o*h]===0){for(u=h+1;u<f;u++)if(n[h+o*u]!==0){v=m;do y=m-v,n[y+o*h]+=n[y+o*u];while(--v);break}}if(n[h+o*h]!==0)for(u=h+1;u<f;u++){var g=n[h+o*u]/n[h+o*h];v=m;do y=m-v,n[y+o*u]=y<=h?0:n[y+o*u]-n[y+o*h]*g;while(--v)}}while(--p);if(s.z=n[2*o+3]/n[2*o+2],s.y=(n[1*o+3]-n[1*o+2]*s.z)/n[1*o+1],s.x=(n[0*o+3]-n[0*o+2]*s.z-n[0*o+1]*s.y)/n[0*o+0],isNaN(s.x)||isNaN(s.y)||isNaN(s.z)||s.x===1/0||s.y===1/0||s.z===1/0)throw"Could not solve equation! Got x=["+s.toString()+"], b=["+a.toString()+"], A=["+this.toString()+"]";return s},r.prototype.e=function(a,s,c){if(c===void 0)return this.elements[s+3*a];this.elements[s+3*a]=c},r.prototype.copy=function(a){for(var s=0;s<a.elements.length;s++)this.elements[s]=a.elements[s];return this},r.prototype.toString=function(){for(var a="",s=",",c=0;c<9;c++)a+=this.elements[c]+s;return a},r.prototype.reverse=function(a){a=a||new r;for(var s=3,c=6,o=[],n=0;n<s*c;n++)o.push(0);var n,h;for(n=0;n<3;n++)for(h=0;h<3;h++)o[n+c*h]=this.elements[n+3*h];o[3+6*0]=1,o[3+6*1]=0,o[3+6*2]=0,o[4+6*0]=0,o[4+6*1]=1,o[4+6*2]=0,o[5+6*0]=0,o[5+6*1]=0,o[5+6*2]=1;var u=3,p=u,f,v=c,m;do{if(n=p-u,o[n+c*n]===0){for(h=n+1;h<p;h++)if(o[n+c*h]!==0){f=v;do m=v-f,o[m+c*n]+=o[m+c*h];while(--f);break}}if(o[n+c*n]!==0)for(h=n+1;h<p;h++){var y=o[n+c*h]/o[n+c*n];f=v;do m=v-f,o[m+c*h]=m<=n?0:o[m+c*h]-o[m+c*n]*y;while(--f)}}while(--u);n=2;do{h=n-1;do{var y=o[n+c*h]/o[n+c*n];f=c;do m=c-f,o[m+c*h]=o[m+c*h]-o[m+c*n]*y;while(--f)}while(h--)}while(--n);n=2;do{var y=1/o[n+c*n];f=c;do m=c-f,o[m+c*n]=o[m+c*n]*y;while(--f)}while(n--);n=2;do{h=2;do{if(m=o[s+h+c*n],isNaN(m)||m===1/0)throw"Could not reverse! A=["+this.toString()+"]";a.e(n,h,m)}while(h--)}while(n--);return a},r.prototype.setRotationFromQuaternion=function(a){var s=a.x,c=a.y,o=a.z,n=a.w,h=s+s,u=c+c,p=o+o,f=s*h,v=s*u,m=s*p,y=c*u,g=c*p,x=o*p,E=n*h,k=n*u,L=n*p,N=this.elements;return N[3*0+0]=1-(y+x),N[3*0+1]=v-L,N[3*0+2]=m+k,N[3*1+0]=v+L,N[3*1+1]=1-(f+x),N[3*1+2]=g-E,N[3*2+0]=m-k,N[3*2+1]=g+E,N[3*2+2]=1-(f+y),this},r.prototype.transpose=function(a){a=a||new r;for(var s=a.elements,c=this.elements,o=0;o!==3;o++)for(var n=0;n!==3;n++)s[3*o+n]=c[3*n+o];return a}},{"./Vec3":30}],28:[function(e,i,d){i.exports=r;var l=e("./Vec3");function r(h,u,p,f){this.x=h!==void 0?h:0,this.y=u!==void 0?u:0,this.z=p!==void 0?p:0,this.w=f!==void 0?f:1}r.prototype.set=function(h,u,p,f){this.x=h,this.y=u,this.z=p,this.w=f},r.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w},r.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},r.prototype.setFromAxisAngle=function(h,u){var p=Math.sin(u*.5);this.x=h.x*p,this.y=h.y*p,this.z=h.z*p,this.w=Math.cos(u*.5)},r.prototype.toAxisAngle=function(h){h=h||new l,this.normalize();var u=2*Math.acos(this.w),p=Math.sqrt(1-this.w*this.w);return p<.001?(h.x=this.x,h.y=this.y,h.z=this.z):(h.x=this.x/p,h.y=this.y/p,h.z=this.z/p),[h,u]};var a=new l,s=new l;r.prototype.setFromVectors=function(h,u){if(h.isAntiparallelTo(u)){var p=a,f=s;h.tangents(p,f),this.setFromAxisAngle(p,Math.PI)}else{var v=h.cross(u);this.x=v.x,this.y=v.y,this.z=v.z,this.w=Math.sqrt(Math.pow(h.norm(),2)*Math.pow(u.norm(),2))+h.dot(u),this.normalize()}};var c=new l,o=new l,n=new l;r.prototype.mult=function(h,u){u=u||new r;var p=this.w,f=c,v=o,m=n;return f.set(this.x,this.y,this.z),v.set(h.x,h.y,h.z),u.w=p*h.w-f.dot(v),f.cross(v,m),u.x=p*v.x+h.w*f.x+m.x,u.y=p*v.y+h.w*f.y+m.y,u.z=p*v.z+h.w*f.z+m.z,u},r.prototype.inverse=function(h){var u=this.x,p=this.y,f=this.z,v=this.w;h=h||new r,this.conjugate(h);var m=1/(u*u+p*p+f*f+v*v);return h.x*=m,h.y*=m,h.z*=m,h.w*=m,h},r.prototype.conjugate=function(h){return h=h||new r,h.x=-this.x,h.y=-this.y,h.z=-this.z,h.w=this.w,h},r.prototype.normalize=function(){var h=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);h===0?(this.x=0,this.y=0,this.z=0,this.w=0):(h=1/h,this.x*=h,this.y*=h,this.z*=h,this.w*=h)},r.prototype.normalizeFast=function(){var h=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;h===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=h,this.y*=h,this.z*=h,this.w*=h)},r.prototype.vmult=function(h,u){u=u||new l;var p=h.x,f=h.y,v=h.z,m=this.x,y=this.y,g=this.z,x=this.w,E=x*p+y*v-g*f,k=x*f+g*p-m*v,L=x*v+m*f-y*p,N=-m*p-y*f-g*v;return u.x=E*x+N*-m+k*-g-L*-y,u.y=k*x+N*-y+L*-m-E*-g,u.z=L*x+N*-g+E*-y-k*-m,u},r.prototype.copy=function(h){return this.x=h.x,this.y=h.y,this.z=h.z,this.w=h.w,this},r.prototype.toEuler=function(h,u){u=u||"YZX";var p,f,v,m=this.x,y=this.y,g=this.z,x=this.w;switch(u){case"YZX":var E=m*y+g*x;if(E>.499&&(p=2*Math.atan2(m,x),f=Math.PI/2,v=0),E<-.499&&(p=-2*Math.atan2(m,x),f=-Math.PI/2,v=0),isNaN(p)){var k=m*m,L=y*y,N=g*g;p=Math.atan2(2*y*x-2*m*g,1-2*L-2*N),f=Math.asin(2*E),v=Math.atan2(2*m*x-2*y*g,1-2*k-2*N)}break;default:throw new Error("Euler order "+u+" not supported yet.")}h.y=p,h.z=f,h.x=v},r.prototype.setFromEuler=function(h,u,p,f){f=f||"XYZ";var v=Math.cos(h/2),m=Math.cos(u/2),y=Math.cos(p/2),g=Math.sin(h/2),x=Math.sin(u/2),E=Math.sin(p/2);return f==="XYZ"?(this.x=g*m*y+v*x*E,this.y=v*x*y-g*m*E,this.z=v*m*E+g*x*y,this.w=v*m*y-g*x*E):f==="YXZ"?(this.x=g*m*y+v*x*E,this.y=v*x*y-g*m*E,this.z=v*m*E-g*x*y,this.w=v*m*y+g*x*E):f==="ZXY"?(this.x=g*m*y-v*x*E,this.y=v*x*y+g*m*E,this.z=v*m*E+g*x*y,this.w=v*m*y-g*x*E):f==="ZYX"?(this.x=g*m*y-v*x*E,this.y=v*x*y+g*m*E,this.z=v*m*E-g*x*y,this.w=v*m*y+g*x*E):f==="YZX"?(this.x=g*m*y+v*x*E,this.y=v*x*y+g*m*E,this.z=v*m*E-g*x*y,this.w=v*m*y-g*x*E):f==="XZY"&&(this.x=g*m*y-v*x*E,this.y=v*x*y-g*m*E,this.z=v*m*E+g*x*y,this.w=v*m*y+g*x*E),this},r.prototype.clone=function(){return new r(this.x,this.y,this.z,this.w)}},{"./Vec3":30}],29:[function(e,i,d){var l=e("./Vec3"),r=e("./Quaternion");i.exports=a;function a(c){c=c||{},this.position=new l,c.position&&this.position.copy(c.position),this.quaternion=new r,c.quaternion&&this.quaternion.copy(c.quaternion)}var s=new r;a.pointToLocalFrame=function(c,o,n,u){var u=u||new l;return n.vsub(c,u),o.conjugate(s),s.vmult(u,u),u},a.prototype.pointToLocal=function(c,o){return a.pointToLocalFrame(this.position,this.quaternion,c,o)},a.pointToWorldFrame=function(c,o,n,u){var u=u||new l;return o.vmult(n,u),u.vadd(c,u),u},a.prototype.pointToWorld=function(c,o){return a.pointToWorldFrame(this.position,this.quaternion,c,o)},a.prototype.vectorToWorldFrame=function(c,n){var n=n||new l;return this.quaternion.vmult(c,n),n},a.vectorToWorldFrame=function(c,o,n){return c.vmult(o,n),n},a.vectorToLocalFrame=function(c,o,n,u){var u=u||new l;return o.w*=-1,o.vmult(n,u),o.w*=-1,u}},{"./Quaternion":28,"./Vec3":30}],30:[function(e,i,d){i.exports=r;var l=e("./Mat3");function r(o,n,h){this.x=o||0,this.y=n||0,this.z=h||0}r.ZERO=new r(0,0,0),r.UNIT_X=new r(1,0,0),r.UNIT_Y=new r(0,1,0),r.UNIT_Z=new r(0,0,1),r.prototype.cross=function(o,n){var h=o.x,u=o.y,p=o.z,f=this.x,v=this.y,m=this.z;return n=n||new r,n.x=v*p-m*u,n.y=m*h-f*p,n.z=f*u-v*h,n},r.prototype.set=function(o,n,h){return this.x=o,this.y=n,this.z=h,this},r.prototype.setZero=function(){this.x=this.y=this.z=0},r.prototype.vadd=function(o,n){if(n)n.x=o.x+this.x,n.y=o.y+this.y,n.z=o.z+this.z;else return new r(this.x+o.x,this.y+o.y,this.z+o.z)},r.prototype.vsub=function(o,n){if(n)n.x=this.x-o.x,n.y=this.y-o.y,n.z=this.z-o.z;else return new r(this.x-o.x,this.y-o.y,this.z-o.z)},r.prototype.crossmat=function(){return new l([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])},r.prototype.normalize=function(){var o=this.x,n=this.y,h=this.z,u=Math.sqrt(o*o+n*n+h*h);if(u>0){var p=1/u;this.x*=p,this.y*=p,this.z*=p}else this.x=0,this.y=0,this.z=0;return u},r.prototype.unit=function(o){o=o||new r;var n=this.x,h=this.y,u=this.z,p=Math.sqrt(n*n+h*h+u*u);return p>0?(p=1/p,o.x=n*p,o.y=h*p,o.z=u*p):(o.x=1,o.y=0,o.z=0),o},r.prototype.norm=function(){var o=this.x,n=this.y,h=this.z;return Math.sqrt(o*o+n*n+h*h)},r.prototype.length=r.prototype.norm,r.prototype.norm2=function(){return this.dot(this)},r.prototype.lengthSquared=r.prototype.norm2,r.prototype.distanceTo=function(o){var n=this.x,h=this.y,u=this.z,p=o.x,f=o.y,v=o.z;return Math.sqrt((p-n)*(p-n)+(f-h)*(f-h)+(v-u)*(v-u))},r.prototype.distanceSquared=function(o){var n=this.x,h=this.y,u=this.z,p=o.x,f=o.y,v=o.z;return(p-n)*(p-n)+(f-h)*(f-h)+(v-u)*(v-u)},r.prototype.mult=function(o,n){n=n||new r;var h=this.x,u=this.y,p=this.z;return n.x=o*h,n.y=o*u,n.z=o*p,n},r.prototype.scale=r.prototype.mult,r.prototype.dot=function(o){return this.x*o.x+this.y*o.y+this.z*o.z},r.prototype.isZero=function(){return this.x===0&&this.y===0&&this.z===0},r.prototype.negate=function(o){return o=o||new r,o.x=-this.x,o.y=-this.y,o.z=-this.z,o};var a=new r,s=new r;r.prototype.tangents=function(o,n){var h=this.norm();if(h>0){var u=a,p=1/h;u.set(this.x*p,this.y*p,this.z*p);var f=s;Math.abs(u.x)<.9?(f.set(1,0,0),u.cross(f,o)):(f.set(0,1,0),u.cross(f,o)),u.cross(o,n)}else o.set(1,0,0),n.set(0,1,0)},r.prototype.toString=function(){return this.x+","+this.y+","+this.z},r.prototype.toArray=function(){return[this.x,this.y,this.z]},r.prototype.copy=function(o){return this.x=o.x,this.y=o.y,this.z=o.z,this},r.prototype.lerp=function(o,n,h){var u=this.x,p=this.y,f=this.z;h.x=u+(o.x-u)*n,h.y=p+(o.y-p)*n,h.z=f+(o.z-f)*n},r.prototype.almostEquals=function(o,n){return n===void 0&&(n=1e-6),!(Math.abs(this.x-o.x)>n||Math.abs(this.y-o.y)>n||Math.abs(this.z-o.z)>n)},r.prototype.almostZero=function(o){return o===void 0&&(o=1e-6),!(Math.abs(this.x)>o||Math.abs(this.y)>o||Math.abs(this.z)>o)};var c=new r;r.prototype.isAntiparallelTo=function(o,n){return this.negate(c),c.almostEquals(o,n)},r.prototype.clone=function(){return new r(this.x,this.y,this.z)}},{"./Mat3":27}],31:[function(e,i,d){i.exports=n;var l=e("../utils/EventTarget");e("../shapes/Shape");var r=e("../math/Vec3"),a=e("../math/Mat3"),s=e("../math/Quaternion");e("../material/Material");var c=e("../collision/AABB"),o=e("../shapes/Box");function n(z){z=z||{},l.apply(this),this.id=n.idCounter++,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new r,this.collisionFilterGroup=typeof z.collisionFilterGroup=="number"?z.collisionFilterGroup:1,this.collisionFilterMask=typeof z.collisionFilterMask=="number"?z.collisionFilterMask:1,this.collisionResponse=!0,this.position=new r,z.position&&this.position.copy(z.position),this.previousPosition=new r,this.initPosition=new r,this.velocity=new r,z.velocity&&this.velocity.copy(z.velocity),this.initVelocity=new r,this.force=new r;var I=typeof z.mass=="number"?z.mass:0;this.mass=I,this.invMass=I>0?1/I:0,this.material=z.material||null,this.linearDamping=typeof z.linearDamping=="number"?z.linearDamping:.01,this.type=I<=0?n.STATIC:n.DYNAMIC,typeof z.type==typeof n.STATIC&&(this.type=z.type),this.allowSleep=typeof z.allowSleep<"u"?z.allowSleep:!0,this.sleepState=0,this.sleepSpeedLimit=typeof z.sleepSpeedLimit<"u"?z.sleepSpeedLimit:.1,this.sleepTimeLimit=typeof z.sleepTimeLimit<"u"?z.sleepTimeLimit:1,this.timeLastSleepy=0,this._wakeUpAfterNarrowphase=!1,this.torque=new r,this.quaternion=new s,z.quaternion&&this.quaternion.copy(z.quaternion),this.initQuaternion=new s,this.angularVelocity=new r,z.angularVelocity&&this.angularVelocity.copy(z.angularVelocity),this.initAngularVelocity=new r,this.interpolatedPosition=new r,this.interpolatedQuaternion=new s,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new r,this.invInertia=new r,this.invInertiaWorld=new a,this.invMassSolve=0,this.invInertiaSolve=new r,this.invInertiaWorldSolve=new a,this.fixedRotation=typeof z.fixedRotation<"u"?z.fixedRotation:!1,this.angularDamping=typeof z.angularDamping<"u"?z.angularDamping:.01,this.aabb=new c,this.aabbNeedsUpdate=!0,this.wlambda=new r,z.shape&&this.addShape(z.shape),this.updateMassProperties()}n.prototype=new l,n.prototype.constructor=n,n.DYNAMIC=1,n.STATIC=2,n.KINEMATIC=4,n.AWAKE=0,n.SLEEPY=1,n.SLEEPING=2,n.idCounter=0,n.prototype.wakeUp=function(){var z=this.sleepState;this.sleepState=0,z===n.SLEEPING&&this.dispatchEvent({type:"wakeup"})},n.prototype.sleep=function(){this.sleepState=n.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0)},n.sleepyEvent={type:"sleepy"},n.sleepEvent={type:"sleep"},n.prototype.sleepTick=function(z){if(this.allowSleep){var I=this.sleepState,V=this.velocity.norm2()+this.angularVelocity.norm2(),et=Math.pow(this.sleepSpeedLimit,2);I===n.AWAKE&&V<et?(this.sleepState=n.SLEEPY,this.timeLastSleepy=z,this.dispatchEvent(n.sleepyEvent)):I===n.SLEEPY&&V>et?this.wakeUp():I===n.SLEEPY&&z-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(n.sleepEvent))}},n.prototype.updateSolveMassProperties=function(){this.sleepState===n.SLEEPING||this.type===n.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))},n.prototype.pointToLocalFrame=function(z,V){var V=V||new r;return z.vsub(this.position,V),this.quaternion.conjugate().vmult(V,V),V},n.prototype.vectorToLocalFrame=function(z,V){var V=V||new r;return this.quaternion.conjugate().vmult(z,V),V},n.prototype.pointToWorldFrame=function(z,V){var V=V||new r;return this.quaternion.vmult(z,V),V.vadd(this.position,V),V},n.prototype.vectorToWorldFrame=function(z,V){var V=V||new r;return this.quaternion.vmult(z,V),V};var h=new r,u=new s;n.prototype.addShape=function(z,I,V){var et=new r,K=new s;return I&&et.copy(I),V&&K.copy(V),this.shapes.push(z),this.shapeOffsets.push(et),this.shapeOrientations.push(K),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,this},n.prototype.updateBoundingRadius=function(){for(var z=this.shapes,I=this.shapeOffsets,V=z.length,et=0,K=0;K!==V;K++){var ft=z[K];ft.updateBoundingSphereRadius();var _=I[K].norm(),C=ft.boundingSphereRadius;_+C>et&&(et=_+C)}this.boundingRadius=et};var p=new c;n.prototype.computeAABB=function(){for(var z=this.shapes,I=this.shapeOffsets,V=this.shapeOrientations,et=z.length,K=h,ft=u,_=this.quaternion,C=this.aabb,j=p,H=0;H!==et;H++){var A=z[H];V[H].mult(_,ft),ft.vmult(I[H],K),K.vadd(this.position,K),A.calculateWorldAABB(K,ft,j.lowerBound,j.upperBound),H===0?C.copy(j):C.extend(j)}this.aabbNeedsUpdate=!1};var f=new a,v=new a;new a,n.prototype.updateInertiaWorld=function(z){var I=this.invInertia;if(!(I.x===I.y&&I.y===I.z&&!z)){var V=f,et=v;V.setRotationFromQuaternion(this.quaternion),V.transpose(et),V.scale(I,V),V.mmult(et,this.invInertiaWorld)}};var m=new r,y=new r;n.prototype.applyForce=function(z,I){if(this.type===n.DYNAMIC){var V=m;I.vsub(this.position,V);var et=y;V.cross(z,et),this.force.vadd(z,this.force),this.torque.vadd(et,this.torque)}};var g=new r,x=new r;n.prototype.applyLocalForce=function(z,I){if(this.type===n.DYNAMIC){var V=g,et=x;this.vectorToWorldFrame(z,V),this.pointToWorldFrame(I,et),this.applyForce(V,et)}};var E=new r,k=new r,L=new r;n.prototype.applyImpulse=function(z,I){if(this.type===n.DYNAMIC){var V=E;I.vsub(this.position,V);var et=k;et.copy(z),et.mult(this.invMass,et),this.velocity.vadd(et,this.velocity);var K=L;V.cross(z,K),this.invInertiaWorld.vmult(K,K),this.angularVelocity.vadd(K,this.angularVelocity)}};var N=new r,Y=new r;n.prototype.applyLocalImpulse=function(z,I){if(this.type===n.DYNAMIC){var V=N,et=Y;this.vectorToWorldFrame(z,V),this.pointToWorldFrame(I,et),this.applyImpulse(V,et)}};var R=new r;n.prototype.updateMassProperties=function(){var z=R;this.invMass=this.mass>0?1/this.mass:0;var I=this.inertia,V=this.fixedRotation;this.computeAABB(),z.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),o.calculateInertia(z,this.mass,I),this.invInertia.set(I.x>0&&!V?1/I.x:0,I.y>0&&!V?1/I.y:0,I.z>0&&!V?1/I.z:0),this.updateInertiaWorld(!0)},n.prototype.getVelocityAtWorldPoint=function(z,I){var V=new r;return z.vsub(this.position,V),this.angularVelocity.cross(V,I),this.velocity.vadd(I,I),I}},{"../collision/AABB":3,"../material/Material":25,"../math/Mat3":27,"../math/Quaternion":28,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Shape":43,"../utils/EventTarget":49}],32:[function(e,i,d){e("./Body");var l=e("../math/Vec3"),r=e("../math/Quaternion");e("../collision/RaycastResult");var a=e("../collision/Ray"),s=e("../objects/WheelInfo");i.exports=c;function c(_){this.chassisBody=_.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=typeof _.indexRightAxis<"u"?_.indexRightAxis:1,this.indexForwardAxis=typeof _.indexForwardAxis<"u"?_.indexForwardAxis:0,this.indexUpAxis=typeof _.indexUpAxis<"u"?_.indexUpAxis:2}new l,new l,new l;var o=new l,n=new l,h=new l;new a,c.prototype.addWheel=function(_){_=_||{};var C=new s(_),j=this.wheelInfos.length;return this.wheelInfos.push(C),j},c.prototype.setSteeringValue=function(_,C){var j=this.wheelInfos[C];j.steering=_},new l,c.prototype.applyEngineForce=function(_,C){this.wheelInfos[C].engineForce=_},c.prototype.setBrake=function(_,C){this.wheelInfos[C].brake=_},c.prototype.addToWorld=function(_){this.constraints,_.add(this.chassisBody);var C=this;this.preStepCallback=function(){C.updateVehicle(_.dt)},_.addEventListener("preStep",this.preStepCallback),this.world=_},c.prototype.getVehicleAxisWorld=function(_,C){C.set(_===0?1:0,_===1?1:0,_===2?1:0),this.chassisBody.vectorToWorldFrame(C,C)},c.prototype.updateVehicle=function(_){for(var C=this.wheelInfos,j=C.length,H=this.chassisBody,A=0;A<j;A++)this.updateWheelTransform(A);this.currentVehicleSpeedKmHour=3.6*H.velocity.norm();var F=new l;this.getVehicleAxisWorld(this.indexForwardAxis,F),F.dot(H.velocity)<0&&(this.currentVehicleSpeedKmHour*=-1);for(var A=0;A<j;A++)this.castRay(C[A]);this.updateSuspension(_);for(var M=new l,b=new l,A=0;A<j;A++){var w=C[A],B=w.suspensionForce;B>w.maxSuspensionForce&&(B=w.maxSuspensionForce),w.raycastResult.hitNormalWorld.scale(B*_,M),w.raycastResult.hitPointWorld.vsub(H.position,b),H.applyImpulse(M,w.raycastResult.hitPointWorld)}this.updateFriction(_);var X=new l,q=new l,T=new l;for(A=0;A<j;A++){var w=C[A];H.getVelocityAtWorldPoint(w.chassisConnectionPointWorld,T);var D=1;switch(this.indexUpAxis){case 1:D=-1;break}if(w.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,q);var J=q.dot(w.raycastResult.hitNormalWorld);w.raycastResult.hitNormalWorld.scale(J,X),q.vsub(X,q);var mt=q.dot(T);w.deltaRotation=D*mt*_/w.radius}(w.sliding||!w.isInContact)&&w.engineForce!==0&&w.useCustomSlidingRotationalSpeed&&(w.deltaRotation=(w.engineForce>0?1:-1)*w.customSlidingRotationalSpeed*_),Math.abs(w.brake)>Math.abs(w.engineForce)&&(w.deltaRotation=0),w.rotation+=w.deltaRotation,w.deltaRotation*=.99}},c.prototype.updateSuspension=function(_){for(var C=this.chassisBody,j=C.mass,H=this.wheelInfos,A=H.length,F=0;F<A;F++){var M=H[F];if(M.isInContact){var b,w=M.suspensionRestLength,B=M.suspensionLength,X=w-B;b=M.suspensionStiffness*X*M.clippedInvContactDotSuspension;var q=M.suspensionRelativeVelocity,T;q<0?T=M.dampingCompression:T=M.dampingRelaxation,b-=T*q,M.suspensionForce=b*j,M.suspensionForce<0&&(M.suspensionForce=0)}else M.suspensionForce=0}},c.prototype.removeFromWorld=function(_){this.constraints,_.remove(this.chassisBody),_.removeEventListener("preStep",this.preStepCallback),this.world=null};var u=new l,p=new l;c.prototype.castRay=function(_){var C=u,j=p;this.updateWheelTransformWorld(_);var H=this.chassisBody,A=-1,F=_.suspensionRestLength+_.radius;_.directionWorld.scale(F,C);var M=_.chassisConnectionPointWorld;M.vadd(C,j);var b=_.raycastResult;b.reset();var w=H.collisionResponse;H.collisionResponse=!1,this.world.rayTest(M,j,b),H.collisionResponse=w;var B=b.body;if(_.raycastResult.groundObject=0,B){A=b.distance,_.raycastResult.hitNormalWorld=b.hitNormalWorld,_.isInContact=!0;var X=b.distance;_.suspensionLength=X-_.radius;var q=_.suspensionRestLength-_.maxSuspensionTravel,T=_.suspensionRestLength+_.maxSuspensionTravel;_.suspensionLength<q&&(_.suspensionLength=q),_.suspensionLength>T&&(_.suspensionLength=T,_.raycastResult.reset());var D=_.raycastResult.hitNormalWorld.dot(_.directionWorld),J=new l;H.getVelocityAtWorldPoint(_.raycastResult.hitPointWorld,J);var mt=_.raycastResult.hitNormalWorld.dot(J);if(D>=-.1)_.suspensionRelativeVelocity=0,_.clippedInvContactDotSuspension=1/.1;else{var ut=-1/D;_.suspensionRelativeVelocity=mt*ut,_.clippedInvContactDotSuspension=ut}}else _.suspensionLength=_.suspensionRestLength+0*_.maxSuspensionTravel,_.suspensionRelativeVelocity=0,_.directionWorld.scale(-1,_.raycastResult.hitNormalWorld),_.clippedInvContactDotSuspension=1;return A},c.prototype.updateWheelTransformWorld=function(_){_.isInContact=!1;var C=this.chassisBody;C.pointToWorldFrame(_.chassisConnectionPointLocal,_.chassisConnectionPointWorld),C.vectorToWorldFrame(_.directionLocal,_.directionWorld),C.vectorToWorldFrame(_.axleLocal,_.axleWorld)},c.prototype.updateWheelTransform=function(_){var C=o,j=n,H=h,A=this.wheelInfos[_];this.updateWheelTransformWorld(A),A.directionLocal.scale(-1,C),j.copy(A.axleLocal),C.cross(j,H),H.normalize(),j.normalize();var F=A.steering,M=new r;M.setFromAxisAngle(C,F);var b=new r;b.setFromAxisAngle(j,A.rotation);var w=A.worldTransform.quaternion;this.chassisBody.quaternion.mult(M,w),w.mult(b,w),w.normalize();var B=A.worldTransform.position;B.copy(A.directionWorld),B.scale(A.suspensionLength,B),B.vadd(A.chassisConnectionPointWorld,B)};var f=[new l(1,0,0),new l(0,1,0),new l(0,0,1)];c.prototype.getWheelTransformWorld=function(_){return this.wheelInfos[_].worldTransform};var v=new l,m=[],y=[],g=1;c.prototype.updateFriction=function(_){for(var C=v,j=this.wheelInfos,H=j.length,A=this.chassisBody,F=y,M=m,b=0;b<H;b++){var w=j[b],B=w.raycastResult.body;w.sideImpulse=0,w.forwardImpulse=0,F[b]||(F[b]=new l),M[b]||(M[b]=new l)}for(var b=0;b<H;b++){var w=j[b],B=w.raycastResult.body;if(B){var X=M[b],q=this.getWheelTransformWorld(b);q.vectorToWorldFrame(f[this.indexRightAxis],X);var T=w.raycastResult.hitNormalWorld,D=X.dot(T);T.scale(D,C),X.vsub(C,X),X.normalize(),T.cross(X,F[b]),F[b].normalize(),w.sideImpulse=ft(A,w.raycastResult.hitPointWorld,B,w.raycastResult.hitPointWorld,X),w.sideImpulse*=g}}var J=1,mt=.5;this.sliding=!1;for(var b=0;b<H;b++){var w=j[b],B=w.raycastResult.body,ut=0;if(w.slipInfo=1,B){var at=0,G=w.brake?w.brake:at;ut=L(A,B,w.raycastResult.hitPointWorld,F[b],G),ut+=w.engineForce*_;var $=G/ut;w.slipInfo*=$}if(w.forwardImpulse=0,w.skidInfo=1,B){w.skidInfo=1;var Ct=w.suspensionForce*_*w.frictionSlip,xt=Ct,Nt=Ct*xt;w.forwardImpulse=ut;var pt=w.forwardImpulse*mt,Rt=w.sideImpulse*J,It=pt*pt+Rt*Rt;if(w.sliding=!1,It>Nt){this.sliding=!0,w.sliding=!0;var $=Ct/Math.sqrt(It);w.skidInfo*=$}}}if(this.sliding)for(var b=0;b<H;b++){var w=j[b];w.sideImpulse!==0&&w.skidInfo<1&&(w.forwardImpulse*=w.skidInfo,w.sideImpulse*=w.skidInfo)}for(var b=0;b<H;b++){var w=j[b],Pt=new l;if(Pt.copy(w.raycastResult.hitPointWorld),w.forwardImpulse!==0){var Vt=new l;F[b].scale(w.forwardImpulse,Vt),A.applyImpulse(Vt,Pt)}if(w.sideImpulse!==0){var B=w.raycastResult.body,Bt=new l;Bt.copy(w.raycastResult.hitPointWorld);var Lt=new l;M[b].scale(w.sideImpulse,Lt),A.pointToLocalFrame(Pt,Pt),Pt["xyz"[this.indexUpAxis]]*=w.rollInfluence,A.pointToWorldFrame(Pt,Pt),A.applyImpulse(Lt,Pt),Lt.scale(-1,Lt),B.applyImpulse(Lt,Bt)}}};var x=new l,E=new l,k=new l;function L(_,C,j,H,A){var F=0,M=j,b=x,w=E,B=k;_.getVelocityAtWorldPoint(M,b),C.getVelocityAtWorldPoint(M,w),b.vsub(w,B);var X=H.dot(B),q=I(_,j,H),T=I(C,j,H),D=1,J=D/(q+T);return F=-X*J,A<F&&(F=A),F<-A&&(F=-A),F}var N=new l,Y=new l,R=new l,z=new l;function I(_,C,j){var H=N,A=Y,F=R,M=z;return C.vsub(_.position,H),H.cross(j,A),_.invInertiaWorld.vmult(A,M),M.cross(H,F),_.invMass+j.dot(F)}var V=new l,et=new l,K=new l;function ft(_,C,j,H,A,D){var M=A.norm2();if(M>1.1)return 0;var b=V,w=et,B=K;_.getVelocityAtWorldPoint(C,b),j.getVelocityAtWorldPoint(H,w),b.vsub(w,B);var X=A.dot(B),q=.2,T=1/(_.invMass+j.invMass),D=-q*X*T;return D}},{"../collision/Ray":9,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Vec3":30,"../objects/WheelInfo":36,"./Body":31}],33:[function(e,i,d){var l=e("./Body"),r=e("../shapes/Sphere"),a=e("../shapes/Box"),s=e("../math/Vec3"),c=e("../constraints/HingeConstraint");i.exports=o;function o(u){if(this.wheelBodies=[],this.coordinateSystem=typeof u.coordinateSystem>"u"?new s(1,2,3):u.coordinateSystem.clone(),this.chassisBody=u.chassisBody,!this.chassisBody){var p=new a(new s(5,2,.5));this.chassisBody=new l(1,p)}this.constraints=[],this.wheelAxes=[],this.wheelForces=[]}o.prototype.addWheel=function(u){u=u||{};var p=u.body;p||(p=new l(1,new r(1.2))),this.wheelBodies.push(p),this.wheelForces.push(0),new s;var f=typeof u.position<"u"?u.position.clone():new s,v=new s;this.chassisBody.pointToWorldFrame(f,v),p.position.set(v.x,v.y,v.z);var m=typeof u.axis<"u"?u.axis.clone():new s(0,1,0);this.wheelAxes.push(m);var y=new c(this.chassisBody,p,{pivotA:f,axisA:m,pivotB:s.ZERO,axisB:m,collideConnected:!1});return this.constraints.push(y),this.wheelBodies.length-1},o.prototype.setSteeringValue=function(u,p){var f=this.wheelAxes[p],v=Math.cos(u),m=Math.sin(u),y=f.x,g=f.y;this.constraints[p].axisA.set(v*y-m*g,m*y+v*g,0)},o.prototype.setMotorSpeed=function(u,p){var f=this.constraints[p];f.enableMotor(),f.motorTargetVelocity=u},o.prototype.disableMotor=function(u){var p=this.constraints[u];p.disableMotor()};var n=new s;o.prototype.setWheelForce=function(u,p){this.wheelForces[p]=u},o.prototype.applyWheelForce=function(u,p){var f=this.wheelAxes[p],v=this.wheelBodies[p],m=v.torque;f.scale(u,n),v.vectorToWorldFrame(n,n),m.vadd(n,m)},o.prototype.addToWorld=function(u){for(var p=this.constraints,f=this.wheelBodies.concat([this.chassisBody]),v=0;v<f.length;v++)u.add(f[v]);for(var v=0;v<p.length;v++)u.addConstraint(p[v]);u.addEventListener("preStep",this._update.bind(this))},o.prototype._update=function(){for(var u=this.wheelForces,p=0;p<u.length;p++)this.applyWheelForce(u[p],p)},o.prototype.removeFromWorld=function(u){for(var p=this.constraints,f=this.wheelBodies.concat([this.chassisBody]),v=0;v<f.length;v++)u.remove(f[v]);for(var v=0;v<p.length;v++)u.removeConstraint(p[v])};var h=new s;o.prototype.getWheelSpeed=function(u){var p=this.wheelAxes[u],f=this.wheelBodies[u],v=f.angularVelocity;return this.chassisBody.vectorToWorldFrame(p,h),v.dot(h)}},{"../constraints/HingeConstraint":15,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Sphere":44,"./Body":31}],34:[function(e,i,d){i.exports=r,e("../shapes/Shape");var l=e("../math/Vec3");e("../math/Quaternion"),e("../shapes/Particle"),e("../objects/Body"),e("../material/Material");function r(){this.particles=[],this.density=1,this.smoothingRadius=1,this.speedOfSound=1,this.viscosity=.01,this.eps=1e-6,this.pressures=[],this.densities=[],this.neighbors=[]}r.prototype.add=function(p){this.particles.push(p),this.neighbors.length<this.particles.length&&this.neighbors.push([])},r.prototype.remove=function(p){var f=this.particles.indexOf(p);f!==-1&&(this.particles.splice(f,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())};var a=new l;r.prototype.getNeighbors=function(p,f){for(var v=this.particles.length,m=p.id,y=this.smoothingRadius*this.smoothingRadius,g=a,x=0;x!==v;x++){var E=this.particles[x];E.position.vsub(p.position,g),m!==E.id&&g.norm2()<y&&f.push(E)}};var s=new l,c=new l,o=new l,n=new l,h=new l,u=new l;r.prototype.update=function(){for(var p=this.particles.length,f=s,v=this.speedOfSound,m=this.eps,y=0;y!==p;y++){var g=this.particles[y],x=this.neighbors[y];x.length=0,this.getNeighbors(g,x),x.push(this.particles[y]);for(var E=x.length,k=0,L=0;L!==E;L++){g.position.vsub(x[L].position,f);var N=f.norm(),Y=this.w(N);k+=x[L].mass*Y}this.densities[y]=k,this.pressures[y]=v*v*(this.densities[y]-this.density)}for(var R=c,z=o,I=n,V=h,et=u,y=0;y!==p;y++){var K=this.particles[y];R.set(0,0,0),z.set(0,0,0);for(var ft,_,x=this.neighbors[y],E=x.length,L=0;L!==E;L++){var C=x[L];K.position.vsub(C.position,V);var j=V.norm();ft=-C.mass*(this.pressures[y]/(this.densities[y]*this.densities[y]+m)+this.pressures[L]/(this.densities[L]*this.densities[L]+m)),this.gradw(V,I),I.mult(ft,I),R.vadd(I,R),C.velocity.vsub(K.velocity,et),et.mult(1/(1e-4+this.densities[y]*this.densities[L])*this.viscosity*C.mass,et),_=this.nablaw(j),et.mult(_,et),z.vadd(et,z)}z.mult(K.mass,z),R.mult(K.mass,R),K.force.vadd(z,K.force),K.force.vadd(R,K.force)}},r.prototype.w=function(p){var f=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(f,9))*Math.pow(f*f-p*p,3)},r.prototype.gradw=function(p,f){var v=p.norm(),m=this.smoothingRadius;p.mult(945/(32*Math.PI*Math.pow(m,9))*Math.pow(m*m-v*v,2),f)},r.prototype.nablaw=function(p){var f=this.smoothingRadius,v=945/(32*Math.PI*Math.pow(f,9))*(f*f-p*p)*(7*p*p-3*f*f);return v}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Particle":41,"../shapes/Shape":43}],35:[function(e,i,d){var l=e("../math/Vec3");i.exports=r;function r(y,g,x){x=x||{},this.restLength=typeof x.restLength=="number"?x.restLength:1,this.stiffness=x.stiffness||100,this.damping=x.damping||1,this.bodyA=y,this.bodyB=g,this.localAnchorA=new l,this.localAnchorB=new l,x.localAnchorA&&this.localAnchorA.copy(x.localAnchorA),x.localAnchorB&&this.localAnchorB.copy(x.localAnchorB),x.worldAnchorA&&this.setWorldAnchorA(x.worldAnchorA),x.worldAnchorB&&this.setWorldAnchorB(x.worldAnchorB)}r.prototype.setWorldAnchorA=function(y){this.bodyA.pointToLocalFrame(y,this.localAnchorA)},r.prototype.setWorldAnchorB=function(y){this.bodyB.pointToLocalFrame(y,this.localAnchorB)},r.prototype.getWorldAnchorA=function(y){this.bodyA.pointToWorldFrame(this.localAnchorA,y)},r.prototype.getWorldAnchorB=function(y){this.bodyB.pointToWorldFrame(this.localAnchorB,y)};var a=new l,s=new l,c=new l,o=new l,n=new l,h=new l,u=new l,p=new l,f=new l,v=new l,m=new l;r.prototype.applyForce=function(){var y=this.stiffness,g=this.damping,x=this.restLength,E=this.bodyA,k=this.bodyB,L=a,N=s,Y=c,R=o,z=m,I=n,V=h,et=u,K=p,ft=f,_=v;this.getWorldAnchorA(I),this.getWorldAnchorB(V),I.vsub(E.position,et),V.vsub(k.position,K),V.vsub(I,L);var C=L.norm();N.copy(L),N.normalize(),k.velocity.vsub(E.velocity,Y),k.angularVelocity.cross(K,z),Y.vadd(z,Y),E.angularVelocity.cross(et,z),Y.vsub(z,Y),N.mult(-y*(C-x)-g*Y.dot(N),R),E.force.vsub(R,E.force),k.force.vadd(R,k.force),et.cross(R,ft),K.cross(R,_),E.torque.vsub(ft,E.torque),k.torque.vadd(_,k.torque)}},{"../math/Vec3":30}],36:[function(e,i,d){var l=e("../math/Vec3"),r=e("../math/Transform"),a=e("../collision/RaycastResult"),s=e("../utils/Utils");i.exports=c;function c(h){h=s.defaults(h,{chassisConnectionPointLocal:new l,chassisConnectionPointWorld:new l,directionLocal:new l,directionWorld:new l,axleLocal:new l,axleWorld:new l,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=h.maxSuspensionTravel,this.customSlidingRotationalSpeed=h.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=h.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=h.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=h.chassisConnectionPointWorld.clone(),this.directionLocal=h.directionLocal.clone(),this.directionWorld=h.directionWorld.clone(),this.axleLocal=h.axleLocal.clone(),this.axleWorld=h.axleWorld.clone(),this.suspensionRestLength=h.suspensionRestLength,this.suspensionMaxLength=h.suspensionMaxLength,this.radius=h.radius,this.suspensionStiffness=h.suspensionStiffness,this.dampingCompression=h.dampingCompression,this.dampingRelaxation=h.dampingRelaxation,this.frictionSlip=h.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=h.rollInfluence,this.maxSuspensionForce=h.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=h.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new a,this.worldTransform=new r,this.isInContact=!1}var n=new l,o=new l,n=new l;c.prototype.updateWheel=function(h){var u=this.raycastResult;if(this.isInContact){var p=u.hitNormalWorld.dot(u.directionWorld);u.hitPointWorld.vsub(h.position,o),h.getVelocityAtWorldPoint(o,n);var f=u.hitNormalWorld.dot(n);if(p>=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=1/.1;else{var v=-1/p;this.suspensionRelativeVelocity=f*v,this.clippedInvContactDotSuspension=v}}else u.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,u.directionWorld.scale(-1,u.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{"../collision/RaycastResult":10,"../math/Transform":29,"../math/Vec3":30,"../utils/Utils":53}],37:[function(e,i,d){i.exports=s;var l=e("./Shape"),r=e("../math/Vec3"),a=e("./ConvexPolyhedron");function s(n){l.call(this),this.type=l.types.BOX,this.halfExtents=n,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}s.prototype=new l,s.prototype.constructor=s,s.prototype.updateConvexPolyhedronRepresentation=function(){var n=this.halfExtents.x,h=this.halfExtents.y,u=this.halfExtents.z,p=r,f=[new p(-n,-h,-u),new p(n,-h,-u),new p(n,h,-u),new p(-n,h,-u),new p(-n,-h,u),new p(n,-h,u),new p(n,h,u),new p(-n,h,u)],v=[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]];new p(0,0,1),new p(0,1,0),new p(1,0,0);var m=new a(f,v);this.convexPolyhedronRepresentation=m,m.material=this.material},s.prototype.calculateLocalInertia=function(n,h){return h=h||new r,s.calculateInertia(this.halfExtents,n,h),h},s.calculateInertia=function(n,h,u){var p=n;u.x=1/12*h*(2*p.y*2*p.y+2*p.z*2*p.z),u.y=1/12*h*(2*p.x*2*p.x+2*p.z*2*p.z),u.z=1/12*h*(2*p.y*2*p.y+2*p.x*2*p.x)},s.prototype.getSideNormals=function(n,h){var u=n,p=this.halfExtents;if(u[0].set(p.x,0,0),u[1].set(0,p.y,0),u[2].set(0,0,p.z),u[3].set(-p.x,0,0),u[4].set(0,-p.y,0),u[5].set(0,0,-p.z),h!==void 0)for(var f=0;f!==u.length;f++)h.vmult(u[f],u[f]);return u},s.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z},s.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};var c=new r;new r,s.prototype.forEachWorldCorner=function(n,h,u){for(var p=this.halfExtents,f=[[p.x,p.y,p.z],[-p.x,p.y,p.z],[-p.x,-p.y,p.z],[-p.x,-p.y,-p.z],[p.x,-p.y,-p.z],[p.x,p.y,-p.z],[-p.x,p.y,-p.z],[p.x,-p.y,p.z]],v=0;v<f.length;v++)c.set(f[v][0],f[v][1],f[v][2]),h.vmult(c,c),n.vadd(c,c),u(c.x,c.y,c.z)};var o=[new r,new r,new r,new r,new r,new r,new r,new r];s.prototype.calculateWorldAABB=function(n,h,u,p){var f=this.halfExtents;o[0].set(f.x,f.y,f.z),o[1].set(-f.x,f.y,f.z),o[2].set(-f.x,-f.y,f.z),o[3].set(-f.x,-f.y,-f.z),o[4].set(f.x,-f.y,-f.z),o[5].set(f.x,f.y,-f.z),o[6].set(-f.x,f.y,-f.z),o[7].set(f.x,-f.y,f.z);var v=o[0];h.vmult(v,v),n.vadd(v,v),p.copy(v),u.copy(v);for(var m=1;m<8;m++){var v=o[m];h.vmult(v,v),n.vadd(v,v);var y=v.x,g=v.y,x=v.z;y>p.x&&(p.x=y),g>p.y&&(p.y=g),x>p.z&&(p.z=x),y<u.x&&(u.x=y),g<u.y&&(u.y=g),x<u.z&&(u.z=x)}}},{"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],38:[function(e,i,d){i.exports=s;var l=e("./Shape"),r=e("../math/Vec3");e("../math/Quaternion");var a=e("../math/Transform");function s(A,F,M){l.call(this),this.type=l.types.CONVEXPOLYHEDRON,this.vertices=A||[],this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.faces=F||[],this.faceNormals=[],this.computeNormals(),this.worldFaceNormalsNeedsUpdate=!0,this.worldFaceNormals=[],this.uniqueEdges=[],this.uniqueAxes=M?M.slice():null,this.computeEdges(),this.updateBoundingSphereRadius()}s.prototype=new l,s.prototype.constructor=s;var c=new r;s.prototype.computeEdges=function(){var A=this.faces,F=this.vertices;F.length;var M=this.uniqueEdges;M.length=0;for(var b=c,w=0;w!==A.length;w++)for(var B=A[w],X=B.length,q=0;q!==X;q++){var T=(q+1)%X;F[B[q]].vsub(F[B[T]],b),b.normalize();for(var D=!1,J=0;J!==M.length;J++)if(M[J].almostEquals(b)||M[J].almostEquals(b)){D=!0;break}D||M.push(b.clone())}},s.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var A=0;A<this.faces.length;A++){for(var F=0;F<this.faces[A].length;F++)if(!this.vertices[this.faces[A][F]])throw new Error("Vertex "+this.faces[A][F]+" not found!");var M=this.faceNormals[A]||new r;this.getFaceNormal(A,M),M.negate(M),this.faceNormals[A]=M;var b=this.vertices[this.faces[A][0]];if(M.dot(b)<0){console.error(".faceNormals["+A+"] = Vec3("+M.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.");for(var F=0;F<this.faces[A].length;F++)console.warn(".vertices["+this.faces[A][F]+"] = Vec3("+this.vertices[this.faces[A][F]].toString()+")")}}};var o=new r,n=new r;s.computeNormal=function(A,F,M,b){F.vsub(A,n),M.vsub(F,o),o.cross(n,b),b.isZero()||b.normalize()},s.prototype.getFaceNormal=function(A,F){var M=this.faces[A],b=this.vertices[M[0]],w=this.vertices[M[1]],B=this.vertices[M[2]];return s.computeNormal(b,w,B,F)};var h=new r;s.prototype.clipAgainstHull=function(A,F,M,b,w,B,X,q,T){for(var D=h,J=-1,mt=-Number.MAX_VALUE,ut=0;ut<M.faces.length;ut++){D.copy(M.faceNormals[ut]),w.vmult(D,D);var at=D.dot(B);at>mt&&(mt=at,J=ut)}for(var G=[],$=M.faces[J],Ct=$.length,xt=0;xt<Ct;xt++){var Nt=M.vertices[$[xt]],pt=new r;pt.copy(Nt),w.vmult(pt,pt),b.vadd(pt,pt),G.push(pt)}J>=0&&this.clipFaceAgainstHull(B,A,F,G,X,q,T)};var u=new r,p=new r,f=new r,v=new r,m=new r,y=new r;s.prototype.findSeparatingAxis=function(A,F,M,b,w,B,X,q){var T=u,D=p,J=f,mt=v,ut=m,at=y,G=Number.MAX_VALUE,$=this;if($.uniqueAxes)for(var xt=0;xt!==$.uniqueAxes.length;xt++){M.vmult($.uniqueAxes[xt],T);var pt=$.testSepAxis(T,A,F,M,b,w);if(pt===!1)return!1;pt<G&&(G=pt,B.copy(T))}else for(var Ct=X?X.length:$.faces.length,xt=0;xt<Ct;xt++){var Nt=X?X[xt]:xt;T.copy($.faceNormals[Nt]),M.vmult(T,T);var pt=$.testSepAxis(T,A,F,M,b,w);if(pt===!1)return!1;pt<G&&(G=pt,B.copy(T))}if(A.uniqueAxes)for(var xt=0;xt!==A.uniqueAxes.length;xt++){w.vmult(A.uniqueAxes[xt],D);var pt=$.testSepAxis(D,A,F,M,b,w);if(pt===!1)return!1;pt<G&&(G=pt,B.copy(D))}else for(var Rt=q?q.length:A.faces.length,xt=0;xt<Rt;xt++){var Nt=q?q[xt]:xt;D.copy(A.faceNormals[Nt]),w.vmult(D,D);var pt=$.testSepAxis(D,A,F,M,b,w);if(pt===!1)return!1;pt<G&&(G=pt,B.copy(D))}for(var It=0;It!==$.uniqueEdges.length;It++){M.vmult($.uniqueEdges[It],mt);for(var Pt=0;Pt!==A.uniqueEdges.length;Pt++)if(w.vmult(A.uniqueEdges[Pt],ut),mt.cross(ut,at),!at.almostZero()){at.normalize();var Vt=$.testSepAxis(at,A,F,M,b,w);if(Vt===!1)return!1;Vt<G&&(G=Vt,B.copy(at))}}return b.vsub(F,J),J.dot(B)>0&&B.negate(B),!0};var g=[],x=[];s.prototype.testSepAxis=function(A,F,M,b,w,B){var X=this;s.project(X,A,M,b,g),s.project(F,A,w,B,x);var q=g[0],T=g[1],D=x[0],J=x[1],mt=q-J,ut=D-T,at=mt<ut?mt:ut;return at};var E=new r,k=new r;s.prototype.calculateLocalInertia=function(A,F){this.computeLocalAABB(E,k);var M=k.x-E.x,b=k.y-E.y,w=k.z-E.z;F.x=1/12*A*(2*b*2*b+2*w*2*w),F.y=1/12*A*(2*M*2*M+2*w*2*w),F.z=1/12*A*(2*b*2*b+2*M*2*M)},s.prototype.getPlaneConstantOfFace=function(A){var F=this.faces[A],M=this.faceNormals[A],b=this.vertices[F[0]],w=-M.dot(b);return w};var L=new r,N=new r,Y=new r,R=new r,z=new r,I=new r,V=new r,et=new r;s.prototype.clipFaceAgainstHull=function(A,F,M,b,w,B,X){for(var q=L,T=N,D=Y,J=R,mt=z,ut=I,at=V,G=et,$=this,Ct=[],xt=b,Nt=Ct,pt=-1,Rt=Number.MAX_VALUE,It=0;It<$.faces.length;It++){q.copy($.faceNormals[It]),M.vmult(q,q);var Pt=q.dot(A);Pt<Rt&&(Rt=Pt,pt=It)}if(!(pt<0)){var Vt=$.faces[pt];Vt.connectedFaces=[];for(var Bt=0;Bt<$.faces.length;Bt++)for(var Lt=0;Lt<$.faces[Bt].length;Lt++)Vt.indexOf($.faces[Bt][Lt])!==-1&&Bt!==pt&&Vt.connectedFaces.indexOf(Bt)===-1&&Vt.connectedFaces.push(Bt);xt.length;for(var Tt=Vt.length,Yt=0;Yt<Tt;Yt++){var Jt=$.vertices[Vt[Yt]],ce=$.vertices[Vt[(Yt+1)%Tt]];Jt.vsub(ce,T),D.copy(T),M.vmult(D,D),F.vadd(D,D),J.copy(this.faceNormals[pt]),M.vmult(J,J),F.vadd(J,J),D.cross(J,mt),mt.negate(mt),ut.copy(Jt),M.vmult(ut,ut),F.vadd(ut,ut),-ut.dot(mt);var vt;{var ue=Vt.connectedFaces[Yt];at.copy(this.faceNormals[ue]);var S=this.getPlaneConstantOfFace(ue);G.copy(at),M.vmult(G,G);var vt=S-G.dot(F)}for(this.clipFaceAgainstPlane(xt,Nt,G,vt);xt.length;)xt.shift();for(;Nt.length;)xt.push(Nt.shift())}at.copy(this.faceNormals[pt]);var S=this.getPlaneConstantOfFace(pt);G.copy(at),M.vmult(G,G);for(var vt=S-G.dot(F),Bt=0;Bt<xt.length;Bt++){var Ft=G.dot(xt[Bt])+vt;if(Ft<=w&&(console.log("clamped: depth="+Ft+" to minDist="+(w+"")),Ft=w),Ft<=B){var Wt=xt[Bt];if(Ft<=0){var Ut={point:Wt,normal:G,depth:Ft};X.push(Ut)}}}}},s.prototype.clipFaceAgainstPlane=function(A,F,M,b){var w,B,X=A.length;if(X<2)return F;var q=A[A.length-1],T=A[0];w=M.dot(q)+b;for(var D=0;D<X;D++){if(T=A[D],B=M.dot(T)+b,w<0)if(B<0){var J=new r;J.copy(T),F.push(J)}else{var J=new r;q.lerp(T,w/(w-B),J),F.push(J)}else if(B<0){var J=new r;q.lerp(T,w/(w-B),J),F.push(J),F.push(T)}q=T,w=B}return F},s.prototype.computeWorldVertices=function(A,F){for(var M=this.vertices.length;this.worldVertices.length<M;)this.worldVertices.push(new r);for(var b=this.vertices,w=this.worldVertices,B=0;B!==M;B++)F.vmult(b[B],w[B]),A.vadd(w[B],w[B]);this.worldVerticesNeedsUpdate=!1},new r,s.prototype.computeLocalAABB=function(A,F){var M=this.vertices.length,b=this.vertices;A.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),F.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var w=0;w<M;w++){var B=b[w];B.x<A.x?A.x=B.x:B.x>F.x&&(F.x=B.x),B.y<A.y?A.y=B.y:B.y>F.y&&(F.y=B.y),B.z<A.z?A.z=B.z:B.z>F.z&&(F.z=B.z)}},s.prototype.computeWorldFaceNormals=function(A){for(var F=this.faceNormals.length;this.worldFaceNormals.length<F;)this.worldFaceNormals.push(new r);for(var M=this.faceNormals,b=this.worldFaceNormals,w=0;w!==F;w++)A.vmult(M[w],b[w]);this.worldFaceNormalsNeedsUpdate=!1},s.prototype.updateBoundingSphereRadius=function(){for(var A=0,F=this.vertices,M=0,b=F.length;M!==b;M++){var w=F[M].norm2();w>A&&(A=w)}this.boundingSphereRadius=Math.sqrt(A)};var K=new r;s.prototype.calculateWorldAABB=function(A,F,M,b){for(var w=this.vertices.length,B=this.vertices,X,q,T,D,J,mt,ut=0;ut<w;ut++){K.copy(B[ut]),F.vmult(K,K),A.vadd(K,K);var at=K;at.x<X||X===void 0?X=at.x:(at.x>D||D===void 0)&&(D=at.x),at.y<q||q===void 0?q=at.y:(at.y>J||J===void 0)&&(J=at.y),at.z<T||T===void 0?T=at.z:(at.z>mt||mt===void 0)&&(mt=at.z)}M.set(X,q,T),b.set(D,J,mt)},s.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},s.prototype.getAveragePointLocal=function(A){A=A||new r;for(var F=this.vertices.length,M=this.vertices,b=0;b<F;b++)A.vadd(M[b],A);return A.mult(1/F,A),A},s.prototype.transformAllPoints=function(A,F){var M=this.vertices.length,b=this.vertices;if(F){for(var w=0;w<M;w++){var B=b[w];F.vmult(B,B)}for(var w=0;w<this.faceNormals.length;w++){var B=this.faceNormals[w];F.vmult(B,B)}}if(A)for(var w=0;w<M;w++){var B=b[w];B.vadd(A,B)}};var ft=new r,_=new r,C=new r;s.prototype.pointIsInside=function(A){var F=this.vertices.length,M=this.vertices,b=this.faces,w=this.faceNormals,B=null,X=this.faces.length,q=ft;this.getAveragePointLocal(q);for(var T=0;T<X;T++){this.faces[T].length;var F=w[T],D=M[b[T][0]],J=_;A.vsub(D,J);var mt=F.dot(J),ut=C;q.vsub(D,ut);var at=F.dot(ut);if(mt<0&&at>0||mt>0&&at<0)return!1}return B?1:-1},new r;var j=new r,H=new r;s.project=function(A,F,M,b,w){var B=A.vertices.length,X=j,q=0,T=0,D=H,J=A.vertices;D.setZero(),a.vectorToLocalFrame(M,b,F,X),a.pointToLocalFrame(M,b,D,D);var mt=D.dot(X);T=q=J[0].dot(X);for(var ut=1;ut<B;ut++){var at=J[ut].dot(X);at>q&&(q=at),at<T&&(T=at)}if(T-=mt,q-=mt,T>q){var G=T;T=q,q=G}w[0]=q,w[1]=T}},{"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"./Shape":43}],39:[function(e,i,d){i.exports=s;var l=e("./Shape"),r=e("../math/Vec3");e("../math/Quaternion");var a=e("./ConvexPolyhedron");function s(c,o,n,h){var u=h,p=[],f=[],v=[],m=[],y=[],g=Math.cos,x=Math.sin;p.push(new r(o*g(0),o*x(0),-n*.5)),m.push(0),p.push(new r(c*g(0),c*x(0),n*.5)),y.push(1);for(var E=0;E<u;E++){var k=2*Math.PI/u*(E+1),L=2*Math.PI/u*(E+.5);E<u-1?(p.push(new r(o*g(k),o*x(k),-n*.5)),m.push(2*E+2),p.push(new r(c*g(k),c*x(k),n*.5)),y.push(2*E+3),v.push([2*E+2,2*E+3,2*E+1,2*E])):v.push([0,1,2*E+1,2*E]),(u%2===1||E<u/2)&&f.push(new r(g(L),x(L),0))}v.push(y),f.push(new r(0,0,1));for(var N=[],E=0;E<m.length;E++)N.push(m[m.length-E-1]);v.push(N),this.type=l.types.CONVEXPOLYHEDRON,a.call(this,p,v,f)}s.prototype=new a},{"../math/Quaternion":28,"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],40:[function(e,i,d){var l=e("./Shape"),r=e("./ConvexPolyhedron"),a=e("../math/Vec3"),s=e("../utils/Utils");i.exports=c;function c(o,n){n=s.defaults(n,{maxValue:null,minValue:null,elementSize:1}),this.data=o,this.maxValue=n.maxValue,this.minValue=n.minValue,this.elementSize=n.elementSize,n.minValue===null&&this.updateMinValue(),n.maxValue===null&&this.updateMaxValue(),this.cacheEnabled=!0,l.call(this),this.pillarConvex=new r,this.pillarOffset=new a,this.type=l.types.HEIGHTFIELD,this.updateBoundingSphereRadius(),this._cachedPillars={}}c.prototype=new l,c.prototype.update=function(){this._cachedPillars={}},c.prototype.updateMinValue=function(){for(var o=this.data,n=o[0][0],h=0;h!==o.length;h++)for(var u=0;u!==o[h].length;u++){var p=o[h][u];p<n&&(n=p)}this.minValue=n},c.prototype.updateMaxValue=function(){for(var o=this.data,n=o[0][0],h=0;h!==o.length;h++)for(var u=0;u!==o[h].length;u++){var p=o[h][u];p>n&&(n=p)}this.maxValue=n},c.prototype.setHeightValueAtIndex=function(o,n,h){var u=this.data;u[o][n]=h,this.clearCachedConvexTrianglePillar(o,n,!1),o>0&&(this.clearCachedConvexTrianglePillar(o-1,n,!0),this.clearCachedConvexTrianglePillar(o-1,n,!1)),n>0&&(this.clearCachedConvexTrianglePillar(o,n-1,!0),this.clearCachedConvexTrianglePillar(o,n-1,!1)),n>0&&o>0&&this.clearCachedConvexTrianglePillar(o-1,n-1,!0)},c.prototype.getRectMinMax=function(o,n,h,u,p){p=p||[];for(var f=this.data,v=this.minValue,m=o;m<=h;m++)for(var y=n;y<=u;y++){var g=f[m][y];g>v&&(v=g)}p[0]=this.minValue,p[1]=v},c.prototype.getIndexOfPosition=function(o,n,h,u){var p=this.elementSize,f=this.data,v=Math.floor(o/p),m=Math.floor(n/p);return h[0]=v,h[1]=m,u&&(v<0&&(v=0),m<0&&(m=0),v>=f.length-1&&(v=f.length-1),m>=f[0].length-1&&(m=f[0].length-1)),!(v<0||m<0||v>=f.length-1||m>=f[0].length-1)},c.prototype.getHeightAt=function(o,n,h){var u=[];this.getIndexOfPosition(o,n,u,h);var p=[];return this.getRectMinMax(u[0],u[1]+1,u[0],u[1]+1,p),(p[0]+p[1])/2},c.prototype.getCacheConvexTrianglePillarKey=function(o,n,h){return o+"_"+n+"_"+(h?1:0)},c.prototype.getCachedConvexTrianglePillar=function(o,n,h){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(o,n,h)]},c.prototype.setCachedConvexTrianglePillar=function(o,n,h,u,p){this._cachedPillars[this.getCacheConvexTrianglePillarKey(o,n,h)]={convex:u,offset:p}},c.prototype.clearCachedConvexTrianglePillar=function(o,n,h){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(o,n,h)]},c.prototype.getConvexTrianglePillar=function(o,n,h){var u=this.pillarConvex,p=this.pillarOffset;if(this.cacheEnabled){var f=this.getCachedConvexTrianglePillar(o,n,h);if(f){this.pillarConvex=f.convex,this.pillarOffset=f.offset;return}u=new r,p=new a,this.pillarConvex=u,this.pillarOffset=p}var f=this.data,v=this.elementSize,m=u.faces;u.vertices.length=6;for(var y=0;y<6;y++)u.vertices[y]||(u.vertices[y]=new a);m.length=5;for(var y=0;y<5;y++)m[y]||(m[y]=[]);var g=u.vertices,x=(Math.min(f[o][n],f[o+1][n],f[o][n+1],f[o+1][n+1])-this.minValue)/2+this.minValue;h?(p.set((o+.75)*v,(n+.75)*v,x),g[0].set(.25*v,.25*v,f[o+1][n+1]-x),g[1].set(-.75*v,.25*v,f[o][n+1]-x),g[2].set(.25*v,-.75*v,f[o+1][n]-x),g[3].set(.25*v,.25*v,-x-1),g[4].set(-.75*v,.25*v,-x-1),g[5].set(.25*v,-.75*v,-x-1),m[0][0]=0,m[0][1]=1,m[0][2]=2,m[1][0]=5,m[1][1]=4,m[1][2]=3,m[2][0]=2,m[2][1]=5,m[2][2]=3,m[2][3]=0,m[3][0]=3,m[3][1]=4,m[3][2]=1,m[3][3]=0,m[4][0]=1,m[4][1]=4,m[4][2]=5,m[4][3]=2):(p.set((o+.25)*v,(n+.25)*v,x),g[0].set(-.25*v,-.25*v,f[o][n]-x),g[1].set(.75*v,-.25*v,f[o+1][n]-x),g[2].set(-.25*v,.75*v,f[o][n+1]-x),g[3].set(-.25*v,-.25*v,-x-1),g[4].set(.75*v,-.25*v,-x-1),g[5].set(-.25*v,.75*v,-x-1),m[0][0]=0,m[0][1]=1,m[0][2]=2,m[1][0]=5,m[1][1]=4,m[1][2]=3,m[2][0]=0,m[2][1]=2,m[2][2]=5,m[2][3]=3,m[3][0]=1,m[3][1]=0,m[3][2]=3,m[3][3]=4,m[4][0]=4,m[4][1]=5,m[4][2]=2,m[4][3]=1),u.computeNormals(),u.computeEdges(),u.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(o,n,h,u,p)},c.prototype.calculateLocalInertia=function(o,n){return n=n||new a,n.set(0,0,0),n},c.prototype.volume=function(){return Number.MAX_VALUE},c.prototype.calculateWorldAABB=function(o,n,h,u){h.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),u.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},c.prototype.updateBoundingSphereRadius=function(){var o=this.data,n=this.elementSize;this.boundingSphereRadius=new a(o.length*n,o[0].length*n,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).norm()}},{"../math/Vec3":30,"../utils/Utils":53,"./ConvexPolyhedron":38,"./Shape":43}],41:[function(e,i,d){i.exports=a;var l=e("./Shape"),r=e("../math/Vec3");function a(){l.call(this),this.type=l.types.PARTICLE}a.prototype=new l,a.prototype.constructor=a,a.prototype.calculateLocalInertia=function(s,c){return c=c||new r,c.set(0,0,0),c},a.prototype.volume=function(){return 0},a.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0},a.prototype.calculateWorldAABB=function(s,c,o,n){o.copy(s),n.copy(s)}},{"../math/Vec3":30,"./Shape":43}],42:[function(e,i,d){i.exports=a;var l=e("./Shape"),r=e("../math/Vec3");function a(){l.call(this),this.type=l.types.PLANE,this.worldNormal=new r,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}a.prototype=new l,a.prototype.constructor=a,a.prototype.computeWorldNormal=function(c){var o=this.worldNormal;o.set(0,0,1),c.vmult(o,o),this.worldNormalNeedsUpdate=!1},a.prototype.calculateLocalInertia=function(c,o){return o=o||new r,o},a.prototype.volume=function(){return Number.MAX_VALUE};var s=new r;a.prototype.calculateWorldAABB=function(c,o,n,h){s.set(0,0,1),o.vmult(s,s);var u=Number.MAX_VALUE;n.set(-u,-u,-u),h.set(u,u,u),s.x===1&&(h.x=c.x),s.y===1&&(h.y=c.y),s.z===1&&(h.z=c.z),s.x===-1&&(n.x=c.x),s.y===-1&&(n.y=c.y),s.z===-1&&(n.z=c.z)},a.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":30,"./Shape":43}],43:[function(e,i,d){i.exports=l;var l=e("./Shape");e("../math/Vec3"),e("../math/Quaternion"),e("../material/Material");function l(){this.id=l.idCounter++,this.type=0,this.boundingSphereRadius=0,this.collisionResponse=!0,this.material=null}l.prototype.constructor=l,l.prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type},l.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type},l.prototype.calculateLocalInertia=function(r,a){throw"calculateLocalInertia() not implemented for shape type "+this.type},l.idCounter=0,l.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"./Shape":43}],44:[function(e,i,d){i.exports=a;var l=e("./Shape"),r=e("../math/Vec3");function a(s){if(l.call(this),this.radius=s!==void 0?Number(s):1,this.type=l.types.SPHERE,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}a.prototype=new l,a.prototype.constructor=a,a.prototype.calculateLocalInertia=function(s,c){c=c||new r;var o=2*s*this.radius*this.radius/5;return c.x=o,c.y=o,c.z=o,c},a.prototype.volume=function(){return 4*Math.PI*this.radius/3},a.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius},a.prototype.calculateWorldAABB=function(s,c,o,n){for(var h=this.radius,u=["x","y","z"],p=0;p<u.length;p++){var f=u[p];o[f]=s[f]-h,n[f]=s[f]+h}}},{"../math/Vec3":30,"./Shape":43}],45:[function(e,i,d){i.exports=o;var l=e("./Shape"),r=e("../math/Vec3");e("../math/Quaternion");var a=e("../math/Transform"),s=e("../collision/AABB"),c=e("../utils/Octree");function o(N,Y){l.call(this),this.type=l.types.TRIMESH,this.vertices=new Float32Array(N),this.indices=new Int16Array(Y),this.normals=new Float32Array(Y.length),this.aabb=new s,this.edges=null,this.scale=new r(1,1,1),this.tree=new c,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}o.prototype=new l,o.prototype.constructor=o;var n=new r;o.prototype.updateTree=function(){var N=this.tree;N.reset(),N.aabb.copy(this.aabb);var Y=this.scale;N.aabb.lowerBound.x*=1/Y.x,N.aabb.lowerBound.y*=1/Y.y,N.aabb.lowerBound.z*=1/Y.z,N.aabb.upperBound.x*=1/Y.x,N.aabb.upperBound.y*=1/Y.y,N.aabb.upperBound.z*=1/Y.z;for(var R=new s,z=new r,I=new r,V=new r,et=[z,I,V],K=0;K<this.indices.length/3;K++){var ft=K*3;this._getUnscaledVertex(this.indices[ft],z),this._getUnscaledVertex(this.indices[ft+1],I),this._getUnscaledVertex(this.indices[ft+2],V),R.setFromPoints(et),N.insert(R,K)}N.removeEmptyNodes()};var h=new s;o.prototype.getTrianglesInAABB=function(N,Y){h.copy(N);var R=this.scale,z=R.x,I=R.y,V=R.z,et=h.lowerBound,K=h.upperBound;return et.x/=z,et.y/=I,et.z/=V,K.x/=z,K.y/=I,K.z/=V,this.tree.aabbQuery(h,Y)},o.prototype.setScale=function(N){var Y=this.scale.x===this.scale.y===this.scale.z,R=N.x===N.y===N.z;Y&&R||this.updateNormals(),this.scale.copy(N),this.updateAABB(),this.updateBoundingSphereRadius()},o.prototype.updateNormals=function(){for(var N=n,Y=this.normals,R=0;R<this.indices.length/3;R++){var z=R*3,I=this.indices[z],V=this.indices[z+1],et=this.indices[z+2];this.getVertex(I,m),this.getVertex(V,y),this.getVertex(et,g),o.computeNormal(y,m,g,N),Y[z]=N.x,Y[z+1]=N.y,Y[z+2]=N.z}},o.prototype.updateEdges=function(){for(var N={},Y=function(ft,_){var C=I<V?I+"_"+V:V+"_"+I;N[C]=!0},R=0;R<this.indices.length/3;R++){var z=R*3,I=this.indices[z],V=this.indices[z+1];this.indices[z+2],Y(),Y(),Y()}var et=Object.keys(N);this.edges=new Int16Array(et.length*2);for(var R=0;R<et.length;R++){var K=et[R].split("_");this.edges[2*R]=parseInt(K[0],10),this.edges[2*R+1]=parseInt(K[1],10)}},o.prototype.getEdgeVertex=function(N,Y,R){var z=this.edges[N*2+(Y?1:0)];this.getVertex(z,R)};var u=new r,p=new r;o.prototype.getEdgeVector=function(N,Y){var R=u,z=p;this.getEdgeVertex(N,0,R),this.getEdgeVertex(N,1,z),z.vsub(R,Y)};var f=new r,v=new r;o.computeNormal=function(N,Y,R,z){Y.vsub(N,v),R.vsub(Y,f),f.cross(v,z),z.isZero()||z.normalize()};var m=new r,y=new r,g=new r;o.prototype.getVertex=function(N,Y){var R=this.scale;return this._getUnscaledVertex(N,Y),Y.x*=R.x,Y.y*=R.y,Y.z*=R.z,Y},o.prototype._getUnscaledVertex=function(N,Y){var R=N*3,z=this.vertices;return Y.set(z[R],z[R+1],z[R+2])},o.prototype.getWorldVertex=function(N,Y,R,z){return this.getVertex(N,z),a.pointToWorldFrame(Y,R,z,z),z},o.prototype.getTriangleVertices=function(N,Y,R,z){var I=N*3;this.getVertex(this.indices[I],Y),this.getVertex(this.indices[I+1],R),this.getVertex(this.indices[I+2],z)},o.prototype.getNormal=function(N,Y){var R=N*3;return Y.set(this.normals[R],this.normals[R+1],this.normals[R+2])};var x=new s;o.prototype.calculateLocalInertia=function(N,Y){this.computeLocalAABB(x);var R=x.upperBound.x-x.lowerBound.x,z=x.upperBound.y-x.lowerBound.y,I=x.upperBound.z-x.lowerBound.z;return Y.set(1/12*N*(2*z*2*z+2*I*2*I),1/12*N*(2*R*2*R+2*I*2*I),1/12*N*(2*z*2*z+2*R*2*R))};var E=new r;o.prototype.computeLocalAABB=function(N){var Y=N.lowerBound,R=N.upperBound,z=this.vertices.length;this.vertices;var I=E;this.getVertex(0,I),Y.copy(I),R.copy(I);for(var V=0;V!==z;V++)this.getVertex(V,I),I.x<Y.x?Y.x=I.x:I.x>R.x&&(R.x=I.x),I.y<Y.y?Y.y=I.y:I.y>R.y&&(R.y=I.y),I.z<Y.z?Y.z=I.z:I.z>R.z&&(R.z=I.z)},o.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)},o.prototype.updateBoundingSphereRadius=function(){for(var N=0,Y=this.vertices,R=new r,z=0,I=Y.length/3;z!==I;z++){this.getVertex(z,R);var V=R.norm2();V>N&&(N=V)}this.boundingSphereRadius=Math.sqrt(N)},new r;var k=new a,L=new s;o.prototype.calculateWorldAABB=function(N,Y,R,z){var I=k,V=L;I.position=N,I.quaternion=Y,this.aabb.toWorldFrame(I,V),R.copy(V.lowerBound),z.copy(V.upperBound)},o.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},o.createTorus=function(N,Y,R,z,I){N=N||1,Y=Y||.5,R=R||8,z=z||6,I=I||Math.PI*2;for(var V=[],et=[],K=0;K<=R;K++)for(var ft=0;ft<=z;ft++){var _=ft/z*I,C=K/R*Math.PI*2,j=(N+Y*Math.cos(C))*Math.cos(_),H=(N+Y*Math.cos(C))*Math.sin(_),A=Y*Math.sin(C);V.push(j,H,A)}for(var K=1;K<=R;K++)for(var ft=1;ft<=z;ft++){var F=(z+1)*K+ft-1,M=(z+1)*(K-1)+ft-1,b=(z+1)*(K-1)+ft,w=(z+1)*K+ft;et.push(F,M,w),et.push(M,b,w)}return new o(V,et)}},{"../collision/AABB":3,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../utils/Octree":50,"./Shape":43}],46:[function(e,i,d){i.exports=r,e("../math/Vec3"),e("../math/Quaternion");var l=e("./Solver");function r(){l.call(this),this.iterations=10,this.tolerance=1e-7}r.prototype=new l;var a=[],s=[],c=[];r.prototype.solve=function(o,n){var h=0,u=this.iterations,p=this.tolerance*this.tolerance,f=this.equations,v=f.length,m=n.bodies,y=m.length,g=o,x,E,k,L,N,Y;if(v!==0)for(var R=0;R!==y;R++)m[R].updateSolveMassProperties();var z=s,I=c,V=a;z.length=v,I.length=v,V.length=v;for(var R=0;R!==v;R++){var et=f[R];V[R]=0,I[R]=et.computeB(g),z[R]=1/et.computeC()}if(v!==0){for(var R=0;R!==y;R++){var K=m[R],ft=K.vlambda,_=K.wlambda;ft.set(0,0,0),_&&_.set(0,0,0)}for(h=0;h!==u;h++){L=0;for(var C=0;C!==v;C++){var et=f[C];x=I[C],E=z[C],Y=V[C],N=et.computeGWlambda(),k=E*(x-N-et.eps*Y),Y+k<et.minForce?k=et.minForce-Y:Y+k>et.maxForce&&(k=et.maxForce-Y),V[C]+=k,L+=k>0?k:-k,et.addToWlambda(k)}if(L*L<p)break}for(var R=0;R!==y;R++){var K=m[R],j=K.velocity,H=K.angularVelocity;j.vadd(K.vlambda,j),H&&H.vadd(K.wlambda,H)}}return h}},{"../math/Quaternion":28,"../math/Vec3":30,"./Solver":47}],47:[function(e,i,d){i.exports=l;function l(){this.equations=[]}l.prototype.solve=function(r,a){return 0},l.prototype.addEquation=function(r){r.enabled&&this.equations.push(r)},l.prototype.removeEquation=function(r){var a=this.equations,s=a.indexOf(r);s!==-1&&a.splice(s,1)},l.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(e,i,d){i.exports=a,e("../math/Vec3"),e("../math/Quaternion");var l=e("./Solver"),r=e("../objects/Body");function a(m){for(l.call(this),this.iterations=10,this.tolerance=1e-7,this.subsolver=m,this.nodes=[],this.nodePool=[];this.nodePool.length<128;)this.nodePool.push(this.createNode())}a.prototype=new l;var s=[],c=[],o={bodies:[]},n=r.STATIC;function h(m){for(var y=m.length,g=0;g!==y;g++){var x=m[g];if(!x.visited&&!(x.body.type&n))return x}return!1}var u=[];function p(m,y,g,x){for(u.push(m),m.visited=!0,y(m,g,x);u.length;)for(var E=u.pop(),k;k=h(E.children);)k.visited=!0,y(k,g,x),u.push(k)}function f(m,y,g){y.push(m.body);for(var x=m.eqs.length,E=0;E!==x;E++){var k=m.eqs[E];g.indexOf(k)===-1&&g.push(k)}}a.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}},a.prototype.solve=function(m,y){for(var g=s,x=this.nodePool,E=y.bodies,k=this.equations,L=k.length,N=E.length,Y=this.subsolver;x.length<N;)x.push(this.createNode());g.length=N;for(var R=0;R<N;R++)g[R]=x[R];for(var R=0;R!==N;R++){var z=g[R];z.body=E[R],z.children.length=0,z.eqs.length=0,z.visited=!1}for(var I=0;I!==L;I++){var V=k[I],R=E.indexOf(V.bi),et=E.indexOf(V.bj),K=g[R],ft=g[et];K.children.push(ft),K.eqs.push(V),ft.children.push(K),ft.eqs.push(V)}var _,C=0,j=c;Y.tolerance=this.tolerance,Y.iterations=this.iterations;for(var H=o;_=h(g);){j.length=0,H.bodies.length=0,p(_,f,H.bodies,j);var A=j.length;j=j.sort(v);for(var R=0;R!==A;R++)Y.addEquation(j[R]);Y.solve(m,H),Y.removeAllEquations(),C++}return C};function v(m,y){return y.id-m.id}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"./Solver":47}],49:[function(e,i,d){var l=function(){};i.exports=l,l.prototype={constructor:l,addEventListener:function(r,a){this._listeners===void 0&&(this._listeners={});var s=this._listeners;return s[r]===void 0&&(s[r]=[]),s[r].indexOf(a)===-1&&s[r].push(a),this},hasEventListener:function(r,a){if(this._listeners===void 0)return!1;var s=this._listeners;return s[r]!==void 0&&s[r].indexOf(a)!==-1},removeEventListener:function(r,a){if(this._listeners===void 0)return this;var s=this._listeners;if(s[r]===void 0)return this;var c=s[r].indexOf(a);return c!==-1&&s[r].splice(c,1),this},dispatchEvent:function(r){if(this._listeners===void 0)return this;var a=this._listeners,s=a[r.type];if(s!==void 0){r.target=this;for(var c=0,o=s.length;c<o;c++)s[c].call(this,r)}return this}}},{}],50:[function(e,i,d){var l=e("../collision/AABB"),r=e("../math/Vec3");i.exports=s;function a(n){n=n||{},this.root=n.root||null,this.aabb=n.aabb?n.aabb.clone():new l,this.data=[],this.children=[]}function s(n,h){h=h||{},h.root=null,h.aabb=n,a.call(this,h),this.maxDepth=typeof h.maxDepth<"u"?h.maxDepth:8}s.prototype=new a,a.prototype.reset=function(n,h){this.children.length=this.data.length=0},a.prototype.insert=function(n,h,u){var p=this.data;if(u=u||0,!this.aabb.contains(n))return!1;var f=this.children;if(u<(this.maxDepth||this.root.maxDepth)){var v=!1;f.length||(this.subdivide(),v=!0);for(var m=0;m!==8;m++)if(f[m].insert(n,h,u+1))return!0;v&&(f.length=0)}return p.push(h),!0};var c=new r;a.prototype.subdivide=function(){var n=this.aabb,h=n.lowerBound,u=n.upperBound,p=this.children;p.push(new a({aabb:new l({lowerBound:new r(0,0,0)})}),new a({aabb:new l({lowerBound:new r(1,0,0)})}),new a({aabb:new l({lowerBound:new r(1,1,0)})}),new a({aabb:new l({lowerBound:new r(1,1,1)})}),new a({aabb:new l({lowerBound:new r(0,1,1)})}),new a({aabb:new l({lowerBound:new r(0,0,1)})}),new a({aabb:new l({lowerBound:new r(1,0,1)})}),new a({aabb:new l({lowerBound:new r(0,1,0)})})),u.vsub(h,c),c.scale(.5,c);for(var f=this.root||this,v=0;v!==8;v++){var m=p[v];m.root=f;var y=m.aabb.lowerBound;y.x*=c.x,y.y*=c.y,y.z*=c.z,y.vadd(h,y),y.vadd(c,m.aabb.upperBound)}},a.prototype.aabbQuery=function(n,h){this.data,this.children;for(var u=[this];u.length;){var p=u.pop();p.aabb.overlaps(n)&&Array.prototype.push.apply(h,p.data),Array.prototype.push.apply(u,p.children)}return h};var o=new l;a.prototype.rayQuery=function(n,h,u){return n.getAABB(o),o.toLocalFrame(h,o),this.aabbQuery(o,u),u},a.prototype.removeEmptyNodes=function(){for(var n=[this];n.length;){for(var h=n.pop(),u=h.children.length-1;u>=0;u--)h.children[u].data.length||h.children.splice(u,1);Array.prototype.push.apply(n,h.children)}}},{"../collision/AABB":3,"../math/Vec3":30}],51:[function(e,i,d){i.exports=l;function l(){this.objects=[],this.type=Object}l.prototype.release=function(){for(var r=arguments.length,a=0;a!==r;a++)this.objects.push(arguments[a])},l.prototype.get=function(){return this.objects.length===0?this.constructObject():this.objects.pop()},l.prototype.constructObject=function(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}},{}],52:[function(e,i,d){i.exports=l;function l(){this.data={keys:[]}}l.prototype.get=function(r,a){if(r>a){var s=a;a=r,r=s}return this.data[r+"-"+a]},l.prototype.set=function(r,a,s){if(r>a){var c=a;a=r,r=c}var o=r+"-"+a;this.get(r,a)||this.data.keys.push(o),this.data[o]=s},l.prototype.reset=function(){for(var r=this.data,a=r.keys;a.length>0;){var s=a.pop();delete r[s]}}},{}],53:[function(e,i,d){function l(){}i.exports=l,l.defaults=function(r,a){r=r||{};for(var s in a)s in r||(r[s]=a[s]);return r}},{}],54:[function(e,i,d){i.exports=a;var l=e("../math/Vec3"),r=e("./Pool");function a(){r.call(this),this.type=l}a.prototype=new r,a.prototype.constructObject=function(){return new l}},{"../math/Vec3":30,"./Pool":51}],55:[function(e,i,d){i.exports=p;var l=e("../collision/AABB"),r=e("../shapes/Shape"),a=e("../collision/Ray"),s=e("../math/Vec3"),c=e("../math/Transform");e("../shapes/ConvexPolyhedron");var o=e("../math/Quaternion");e("../solver/Solver");var n=e("../utils/Vec3Pool"),h=e("../equations/ContactEquation"),u=e("../equations/FrictionEquation");function p(W){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new n,this.world=W,this.currentContactMaterial=null,this.enableFrictionReduction=!1}p.prototype.createContactEquation=function(W,U,Z,Q,gt,ct){var nt;this.contactPointPool.length?(nt=this.contactPointPool.pop(),nt.bi=W,nt.bj=U):nt=new h(W,U),nt.enabled=W.collisionResponse&&U.collisionResponse&&Z.collisionResponse&&Q.collisionResponse;var ht=this.currentContactMaterial;nt.restitution=ht.restitution,nt.setSpookParams(ht.contactEquationStiffness,ht.contactEquationRelaxation,this.world.dt);var P=Z.material||W.material,rt=Q.material||U.material;return P&&rt&&P.restitution>=0&&rt.restitution>=0&&(nt.restitution=P.restitution*rt.restitution),nt.si=gt||Z,nt.sj=ct||Q,nt},p.prototype.createFrictionEquationsFromContact=function(W,U){var Z=W.bi,Q=W.bj,gt=W.si,ct=W.sj,nt=this.world,ht=this.currentContactMaterial,P=ht.friction,rt=gt.material||Z.material,lt=ct.material||Q.material;if(rt&&lt&&rt.friction>=0&&lt.friction>=0&&(P=rt.friction*lt.friction),P>0){var dt=P*nt.gravity.length(),st=Z.invMass+Q.invMass;st>0&&(st=1/st);var it=this.frictionEquationPool,ot=it.length?it.pop():new u(Z,Q,dt*st),yt=it.length?it.pop():new u(Z,Q,dt*st);return ot.bi=yt.bi=Z,ot.bj=yt.bj=Q,ot.minForce=yt.minForce=-dt*st,ot.maxForce=yt.maxForce=dt*st,ot.ri.copy(W.ri),ot.rj.copy(W.rj),yt.ri.copy(W.ri),yt.rj.copy(W.rj),W.ni.tangents(ot.t,yt.t),ot.setSpookParams(ht.frictionEquationStiffness,ht.frictionEquationRelaxation,nt.dt),yt.setSpookParams(ht.frictionEquationStiffness,ht.frictionEquationRelaxation,nt.dt),ot.enabled=yt.enabled=W.enabled,U.push(ot,yt),!0}return!1};var f=new s,v=new s,m=new s;p.prototype.createFrictionFromAverage=function(W){var U=this.result[this.result.length-1];if(!(!this.createFrictionEquationsFromContact(U,this.frictionResult)||W===1)){var Z=this.frictionResult[this.frictionResult.length-2],Q=this.frictionResult[this.frictionResult.length-1];f.setZero(),v.setZero(),m.setZero();var gt=U.bi;U.bj;for(var ct=0;ct!==W;ct++)U=this.result[this.result.length-1-ct],U.bodyA!==gt?(f.vadd(U.ni,f),v.vadd(U.ri,v),m.vadd(U.rj,m)):(f.vsub(U.ni,f),v.vadd(U.rj,v),m.vadd(U.ri,m));var nt=1/W;v.scale(nt,Z.ri),m.scale(nt,Z.rj),Q.ri.copy(Z.ri),Q.rj.copy(Z.rj),f.normalize(),f.tangents(Z.t,Q.t)}};var y=new s,g=new s,x=new o,E=new o;p.prototype.getContacts=function(W,U,Z,Q,gt,ct,nt){this.contactPointPool=gt,this.frictionEquationPool=nt,this.result=Q,this.frictionResult=ct;for(var ht=x,P=E,rt=y,lt=g,dt=0,st=W.length;dt!==st;dt++){var it=W[dt],ot=U[dt],yt=null;it.material&&ot.material&&(yt=Z.getContactMaterial(it.material,ot.material)||null);for(var Mt=0;Mt<it.shapes.length;Mt++){it.quaternion.mult(it.shapeOrientations[Mt],ht),it.quaternion.vmult(it.shapeOffsets[Mt],rt),rt.vadd(it.position,rt);for(var tt=it.shapes[Mt],At=0;At<ot.shapes.length;At++){ot.quaternion.mult(ot.shapeOrientations[At],P),ot.quaternion.vmult(ot.shapeOffsets[At],lt),lt.vadd(ot.position,lt);var zt=ot.shapes[At];if(!(rt.distanceTo(lt)>tt.boundingSphereRadius+zt.boundingSphereRadius)){var Ht=null;tt.material&&zt.material&&(Ht=Z.getContactMaterial(tt.material,zt.material)||null),this.currentContactMaterial=Ht||yt||Z.defaultContactMaterial;var St=this[tt.type|zt.type];St&&(tt.type<zt.type?St.call(this,tt,zt,rt,lt,ht,P,it,ot,tt,zt):St.call(this,zt,tt,lt,rt,P,ht,ot,it,tt,zt))}}}}},p.prototype[r.types.BOX|r.types.BOX]=p.prototype.boxBox=function(W,U,Z,Q,gt,ct,nt,ht){W.convexPolyhedronRepresentation.material=W.material,U.convexPolyhedronRepresentation.material=U.material,W.convexPolyhedronRepresentation.collisionResponse=W.collisionResponse,U.convexPolyhedronRepresentation.collisionResponse=U.collisionResponse,this.convexConvex(W.convexPolyhedronRepresentation,U.convexPolyhedronRepresentation,Z,Q,gt,ct,nt,ht,W,U)},p.prototype[r.types.BOX|r.types.CONVEXPOLYHEDRON]=p.prototype.boxConvex=function(W,U,Z,Q,gt,ct,nt,ht){W.convexPolyhedronRepresentation.material=W.material,W.convexPolyhedronRepresentation.collisionResponse=W.collisionResponse,this.convexConvex(W.convexPolyhedronRepresentation,U,Z,Q,gt,ct,nt,ht,W,U)},p.prototype[r.types.BOX|r.types.PARTICLE]=p.prototype.boxParticle=function(W,U,Z,Q,gt,ct,nt,ht){W.convexPolyhedronRepresentation.material=W.material,W.convexPolyhedronRepresentation.collisionResponse=W.collisionResponse,this.convexParticle(W.convexPolyhedronRepresentation,U,Z,Q,gt,ct,nt,ht,W,U)},p.prototype[r.types.SPHERE]=p.prototype.sphereSphere=function(W,U,Z,Q,gt,ct,nt,ht){var P=this.createContactEquation(nt,ht,W,U);Q.vsub(Z,P.ni),P.ni.normalize(),P.ri.copy(P.ni),P.rj.copy(P.ni),P.ri.mult(W.radius,P.ri),P.rj.mult(-U.radius,P.rj),P.ri.vadd(Z,P.ri),P.ri.vsub(nt.position,P.ri),P.rj.vadd(Q,P.rj),P.rj.vsub(ht.position,P.rj),this.result.push(P),this.createFrictionEquationsFromContact(P,this.frictionResult)};var k=new s,L=new s,N=new s;p.prototype[r.types.PLANE|r.types.TRIMESH]=p.prototype.planeTrimesh=function(W,U,Z,Q,gt,ct,nt,ht){var P=new s,rt=k;rt.set(0,0,1),gt.vmult(rt,rt);for(var lt=0;lt<U.vertices.length/3;lt++){U.getVertex(lt,P);var dt=new s;dt.copy(P),c.pointToWorldFrame(Q,ct,dt,P);var st=L;P.vsub(Z,st);var it=rt.dot(st);if(it<=0){var ot=this.createContactEquation(nt,ht,W,U);ot.ni.copy(rt);var yt=N;rt.scale(st.dot(rt),yt),P.vsub(yt,yt),ot.ri.copy(yt),ot.ri.vsub(nt.position,ot.ri),ot.rj.copy(P),ot.rj.vsub(ht.position,ot.rj),this.result.push(ot),this.createFrictionEquationsFromContact(ot,this.frictionResult)}}};var Y=new s,R=new s;new s;var z=new s,I=new s,V=new s,et=new s,K=new s,ft=new s,_=new s,C=new s,j=new s,H=new s,A=new s,F=new l,M=[];p.prototype[r.types.SPHERE|r.types.TRIMESH]=p.prototype.sphereTrimesh=function(W,U,Z,Q,gt,ct,nt,ht){var P=V,rt=et,lt=K,dt=ft,st=_,it=C,ot=F,yt=I,Mt=R,tt=M;c.pointToLocalFrame(Q,ct,Z,st);var At=W.radius;ot.lowerBound.set(st.x-At,st.y-At,st.z-At),ot.upperBound.set(st.x+At,st.y+At,st.z+At),U.getTrianglesInAABB(ot,tt);for(var zt=z,Ht=W.radius*W.radius,St=0;St<tt.length;St++)for(var _t=0;_t<3;_t++)if(U.getVertex(U.indices[tt[St]*3+_t],zt),zt.vsub(st,Mt),Mt.norm2()<=Ht){yt.copy(zt),c.pointToWorldFrame(Q,ct,yt,zt),zt.vsub(Z,Mt);var wt=this.createContactEquation(nt,ht,W,U);wt.ni.copy(Mt),wt.ni.normalize(),wt.ri.copy(wt.ni),wt.ri.scale(W.radius,wt.ri),wt.ri.vadd(Z,wt.ri),wt.ri.vsub(nt.position,wt.ri),wt.rj.copy(zt),wt.rj.vsub(ht.position,wt.rj),this.result.push(wt),this.createFrictionEquationsFromContact(wt,this.frictionResult)}for(var St=0;St<tt.length;St++)for(var _t=0;_t<3;_t++){U.getVertex(U.indices[tt[St]*3+_t],P),U.getVertex(U.indices[tt[St]*3+(_t+1)%3],rt),rt.vsub(P,lt),st.vsub(rt,it);var ve=it.dot(lt);st.vsub(P,it);var me=it.dot(lt);if(me>0&&ve<0){st.vsub(P,it),dt.copy(lt),dt.normalize(),me=it.dot(dt),dt.scale(me,it),it.vadd(P,it);var re=it.distanceTo(st);if(re<W.radius){var wt=this.createContactEquation(nt,ht,W,U);it.vsub(st,wt.ni),wt.ni.normalize(),wt.ni.scale(W.radius,wt.ri),c.pointToWorldFrame(Q,ct,it,it),it.vsub(ht.position,wt.rj),c.vectorToWorldFrame(ct,wt.ni,wt.ni),c.vectorToWorldFrame(ct,wt.ri,wt.ri),this.result.push(wt),this.createFrictionEquationsFromContact(wt,this.frictionResult)}}}for(var be=j,se=H,Ot=A,Me=Y,St=0,qt=tt.length;St!==qt;St++){U.getTriangleVertices(tt[St],be,se,Ot),U.getNormal(tt[St],Me),st.vsub(be,it);var re=it.dot(Me);if(Me.scale(re,it),st.vsub(it,it),re=it.distanceTo(st),a.pointInTriangle(it,be,se,Ot)&&re<W.radius){var wt=this.createContactEquation(nt,ht,W,U);it.vsub(st,wt.ni),wt.ni.normalize(),wt.ni.scale(W.radius,wt.ri),c.pointToWorldFrame(Q,ct,it,it),it.vsub(ht.position,wt.rj),c.vectorToWorldFrame(ct,wt.ni,wt.ni),c.vectorToWorldFrame(ct,wt.ri,wt.ri),this.result.push(wt),this.createFrictionEquationsFromContact(wt,this.frictionResult)}}tt.length=0};var b=new s,w=new s;p.prototype[r.types.SPHERE|r.types.PLANE]=p.prototype.spherePlane=function(W,U,Z,Q,gt,ct,nt,ht){var P=this.createContactEquation(nt,ht,W,U);if(P.ni.set(0,0,1),ct.vmult(P.ni,P.ni),P.ni.negate(P.ni),P.ni.normalize(),P.ni.mult(W.radius,P.ri),Z.vsub(Q,b),P.ni.mult(P.ni.dot(b),w),b.vsub(w,P.rj),-b.dot(P.ni)<=W.radius){var rt=P.ri,lt=P.rj;rt.vadd(Z,rt),rt.vsub(nt.position,rt),lt.vadd(Q,lt),lt.vsub(ht.position,lt),this.result.push(P),this.createFrictionEquationsFromContact(P,this.frictionResult)}};var B=new s,X=new s,q=new s;function T(W,U,Z){for(var Q=null,gt=W.length,ct=0;ct!==gt;ct++){var nt=W[ct],ht=B;W[(ct+1)%gt].vsub(nt,ht);var P=X;ht.cross(U,P);var rt=q;Z.vsub(nt,rt);var lt=P.dot(rt);if(Q===null||lt>0&&Q===!0||lt<=0&&Q===!1){Q===null&&(Q=lt>0);continue}else return!1}return!0}var D=new s,J=new s,mt=new s,ut=new s,at=[new s,new s,new s,new s,new s,new s],G=new s,$=new s,Ct=new s,xt=new s;p.prototype[r.types.SPHERE|r.types.BOX]=p.prototype.sphereBox=function(W,U,Z,Q,gt,ct,nt,ht){var P=this.v3pool,rt=at;Z.vsub(Q,D),U.getSideNormals(rt,ct);for(var lt=W.radius,dt=!1,st=$,it=Ct,ot=xt,yt=null,Mt=0,tt=0,At=0,zt=null,Ht=0,St=rt.length;Ht!==St&&dt===!1;Ht++){var _t=J;_t.copy(rt[Ht]);var wt=_t.norm();_t.normalize();var ve=D.dot(_t);if(ve<wt+lt&&ve>0){var me=mt,re=ut;me.copy(rt[(Ht+1)%3]),re.copy(rt[(Ht+2)%3]);var be=me.norm(),se=re.norm();me.normalize(),re.normalize();var Ot=D.dot(me),Me=D.dot(re);if(Ot<be&&Ot>-be&&Me<se&&Me>-se){var jt=Math.abs(ve-wt-lt);(zt===null||jt<zt)&&(zt=jt,tt=Ot,At=Me,yt=wt,st.copy(_t),it.copy(me),ot.copy(re),Mt++)}}}if(Mt){dt=!0;var bt=this.createContactEquation(nt,ht,W,U);st.mult(-lt,bt.ri),bt.ni.copy(st),bt.ni.negate(bt.ni),st.mult(yt,st),it.mult(tt,it),st.vadd(it,st),ot.mult(At,ot),st.vadd(ot,bt.rj),bt.ri.vadd(Z,bt.ri),bt.ri.vsub(nt.position,bt.ri),bt.rj.vadd(Q,bt.rj),bt.rj.vsub(ht.position,bt.rj),this.result.push(bt),this.createFrictionEquationsFromContact(bt,this.frictionResult)}for(var qt=P.get(),Ee=G,oe=0;oe!==2&&!dt;oe++)for(var $t=0;$t!==2&&!dt;$t++)for(var Kt=0;Kt!==2&&!dt;Kt++)if(qt.set(0,0,0),oe?qt.vadd(rt[0],qt):qt.vsub(rt[0],qt),$t?qt.vadd(rt[1],qt):qt.vsub(rt[1],qt),Kt?qt.vadd(rt[2],qt):qt.vsub(rt[2],qt),Q.vadd(qt,Ee),Ee.vsub(Z,Ee),Ee.norm2()<lt*lt){dt=!0;var bt=this.createContactEquation(nt,ht,W,U);bt.ri.copy(Ee),bt.ri.normalize(),bt.ni.copy(bt.ri),bt.ri.mult(lt,bt.ri),bt.rj.copy(qt),bt.ri.vadd(Z,bt.ri),bt.ri.vsub(nt.position,bt.ri),bt.rj.vadd(Q,bt.rj),bt.rj.vsub(ht.position,bt.rj),this.result.push(bt),this.createFrictionEquationsFromContact(bt,this.frictionResult)}P.release(qt),qt=null;for(var ye=P.get(),Ae=P.get(),bt=P.get(),he=P.get(),jt=P.get(),_e=rt.length,oe=0;oe!==_e&&!dt;oe++)for(var $t=0;$t!==_e&&!dt;$t++)if(oe%3!==$t%3){rt[$t].cross(rt[oe],ye),ye.normalize(),rt[oe].vadd(rt[$t],Ae),bt.copy(Z),bt.vsub(Ae,bt),bt.vsub(Q,bt);var Fe=bt.dot(ye);ye.mult(Fe,he);for(var Kt=0;Kt===oe%3||Kt===$t%3;)Kt++;jt.copy(Z),jt.vsub(he,jt),jt.vsub(Ae,jt),jt.vsub(Q,jt);var Zi=Math.abs(Fe),Qi=jt.norm();if(Zi<rt[Kt].norm()&&Qi<lt){dt=!0;var Dt=this.createContactEquation(nt,ht,W,U);Ae.vadd(he,Dt.rj),Dt.rj.copy(Dt.rj),jt.negate(Dt.ni),Dt.ni.normalize(),Dt.ri.copy(Dt.rj),Dt.ri.vadd(Q,Dt.ri),Dt.ri.vsub(Z,Dt.ri),Dt.ri.normalize(),Dt.ri.mult(lt,Dt.ri),Dt.ri.vadd(Z,Dt.ri),Dt.ri.vsub(nt.position,Dt.ri),Dt.rj.vadd(Q,Dt.rj),Dt.rj.vsub(ht.position,Dt.rj),this.result.push(Dt),this.createFrictionEquationsFromContact(Dt,this.frictionResult)}}P.release(ye,Ae,bt,he,jt)};var Nt=new s,pt=new s,Rt=new s,It=new s,Pt=new s,Vt=new s,Bt=new s,Lt=new s,Tt=new s,Yt=new s;p.prototype[r.types.SPHERE|r.types.CONVEXPOLYHEDRON]=p.prototype.sphereConvex=function(W,U,Z,Q,gt,ct,nt,ht){var P=this.v3pool;Z.vsub(Q,Nt);for(var rt=U.faceNormals,lt=U.faces,dt=U.vertices,st=W.radius,it=0;it!==dt.length;it++){var ot=dt[it],yt=Pt;ct.vmult(ot,yt),Q.vadd(yt,yt);var Mt=It;if(yt.vsub(Z,Mt),Mt.norm2()<st*st){At=!0;var tt=this.createContactEquation(nt,ht,W,U);tt.ri.copy(Mt),tt.ri.normalize(),tt.ni.copy(tt.ri),tt.ri.mult(st,tt.ri),yt.vsub(Q,tt.rj),tt.ri.vadd(Z,tt.ri),tt.ri.vsub(nt.position,tt.ri),tt.rj.vadd(Q,tt.rj),tt.rj.vsub(ht.position,tt.rj),this.result.push(tt),this.createFrictionEquationsFromContact(tt,this.frictionResult);return}}for(var At=!1,it=0,zt=lt.length;it!==zt&&At===!1;it++){var Ht=rt[it],St=lt[it],_t=Vt;ct.vmult(Ht,_t);var wt=Bt;ct.vmult(dt[St[0]],wt),wt.vadd(Q,wt);var ve=Lt;_t.mult(-st,ve),Z.vadd(ve,ve);var me=Tt;ve.vsub(wt,me);var re=me.dot(_t),be=Yt;if(Z.vsub(wt,be),re<0&&be.dot(_t)>0){for(var se=[],Ot=0,Me=St.length;Ot!==Me;Ot++){var qt=P.get();ct.vmult(dt[St[Ot]],qt),Q.vadd(qt,qt),se.push(qt)}if(T(se,_t,Z)){At=!0;var tt=this.createContactEquation(nt,ht,W,U);_t.mult(-st,tt.ri),_t.negate(tt.ni);var Ee=P.get();_t.mult(-re,Ee);var oe=P.get();_t.mult(-st,oe),Z.vsub(Q,tt.rj),tt.rj.vadd(oe,tt.rj),tt.rj.vadd(Ee,tt.rj),tt.rj.vadd(Q,tt.rj),tt.rj.vsub(ht.position,tt.rj),tt.ri.vadd(Z,tt.ri),tt.ri.vsub(nt.position,tt.ri),P.release(Ee),P.release(oe),this.result.push(tt),this.createFrictionEquationsFromContact(tt,this.frictionResult);for(var Ot=0,$t=se.length;Ot!==$t;Ot++)P.release(se[Ot]);return}else for(var Ot=0;Ot!==St.length;Ot++){var Kt=P.get(),ye=P.get();ct.vmult(dt[St[(Ot+1)%St.length]],Kt),ct.vmult(dt[St[(Ot+2)%St.length]],ye),Q.vadd(Kt,Kt),Q.vadd(ye,ye);var Ae=pt;ye.vsub(Kt,Ae);var bt=Rt;Ae.unit(bt);var he=P.get(),jt=P.get();Z.vsub(Kt,jt);var _e=jt.dot(bt);bt.mult(_e,he),he.vadd(Kt,he);var Fe=P.get();if(he.vsub(Z,Fe),_e>0&&_e*_e<Ae.norm2()&&Fe.norm2()<st*st){var tt=this.createContactEquation(nt,ht,W,U);he.vsub(Q,tt.rj),he.vsub(Z,tt.ni),tt.ni.normalize(),tt.ni.mult(st,tt.ri),tt.rj.vadd(Q,tt.rj),tt.rj.vsub(ht.position,tt.rj),tt.ri.vadd(Z,tt.ri),tt.ri.vsub(nt.position,tt.ri),this.result.push(tt),this.createFrictionEquationsFromContact(tt,this.frictionResult);for(var Ot=0,$t=se.length;Ot!==$t;Ot++)P.release(se[Ot]);P.release(Kt),P.release(ye),P.release(he),P.release(Fe),P.release(jt);return}P.release(Kt),P.release(ye),P.release(he),P.release(Fe),P.release(jt)}for(var Ot=0,$t=se.length;Ot!==$t;Ot++)P.release(se[Ot])}}},new s,new s,p.prototype[r.types.PLANE|r.types.BOX]=p.prototype.planeBox=function(W,U,Z,Q,gt,ct,nt,ht){U.convexPolyhedronRepresentation.material=U.material,U.convexPolyhedronRepresentation.collisionResponse=U.collisionResponse,this.planeConvex(W,U.convexPolyhedronRepresentation,Z,Q,gt,ct,nt,ht)};var Jt=new s,ce=new s,ue=new s,S=new s;p.prototype[r.types.PLANE|r.types.CONVEXPOLYHEDRON]=p.prototype.planeConvex=function(W,U,Z,Q,gt,ct,nt,ht){var P=Jt,rt=ce;rt.set(0,0,1),gt.vmult(rt,rt);for(var lt=0,dt=ue,st=0;st!==U.vertices.length;st++){P.copy(U.vertices[st]),ct.vmult(P,P),Q.vadd(P,P),P.vsub(Z,dt);var it=rt.dot(dt);if(it<=0){var ot=this.createContactEquation(nt,ht,W,U),yt=S;rt.mult(rt.dot(dt),yt),P.vsub(yt,yt),yt.vsub(Z,ot.ri),ot.ni.copy(rt),P.vsub(Q,ot.rj),ot.ri.vadd(Z,ot.ri),ot.ri.vsub(nt.position,ot.ri),ot.rj.vadd(Q,ot.rj),ot.rj.vsub(ht.position,ot.rj),this.result.push(ot),lt++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(ot,this.frictionResult)}}this.enableFrictionReduction&&lt&&this.createFrictionFromAverage(lt)};var vt=new s,Ft=new s;p.prototype[r.types.CONVEXPOLYHEDRON]=p.prototype.convexConvex=function(W,U,Z,Q,gt,ct,nt,ht,P,rt,lt,dt){var st=vt;if(!(Z.distanceTo(Q)>W.boundingSphereRadius+U.boundingSphereRadius)&&W.findSeparatingAxis(U,Z,gt,Q,ct,st,lt,dt)){var it=[],ot=Ft;W.clipAgainstHull(Z,gt,U,Q,ct,st,-100,100,it);for(var yt=0,Mt=0;Mt!==it.length;Mt++){var tt=this.createContactEquation(nt,ht,W,U,P,rt),At=tt.ri,zt=tt.rj;st.negate(tt.ni),it[Mt].normal.negate(ot),ot.mult(it[Mt].depth,ot),it[Mt].point.vadd(ot,At),zt.copy(it[Mt].point),At.vsub(Z,At),zt.vsub(Q,zt),At.vadd(Z,At),At.vsub(nt.position,At),zt.vadd(Q,zt),zt.vsub(ht.position,zt),this.result.push(tt),yt++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(tt,this.frictionResult)}this.enableFrictionReduction&&yt&&this.createFrictionFromAverage(yt)}};var Wt=new s,Ut=new s,Zt=new s;p.prototype[r.types.PLANE|r.types.PARTICLE]=p.prototype.planeParticle=function(W,U,Z,Q,gt,ct,nt,ht){var P=Wt;P.set(0,0,1),nt.quaternion.vmult(P,P);var rt=Ut;Q.vsub(nt.position,rt);var lt=P.dot(rt);if(lt<=0){var dt=this.createContactEquation(ht,nt,U,W);dt.ni.copy(P),dt.ni.negate(dt.ni),dt.ri.set(0,0,0);var st=Zt;P.mult(P.dot(Q),st),Q.vsub(st,st),dt.rj.copy(st),this.result.push(dt),this.createFrictionEquationsFromContact(dt,this.frictionResult)}};var Gt=new s;p.prototype[r.types.PARTICLE|r.types.SPHERE]=p.prototype.sphereParticle=function(W,U,Z,Q,gt,ct,nt,ht){var P=Gt;P.set(0,0,1),Q.vsub(Z,P);var rt=P.norm2();if(rt<=W.radius*W.radius){var lt=this.createContactEquation(ht,nt,U,W);P.normalize(),lt.rj.copy(P),lt.rj.mult(W.radius,lt.rj),lt.ni.copy(P),lt.ni.negate(lt.ni),lt.ri.set(0,0,0),this.result.push(lt),this.createFrictionEquationsFromContact(lt,this.frictionResult)}};var ie=new o,pe=new s;new s;var ne=new s,kt=new s,Qt=new s;p.prototype[r.types.PARTICLE|r.types.CONVEXPOLYHEDRON]=p.prototype.convexParticle=function(W,U,Z,Q,gt,ct,nt,ht){var P=-1,rt=ne,lt=Qt,dt=null,st=pe;if(st.copy(Q),st.vsub(Z,st),gt.conjugate(ie),ie.vmult(st,st),W.pointIsInside(st)){W.worldVerticesNeedsUpdate&&W.computeWorldVertices(Z,gt),W.worldFaceNormalsNeedsUpdate&&W.computeWorldFaceNormals(gt);for(var it=0,ot=W.faces.length;it!==ot;it++){var yt=[W.worldVertices[W.faces[it][0]]],Mt=W.worldFaceNormals[it];Q.vsub(yt[0],kt);var tt=-Mt.dot(kt);(dt===null||Math.abs(tt)<Math.abs(dt))&&(dt=tt,P=it,rt.copy(Mt))}if(P!==-1){var At=this.createContactEquation(ht,nt,U,W);rt.mult(dt,lt),lt.vadd(Q,lt),lt.vsub(Z,lt),At.rj.copy(lt),rt.negate(At.ni),At.ri.set(0,0,0);var zt=At.ri,Ht=At.rj;zt.vadd(Q,zt),zt.vsub(ht.position,zt),Ht.vadd(Z,Ht),Ht.vsub(nt.position,Ht),this.result.push(At),this.createFrictionEquationsFromContact(At,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}},p.prototype[r.types.BOX|r.types.HEIGHTFIELD]=p.prototype.boxHeightfield=function(W,U,Z,Q,gt,ct,nt,ht){W.convexPolyhedronRepresentation.material=W.material,W.convexPolyhedronRepresentation.collisionResponse=W.collisionResponse,this.convexHeightfield(W.convexPolyhedronRepresentation,U,Z,Q,gt,ct,nt,ht)};var de=new s,ae=new s,fe=[0];p.prototype[r.types.CONVEXPOLYHEDRON|r.types.HEIGHTFIELD]=p.prototype.convexHeightfield=function(W,U,Z,Q,gt,ct,nt,ht){var P=U.data,rt=U.elementSize,lt=W.boundingSphereRadius,dt=ae,st=fe,it=de;c.pointToLocalFrame(Q,ct,Z,it);var ot=Math.floor((it.x-lt)/rt)-1,yt=Math.ceil((it.x+lt)/rt)+1,Mt=Math.floor((it.y-lt)/rt)-1,tt=Math.ceil((it.y+lt)/rt)+1;if(!(yt<0||tt<0||ot>P.length||Mt>P[0].length)){ot<0&&(ot=0),yt<0&&(yt=0),Mt<0&&(Mt=0),tt<0&&(tt=0),ot>=P.length&&(ot=P.length-1),yt>=P.length&&(yt=P.length-1),tt>=P[0].length&&(tt=P[0].length-1),Mt>=P[0].length&&(Mt=P[0].length-1);var At=[];U.getRectMinMax(ot,Mt,yt,tt,At);var zt=At[0],Ht=At[1];if(!(it.z-lt>Ht||it.z+lt<zt))for(var St=ot;St<yt;St++)for(var _t=Mt;_t<tt;_t++)U.getConvexTrianglePillar(St,_t,!1),c.pointToWorldFrame(Q,ct,U.pillarOffset,dt),Z.distanceTo(dt)<U.pillarConvex.boundingSphereRadius+W.boundingSphereRadius&&this.convexConvex(W,U.pillarConvex,Z,dt,gt,ct,nt,ht,null,null,st,null),U.getConvexTrianglePillar(St,_t,!0),c.pointToWorldFrame(Q,ct,U.pillarOffset,dt),Z.distanceTo(dt)<U.pillarConvex.boundingSphereRadius+W.boundingSphereRadius&&this.convexConvex(W,U.pillarConvex,Z,dt,gt,ct,nt,ht,null,null,st,null)}};var xe=new s,Xt=new s;p.prototype[r.types.SPHERE|r.types.HEIGHTFIELD]=p.prototype.sphereHeightfield=function(W,U,Z,Q,gt,ct,nt,ht){var P=U.data,rt=W.radius,lt=U.elementSize,dt=Xt,st=xe;c.pointToLocalFrame(Q,ct,Z,st);var it=Math.floor((st.x-rt)/lt)-1,ot=Math.ceil((st.x+rt)/lt)+1,yt=Math.floor((st.y-rt)/lt)-1,Mt=Math.ceil((st.y+rt)/lt)+1;if(!(ot<0||Mt<0||it>P.length||Mt>P[0].length)){it<0&&(it=0),ot<0&&(ot=0),yt<0&&(yt=0),Mt<0&&(Mt=0),it>=P.length&&(it=P.length-1),ot>=P.length&&(ot=P.length-1),Mt>=P[0].length&&(Mt=P[0].length-1),yt>=P[0].length&&(yt=P[0].length-1);var tt=[];U.getRectMinMax(it,yt,ot,Mt,tt);var At=tt[0],zt=tt[1];if(!(st.z-rt>zt||st.z+rt<At))for(var Ht=this.result,St=it;St<ot;St++)for(var _t=yt;_t<Mt;_t++){var wt=Ht.length;U.getConvexTrianglePillar(St,_t,!1),c.pointToWorldFrame(Q,ct,U.pillarOffset,dt),Z.distanceTo(dt)<U.pillarConvex.boundingSphereRadius+W.boundingSphereRadius&&this.sphereConvex(W,U.pillarConvex,Z,dt,gt,ct,nt,ht),U.getConvexTrianglePillar(St,_t,!0),c.pointToWorldFrame(Q,ct,U.pillarOffset,dt),Z.distanceTo(dt)<U.pillarConvex.boundingSphereRadius+W.boundingSphereRadius&&this.sphereConvex(W,U.pillarConvex,Z,dt,gt,ct,nt,ht);var ve=Ht.length-wt;if(ve>2)return}}}},{"../collision/AABB":3,"../collision/Ray":9,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43,"../solver/Solver":47,"../utils/Vec3Pool":54}],56:[function(e,i,d){i.exports=x;var l=e("../shapes/Shape"),r=e("../math/Vec3"),a=e("../math/Quaternion"),s=e("../solver/GSSolver");e("../utils/Vec3Pool"),e("../equations/ContactEquation"),e("../equations/FrictionEquation");var c=e("./Narrowphase"),o=e("../utils/EventTarget"),n=e("../collision/ArrayCollisionMatrix"),h=e("../material/Material"),u=e("../material/ContactMaterial"),p=e("../objects/Body"),f=e("../utils/TupleDictionary"),v=e("../collision/RaycastResult"),m=e("../collision/AABB"),y=e("../collision/Ray"),g=e("../collision/NaiveBroadphase");function x(){o.apply(this),this.dt=-1,this.allowSleep=!1,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=0,this.quatNormalizeFast=!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new r,this.broadphase=new g,this.bodies=[],this.solver=new s,this.constraints=[],this.narrowphase=new c(this),this.collisionMatrix=new n,this.collisionMatrixPrevious=new n,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new f,this.defaultMaterial=new h("default"),this.defaultContactMaterial=new u(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null}}x.prototype=new o,new m;var E=new y;if(x.prototype.getContactMaterial=function(C,j){return this.contactMaterialTable.get(C.id,j.id)},x.prototype.numObjects=function(){return this.bodies.length},x.prototype.collisionMatrixTick=function(){var C=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=C,this.collisionMatrix.reset()},x.prototype.add=x.prototype.addBody=function(C){this.bodies.indexOf(C)===-1&&(C.index=this.bodies.length,this.bodies.push(C),C.world=this,C.initPosition.copy(C.position),C.initVelocity.copy(C.velocity),C.timeLastSleepy=this.time,C instanceof p&&(C.initAngularVelocity.copy(C.angularVelocity),C.initQuaternion.copy(C.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=C,this.dispatchEvent(this.addBodyEvent))},x.prototype.addConstraint=function(C){this.constraints.push(C)},x.prototype.removeConstraint=function(C){var j=this.constraints.indexOf(C);j!==-1&&this.constraints.splice(j,1)},x.prototype.rayTest=function(C,j,H){H instanceof v?this.raycastClosest(C,j,{skipBackfaces:!0},H):this.raycastAll(C,j,{skipBackfaces:!0},H)},x.prototype.raycastAll=function(C,j,H,A){return H.mode=y.ALL,H.from=C,H.to=j,H.callback=A,E.intersectWorld(this,H)},x.prototype.raycastAny=function(C,j,H,A){return H.mode=y.ANY,H.from=C,H.to=j,H.result=A,E.intersectWorld(this,H)},x.prototype.raycastClosest=function(C,j,H,A){return H.mode=y.CLOSEST,H.from=C,H.to=j,H.result=A,E.intersectWorld(this,H)},x.prototype.remove=function(C){C.world=null;var j=this.bodies.length-1,H=this.bodies,A=H.indexOf(C);if(A!==-1){H.splice(A,1);for(var F=0;F!==H.length;F++)H[F].index=F;this.collisionMatrix.setNumObjects(j),this.removeBodyEvent.body=C,this.dispatchEvent(this.removeBodyEvent)}},x.prototype.removeBody=x.prototype.remove,x.prototype.addMaterial=function(C){this.materials.push(C)},x.prototype.addContactMaterial=function(C){this.contactmaterials.push(C),this.contactMaterialTable.set(C.materials[0].id,C.materials[1].id,C)},typeof performance>"u"&&(performance={}),!performance.now){var k=Date.now();performance.timing&&performance.timing.navigationStart&&(k=performance.timing.navigationStart),performance.now=function(){return Date.now()-k}}var L=new r;x.prototype.step=function(C,j,H){if(H=H||10,j=j||0,j===0)this.internalStep(C),this.time+=C;else{var A=Math.floor((this.time+j)/C)-Math.floor(this.time/C);A=Math.min(A,H);for(var F=performance.now(),M=0;M!==A&&(this.internalStep(C),!(performance.now()-F>C*1e3));M++);this.time+=j;for(var b=this.time%C,w=b/C,B=L,X=this.bodies,q=0;q!==X.length;q++){var T=X[q];T.type!==p.STATIC&&T.sleepState!==p.SLEEPING?(T.position.vsub(T.previousPosition,B),B.scale(w,B),T.position.vadd(B,T.interpolatedPosition)):(T.interpolatedPosition.copy(T.position),T.interpolatedQuaternion.copy(T.quaternion))}}};var N={type:"postStep"},Y={type:"preStep"},R={type:"collide",body:null,contact:null},z=[],I=[],V=[],et=[];new r,new r,new r,new r,new r,new r,new r,new r,new r,new a;var K=new a,ft=new a,_=new r;x.prototype.internalStep=function(C){this.dt=C;var j=this.contacts,H=V,A=et,F=this.numObjects(),M=this.bodies,b=this.solver,w=this.gravity,B=this.doProfiling,X=this.profile,q=p.DYNAMIC,T,D=this.constraints,J=I;w.norm();var mt=w.x,ut=w.y,at=w.z,G=0;for(B&&(T=performance.now()),G=0;G!==F;G++){var $=M[G];if($.type&q){var Ct=$.force,xt=$.mass;Ct.x+=xt*mt,Ct.y+=xt*ut,Ct.z+=xt*at}}for(var G=0,Nt=this.subsystems.length;G!==Nt;G++)this.subsystems[G].update();B&&(T=performance.now()),H.length=0,A.length=0,this.broadphase.collisionPairs(this,H,A),B&&(X.broadphase=performance.now()-T);var vt=D.length;for(G=0;G!==vt;G++){var pt=D[G];if(!pt.collideConnected)for(var Rt=H.length-1;Rt>=0;Rt-=1)(pt.bodyA===H[Rt]&&pt.bodyB===A[Rt]||pt.bodyB===H[Rt]&&pt.bodyA===A[Rt])&&(H.splice(Rt,1),A.splice(Rt,1))}this.collisionMatrixTick(),B&&(T=performance.now());var It=z,Pt=j.length;for(G=0;G!==Pt;G++)It.push(j[G]);j.length=0;var Vt=this.frictionEquations.length;for(G=0;G!==Vt;G++)J.push(this.frictionEquations[G]);this.frictionEquations.length=0,this.narrowphase.getContacts(H,A,this,j,It,this.frictionEquations,J),B&&(X.narrowphase=performance.now()-T),B&&(T=performance.now());for(var G=0;G<this.frictionEquations.length;G++)b.addEquation(this.frictionEquations[G]);for(var Bt=j.length,Lt=0;Lt!==Bt;Lt++){var pt=j[Lt],$=pt.bi,Tt=pt.bj;pt.si,pt.sj;var Yt;if($.material&&Tt.material?Yt=this.getContactMaterial($.material,Tt.material)||this.defaultContactMaterial:Yt=this.defaultContactMaterial,Yt.friction,$.material&&Tt.material&&($.material.friction>=0&&Tt.material.friction>=0&&$.material.friction*Tt.material.friction,$.material.restitution>=0&&Tt.material.restitution>=0&&(pt.restitution=$.material.restitution*Tt.material.restitution)),b.addEquation(pt),$.allowSleep&&$.type===p.DYNAMIC&&$.sleepState===p.SLEEPING&&Tt.sleepState===p.AWAKE&&Tt.type!==p.STATIC){var Jt=Tt.velocity.norm2()+Tt.angularVelocity.norm2(),ce=Math.pow(Tt.sleepSpeedLimit,2);Jt>=ce*2&&($._wakeUpAfterNarrowphase=!0)}if(Tt.allowSleep&&Tt.type===p.DYNAMIC&&Tt.sleepState===p.SLEEPING&&$.sleepState===p.AWAKE&&$.type!==p.STATIC){var ue=$.velocity.norm2()+$.angularVelocity.norm2(),S=Math.pow($.sleepSpeedLimit,2);ue>=S*2&&(Tt._wakeUpAfterNarrowphase=!0)}this.collisionMatrix.set($,Tt,!0),this.collisionMatrixPrevious.get($,Tt)||(R.body=Tt,R.contact=pt,$.dispatchEvent(R),R.body=$,Tt.dispatchEvent(R))}for(B&&(X.makeContactConstraints=performance.now()-T,T=performance.now()),G=0;G!==F;G++){var $=M[G];$._wakeUpAfterNarrowphase&&($.wakeUp(),$._wakeUpAfterNarrowphase=!1)}var vt=D.length;for(G=0;G!==vt;G++){var pt=D[G];pt.update();for(var Rt=0,Ft=pt.equations.length;Rt!==Ft;Rt++){var Wt=pt.equations[Rt];b.addEquation(Wt)}}b.solve(C,this),B&&(X.solve=performance.now()-T),b.removeAllEquations();var Ut=Math.pow;for(G=0;G!==F;G++){var $=M[G];if($.type&q){var Zt=Ut(1-$.linearDamping,C),Gt=$.velocity;Gt.mult(Zt,Gt);var ie=$.angularVelocity;if(ie){var pe=Ut(1-$.angularDamping,C);ie.mult(pe,ie)}}}for(this.dispatchEvent(Y),G=0;G!==F;G++){var $=M[G];$.preStep&&$.preStep.call($)}B&&(T=performance.now());var ne=K,kt=ft,Qt=this.stepnumber,de=p.DYNAMIC|p.KINEMATIC,ae=Qt%(this.quatNormalizeSkip+1)===0,fe=this.quatNormalizeFast,xe=C*.5;for(l.types.PLANE,l.types.CONVEXPOLYHEDRON,G=0;G!==F;G++){var Xt=M[G],W=Xt.force,U=Xt.torque;if(Xt.type&de&&Xt.sleepState!==p.SLEEPING){var Z=Xt.velocity,Q=Xt.angularVelocity,gt=Xt.position,ct=Xt.quaternion,nt=Xt.invMass,ht=Xt.invInertiaWorld;Z.x+=W.x*nt*C,Z.y+=W.y*nt*C,Z.z+=W.z*nt*C,Xt.angularVelocity&&(ht.vmult(U,_),_.mult(C,_),_.vadd(Q,Q)),gt.x+=Z.x*C,gt.y+=Z.y*C,gt.z+=Z.z*C,Xt.angularVelocity&&(ne.set(Q.x,Q.y,Q.z,0),ne.mult(ct,kt),ct.x+=xe*kt.x,ct.y+=xe*kt.y,ct.z+=xe*kt.z,ct.w+=xe*kt.w,ae&&(fe?ct.normalizeFast():ct.normalize())),Xt.aabb&&(Xt.aabbNeedsUpdate=!0),Xt.updateInertiaWorld&&Xt.updateInertiaWorld()}}for(this.clearForces(),this.broadphase.dirty=!0,B&&(X.integrate=performance.now()-T),this.time+=C,this.stepnumber+=1,this.dispatchEvent(N),G=0;G!==F;G++){var $=M[G],P=$.postStep;P&&P.call($)}if(this.allowSleep)for(G=0;G!==F;G++)M[G].sleepTick(this.time)},x.prototype.clearForces=function(){for(var C=this.bodies,j=C.length,H=0;H!==j;H++){var A=C[H];A.force,A.torque,A.force.set(0,0,0),A.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/Ray":9,"../collision/RaycastResult":10,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../material/ContactMaterial":24,"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Shape":43,"../solver/GSSolver":46,"../utils/EventTarget":49,"../utils/TupleDictionary":52,"../utils/Vec3Pool":54,"./Narrowphase":55}]},{},[2])(2)})})(Yi);var gi=Yi.exports;const kn=(O,t,e)=>{const i=[];for(let d=0;d<=e;d++){const l=d*Math.PI/e;for(let r=0;r<=e;r++){const a=r*2*Math.PI/e,s=O*Math.sin(l)*Math.cos(a),c=O*Math.sin(l)*Math.sin(a),o=O*Math.cos(l);i.push(new THREE.Vector3(s,c,o))}}return i},qn=kn(1,4,32);new THREE.BufferGeometry().setFromPoints(qn);let ti,ei,Ye,ni,Re,ii=new THREE.BufferGeometry,Dn=Date.now(),Un=.001;const Pe=[],Gi=[],bi=new gi.World;bi.gravity.set(0,.32,0);const Xi=new gi.Sphere(1),De=new gi.Body({mass:1,shape:Xi});function Hn(){ti=new THREE.Scene,ei=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),Ye=new THREE.WebGLRenderer,Ye.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(Ye.domElement),ei.position.z=5;const O=new THREE.MeshBasicMaterial({color:16711680});Re=new THREE.Mesh(ii,O),ti.add(Re),De.position.copy(Re.position),De.quaternion.copy(Re.quaternion),bi.addBody(De);for(let i=-1;i<=1;i+=2)for(let d=-1;d<=1;d+=2)for(let l=-1;l<=1;l+=2)for(let r=-1;r<=1;r+=2)Pe.push([r,l,d,i]);for(let i=0;i<Pe.length;i++)for(let d=i+1;d<Pe.length;d++)Pe[i].reduce((r,a,s)=>r+Math.abs(a-Pe[d][s]),0)===2&&Gi.push([i,d]);const t=new THREE.BufferGeometry,e=new THREE.LineBasicMaterial({color:16777215});ni=new THREE.LineSegments(t,e),ti.add(ni),new On(ei,Ye.domElement),ji()}function ji(){requestAnimationFrame(ji);const O=.01,t=Math.cos(O),e=Math.sin(O);let d=Date.now()-Dn,l=1+Un*d;Xi.radius=l,De.updateBoundingRadius(),Re&&(ii.dispose(),ii=new THREE.SphereGeometry(l,32,32),Re.geometry=ii);const r=Pe.map(c=>{const[o,n,h,u]=c;return[t*o-e*u,n,h,e*o+t*u]}),a=r.map(c=>{const[o,n,h,u]=c,p=2/(2+u);return[p*o,p*n,p*h]}),s=[];for(const[c,o]of Gi)s.push(...a[c],...a[o]);ni.geometry.setAttribute("position",new THREE.Float32BufferAttribute(s,3)),ni.geometry.attributes.position.needsUpdate=!0,bi.step(1/60),Re.position.copy(De.position),Re.quaternion.copy(De.quaternion);for(let c=0;c<Pe.length;c++)Pe[c]=r[c];Ye.render(ti,ei)}Hn();
